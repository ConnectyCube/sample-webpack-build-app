!function(t){var h={};function f(r){if(h[r])return h[r].exports;var c=h[r]={i:r,l:!1,exports:{}};return t[r].call(c.exports,c,c.exports,f),c.l=!0,c.exports}f.m=t,f.c=h,f.d=function(t,h,r){f.o(t,h)||Object.defineProperty(t,h,{enumerable:!0,get:r})},f.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},f.t=function(t,h){if(1&h&&(t=f(t)),8&h)return t;if(4&h&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(f.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&h&&"string"!=typeof t)for(var c in t)f.d(r,c,function(h){return t[h]}.bind(null,c));return r},f.n=function(t){var h=t&&t.__esModule?function(){return t.default}:function(){return t};return f.d(h,"a",h),h},f.o=function(t,h){return Object.prototype.hasOwnProperty.call(t,h)},f.p="",f(f.s=15)}([function(t,h,f){(function(h,r){const c=f(1),m=f(9);let y={machine:Math.floor(16777216*Math.random()).toString(16),pid:Math.floor(32767*Math.random()).toString(16),increment:0};const v={getEnv:function(){return m.getEnv()},isWebRTCAvailble:function(){return m.isWebRTCAvailble()},safeCallbackCall:function(){let t,h=arguments[0].toString().split("(")[0].split(" ")[1],f=[];for(let t=0;t<arguments.length;t++)f.push(arguments[t]);t=f.shift();try{t.apply(null,f)}catch(t){""===h?console.error("Error: "+t):console.error("Error in listener "+h+": "+t)}},randomNonce:function(){return Math.floor(1e4*Math.random())},unixTime:function(){return Math.floor(Date.now()/1e3)},getUrl:function(t,h){var f=h?"/"+h:"";return"https://"+c.endpoints.api+"/"+t+f+c.urls.type},isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},isObject:function(t){return"[object Object]"===Object.prototype.toString.call(t)},isFunction:function(t){return!!(t&&t.constructor&&t.call&&t.apply)},getBsonObjectId:function(){let t=this.unixTime().toString(16),h=(y.increment++).toString(16);return h>16777215&&(y.increment=0),"00000000".substr(0,8-t.length)+t+"000000".substr(0,6-y.machine.length)+y.machine+"0000".substr(0,4-y.pid.length)+y.pid+"000000".substr(0,6-h.length)+h},DLog:function(){const t=this;if(t.loggers){for(let h=0;h<t.loggers.length;++h)t.loggers[h](arguments);return}let h;t.loggers=[];let f=function(){return function(t){console.log.apply(console,Array.prototype.slice.call(t))}};if("object"==typeof c.debug?"number"==typeof c.debug.mode?1==c.debug.mode&&(h=f(),t.loggers.push(h)):"object"==typeof c.debug.mode&&c.debug.mode.forEach(function(r){1===r&&(h=f(),t.loggers.push(h))}):"boolean"==typeof c.debug&&c.debug&&(h=f(),t.loggers.push(h)),t.loggers)for(let h=0;h<t.loggers.length;++h)t.loggers[h](arguments)},getError:function(t,h,f){let r={code:t,status:"error",detail:h};switch(t){case 401:r.message="Unauthorized";break;case 403:r.message="Forbidden";break;case 408:r.message="Request Timeout";break;case 422:r.message="Unprocessable Entity";break;case 502:r.message="Bad Gateway";break;default:r.message="Unknown error"}return this.DLog("["+f+"]","Error:",h),r},isExpiredSessionError:function(t){try{return t&&401===t.code&&"Required session does not exist"===t.message.errors.base[0]}catch(t){return!1}},MergeArrayOfObjects:function(t,h){const f=JSON.parse(JSON.stringify(t));t:for(let t=0;t<h.length;t++){const r=h[t];for(let t=0;t<f.length;t++)if(r.user_id===f[t].user_id){f[t]=r;continue t}f.push(r)}return f},toBase64:function(t){return this.getEnv().browser?btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,function(t,h){return String.fromCharCode("0x"+h)})):this.getEnv().reactnative?h.btoa(t):new r(t).toString("base64")}};t.exports=v}).call(this,f(8),f(17).Buffer)},function(t,h){let f={version:"1.5.0",creds:{appId:"",authKey:"",authSecret:""},endpoints:{api:"api.connectycube.com",chat:"chat.connectycube.com",muc:"muc.chat.connectycube.com"},hash:"sha1",chatProtocol:{bosh:"https://chat.connectycube.com:5281",websocket:"wss://chat.connectycube.com:5291",active:2},webSession:{getSessionTimeInterval:3,getSessionTimeout:120},chat:{contactList:{subscriptionMode:{mutual:!0}},reconnectionTimeInterval:5,streamManagement:{enable:!1}},videochat:{answerTimeInterval:60,dialingTimeInterval:5,disconnectTimeInterval:30,statsReportTimeInterval:!1,iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:turn.connectycube.com"},{urls:"turn:turn.connectycube.com:5349",username:"connectycube",credential:"4c29501ca9207b7fb9c4b4b6b04faeb1"}]},urls:{session:"session",webSession:"session/web",login:"login",users:"users",chat:"chat",blobs:"blobs",subscriptions:"subscriptions",events:"events",data:"data",addressbook:"address_book",addressbookRegistered:"address_book/registered_users",type:".json"},on:{sessionExpired:null},timeout:null,debug:{mode:0},set:function(t){"object"==typeof t.endpoints&&t.endpoints.chat&&(f.endpoints.muc="muc."+t.endpoints.chat,f.chatProtocol.bosh="https://"+t.endpoints.chat+":5281",f.chatProtocol.websocket="wss://"+t.endpoints.chat+":5291"),Object.keys(t).forEach(function(h){"set"!==h&&f.hasOwnProperty(h)&&("object"!=typeof t[h]?f[h]=t[h]:Object.keys(t[h]).forEach(function(r){f[h].hasOwnProperty(r)&&(f[h][r]=t[h][r])}))})}};t.exports=f},function(t,h,f){"use strict";const r=f(0),c=f(1),m=f(3).XMPPClient,y="Unknown interface. SDK support browser / node env.";var v={MARKERS:{CLIENT:"jabber:client",CHAT:"urn:xmpp:chat-markers:0",STATES:"http://jabber.org/protocol/chatstates",MARKERS:"urn:xmpp:chat-markers:0",CARBONS:"urn:xmpp:carbons:2",ROSTER:"jabber:iq:roster",MUC:"http://jabber.org/protocol/muc",PRIVACY:"jabber:iq:privacy",LAST:"jabber:iq:last"},buildUserJid:function(t){var h;return"userId"in t?(h=t.userId+"-"+c.creds.appId+"@"+c.endpoints.chat,"resource"in t&&(h=h+"/"+t.resource)):"jid"in t&&(h=t.jid),h},buildUserJidLocalPart:function(t){return t+"-"+c.creds.appId},createMessageStanza:function(t){return r.getEnv().browser?$msg(t):r.getEnv().reactnative?m.xml("message",t):new m.Stanza("message",t)},createIqStanza:function(t){return r.getEnv().browser?$iq(t):r.getEnv().reactnative?m.xml("iq",t):new m.Stanza("iq",t)},createPresenceStanza:function(t){return r.getEnv().browser?$pres(t):r.getEnv().reactnative?m.xml("presence",t):new m.Stanza("presence",t)},createNonza:function(t,h){return r.getEnv().browser?$build(t,h):r.getEnv().reactnative?m.xml(t,h):new m.Stanza(t,h)},getAttr:function(t,h){var f;return t?("function"==typeof t.getAttribute?f=t.getAttribute(h):t.attrs&&(f=t.attrs[h]),f||null):null},getElement:function(t,h){var f;if("function"==typeof t.querySelector)f=t.querySelector(h);else{if("function"!=typeof t.getChild)throw y;f=t.getChild(h)}return f||null},getAllElements:function(t,h){var f;if("function"==typeof t.querySelectorAll)f=t.querySelectorAll(h);else{if("function"!=typeof t.getChild)throw y;f=t.getChild(h)}return f||null},getElementText:function(t,h){var f,r;if("function"==typeof t.querySelector)r=(f=t.querySelector(h))?f.textContent:null;else{if("function"!=typeof t.getChildText)throw y;r=t.getChildText(h)}return r||null},_JStoXML:function(t,h,f){var r=this;f.c(t),Object.keys(h).forEach(function(t){"object"==typeof h[t]?r._JStoXML(t,h[t],f):f.c(t).t(h[t]).up()}),f.up()},_XMLtoJS:function(t,h,f){t[h]={};for(var r=0,c=f.childNodes.length;r<c;r++)f.childNodes[r].childNodes.length>1?t[h]=this._XMLtoJS(t[h],f.childNodes[r].tagName,f.childNodes[r]):t[h][f.childNodes[r].tagName]=f.childNodes[r].textContent;return t},filledExtraParams:function(t,h){var f=this;return Object.keys(h).forEach(function(c){"attachments"===c?h[c].forEach(function(h){r.getEnv().browser?t.c("attachment",h).up():t.getChild("extraParams").c("attachment",h).up()}):"object"==typeof h[c]?f._JStoXML(c,h[c],t):r.getEnv().browser?t.c(c).t(h[c]).up():t.getChild("extraParams").c(c).t(h[c]).up()}),t.up(),t},parseExtraParams:function(t){if(!t)return null;var h,f,c,m={},y=[];if(r.getEnv().browser)for(var v=0,_=t.childNodes.length;v<_;v++)if("attachment"===t.childNodes[v].tagName){f={};for(var C=0,w=(c=t.childNodes[v].attributes).length;C<w;C++)"size"===c[C].name?f[c[C].name]=parseInt(c[C].value):f[c[C].name]=c[C].value;y.push(f)}else if("dialog_id"===t.childNodes[v].tagName)h=t.childNodes[v].textContent,m.dialog_id=h;else{if(t.childNodes[v].childNodes.length>1)if(t.childNodes[v].textContent.length>4096){for(var T="",S=0;S<t.childNodes[v].childNodes.length;++S)T+=t.childNodes[v].childNodes[S].textContent;m[t.childNodes[v].tagName]=T}else m=this._XMLtoJS(m,t.childNodes[v].tagName,t.childNodes[v]);else m[t.childNodes[v].tagName]=t.childNodes[v].textContent}else for(var E=0,A=t.children.length;E<A;E++){if("attachment"===t.children[E].name){f={},c=t.children[E].attrs;for(var R=Object.keys(c),O=0;O<R.length;O++)"size"===R[O]?f.size=parseInt(c.size):f[R[O]]=c[R[O]];y.push(f)}else"dialog_id"===t.children[E].name&&(h=t.getChildText("dialog_id"),m.dialog_id=h);if(1===t.children[E].children.length){var D=t.children[E];m[D.name]=D.children[0]}}return y.length>0&&(m.attachments=y),m.moduleIdentifier&&delete m.moduleIdentifier,{extension:m,dialogId:h}},getUniqueId:function(t){var h="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var h=16*Math.random()|0;return("x"==t?h:3&h|8).toString(16)});return"string"==typeof t||"number"==typeof t?h+":"+t:h+""},getErrorFromXMLNode:function(t){var h=this.getElement(t,"error"),f=parseInt(this.getAttr(h,"code")),c=this.getElementText(h,"text");return r.getError(f,c)}};t.exports=v},function(t,h,f){const r=f(0);let c,m,y,v;r.getEnv().browser?(c=fetch,m=FormData,Strophe=f(21),Object.assign(window,Strophe),y=f(22),v=f(23)):r.getEnv().nativescript?(c=fetch,m=FormData,y=f(26)):r.getEnv().node&&(c=f(27),m=f(28),y=f(29)),t.exports={fetchImpl:c,formDataImpl:m,XMPPClient:y,SDPTransform:v,XMPPWebSocketTransport:void 0}},function(t,h,f){var r;t.exports=(r=r||function(t,h){var f=Object.create||function(){function t(){}return function(h){var f;return t.prototype=h,f=new t,t.prototype=null,f}}(),r={},c=r.lib={},m=c.Base={extend:function(t){var h=f(this);return t&&h.mixIn(t),h.hasOwnProperty("init")&&this.init!==h.init||(h.init=function(){h.$super.init.apply(this,arguments)}),h.init.prototype=h,h.$super=this,h},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var h in t)t.hasOwnProperty(h)&&(this[h]=t[h]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},y=c.WordArray=m.extend({init:function(t,h){t=this.words=t||[],this.sigBytes=null!=h?h:4*t.length},toString:function(t){return(t||_).stringify(this)},concat:function(t){var h=this.words,f=t.words,r=this.sigBytes,c=t.sigBytes;if(this.clamp(),r%4)for(var m=0;m<c;m++){var y=f[m>>>2]>>>24-m%4*8&255;h[r+m>>>2]|=y<<24-(r+m)%4*8}else for(var m=0;m<c;m+=4)h[r+m>>>2]=f[m>>>2];return this.sigBytes+=c,this},clamp:function(){var h=this.words,f=this.sigBytes;h[f>>>2]&=4294967295<<32-f%4*8,h.length=t.ceil(f/4)},clone:function(){var t=m.clone.call(this);return t.words=this.words.slice(0),t},random:function(h){for(var f,r=[],c=function(h){var h=h,f=987654321,r=4294967295;return function(){var c=((f=36969*(65535&f)+(f>>16)&r)<<16)+(h=18e3*(65535&h)+(h>>16)&r)&r;return c/=4294967296,(c+=.5)*(t.random()>.5?1:-1)}},m=0;m<h;m+=4){var v=c(4294967296*(f||t.random()));f=987654071*v(),r.push(4294967296*v()|0)}return new y.init(r,h)}}),v=r.enc={},_=v.Hex={stringify:function(t){for(var h=t.words,f=t.sigBytes,r=[],c=0;c<f;c++){var m=h[c>>>2]>>>24-c%4*8&255;r.push((m>>>4).toString(16)),r.push((15&m).toString(16))}return r.join("")},parse:function(t){for(var h=t.length,f=[],r=0;r<h;r+=2)f[r>>>3]|=parseInt(t.substr(r,2),16)<<24-r%8*4;return new y.init(f,h/2)}},C=v.Latin1={stringify:function(t){for(var h=t.words,f=t.sigBytes,r=[],c=0;c<f;c++){var m=h[c>>>2]>>>24-c%4*8&255;r.push(String.fromCharCode(m))}return r.join("")},parse:function(t){for(var h=t.length,f=[],r=0;r<h;r++)f[r>>>2]|=(255&t.charCodeAt(r))<<24-r%4*8;return new y.init(f,h)}},w=v.Utf8={stringify:function(t){try{return decodeURIComponent(escape(C.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return C.parse(unescape(encodeURIComponent(t)))}},T=c.BufferedBlockAlgorithm=m.extend({reset:function(){this._data=new y.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=w.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(h){var f=this._data,r=f.words,c=f.sigBytes,m=this.blockSize,v=4*m,_=c/v,C=(_=h?t.ceil(_):t.max((0|_)-this._minBufferSize,0))*m,w=t.min(4*C,c);if(C){for(var T=0;T<C;T+=m)this._doProcessBlock(r,T);var S=r.splice(0,C);f.sigBytes-=w}return new y.init(S,w)},clone:function(){var t=m.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),S=(c.Hasher=T.extend({cfg:m.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){T.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){t&&this._append(t);var h=this._doFinalize();return h},blockSize:16,_createHelper:function(t){return function(h,f){return new t.init(f).finalize(h)}},_createHmacHelper:function(t){return function(h,f){return new S.HMAC.init(t,f).finalize(h)}}}),r.algo={});return r}(Math),r)},function(t,h,f){"use strict";var r=f(1),c={};(c={getUserJid:function(t,h){return t+"-"+h+"@"+r.endpoints.chat},getIdFromNode:function(t){return t.indexOf("@")<0?null:parseInt(t.split("@")[0].split("-")[0])},trace:function(t){r.debug&&console.log("[VideoChat]:",t)},traceWarning:function(t){r.debug&&console.warn("[VideoChat]:",t)},traceError:function(t){r.debug&&console.error("[VideoChat]:",t)},dataURItoBlob:function(t,h){for(var f=[],r=window.atob(t.split(",")[1]),c=0,m=r.length;c<m;c++)f.push(r.charCodeAt(c));return new Blob([new Uint8Array(f)],{type:h})},getVersionFirefox:function(){var t,h=!!navigator&&navigator.userAgent;if(h){var f=h.match(/(?:firefox)[ \/](\d+)/i)||[];t=f[1]?+f[1]:null}return t},getVersionSafari:function(){var t,h=!!navigator&&navigator.userAgent;if(h)if((h.match(/(?:safari)[ \/](\d+)/i)||[]).length){var f=h.match(/(?:version)[ \/](\d+)/i)||[];t=f&&f[1]?+f[1]:null}else t=null;return t}}).SessionConnectionState={UNDEFINED:0,CONNECTING:1,CONNECTED:2,FAILED:3,DISCONNECTED:4,CLOSED:5,COMPLETED:6},c.CallType={VIDEO:1,AUDIO:2},t.exports=c},function(t,h,f){"use strict";function r(){}r.MODULE_ID="WebRTCVideoChat",r.SignalingType={CALL:"call",ACCEPT:"accept",REJECT:"reject",STOP:"hangUp",CANDIDATE:"iceCandidates",PARAMETERS_CHANGED:"update"},t.exports=r},function(t,h,f){const r=f(1);function c(){}c.prototype={version:r.version,init:function(t,h){h&&"object"==typeof h&&r.set(h);const c=f(16),m=f(30),y=f(35),v=f(36),_=f(37),C=f(38),w=f(39),T=f(40),S=f(46),E=f(47),A=f(9);if(this.service=new c,this.auth=new m(this.service),this.users=new y(this.service),this.storage=new v(this.service),this.pushnotifications=new _(this.service),this.data=new C(this.service),this.addressbook=new w(this.service),this.chat=new T(this.service),this.chat.dialog=new S(this.service),this.chat.message=new E(this.service),this.utils=A,A.getEnv().browser)if(A.isWebRTCAvailble()){const t=f(48);this.videochat=new t(this.service,this.chat.xmppClient),this.chat.webrtcSignalingProcessor=this.videochat.signalingProcessor,this.videochatconference=f(52)}else this.videochat=!1,this.videochatconference=!1;else this.videochat=!1,this.videochatconference=!1;t.token?(r.creds.appId=t.appId,this.service.setSession({token:t.token})):(r.creds.appId=t.appId,r.creds.authKey=t.authKey,r.creds.authSecret=t.authSecret)},getSession:function(t){this.auth.getSession(t)},createSession:function(t,h){this.auth.createSession(t,h)},destroySession:function(t){this.auth.destroySession(t)},createWebSession:function(t,h){this.auth.createWebSession(t,h)},checkWebSessionUntilUpgrade:function(t){return this.auth.checkWebSessionUntilUpgrade(t)},upgradeWebSession:function(t,h){this.auth.upgradeWebSession(t,h)},login:function(t,h){this.auth.login(t,h)},logout:function(t){this.auth.logout(t)}};let m=new c;m.ConnectyCube=c,t.exports=m},function(t,h){var f;f=function(){return this}();try{f=f||new Function("return this")()}catch(t){"object"==typeof window&&(f=window)}t.exports=f},function(t,h,f){(function(h){const f={isBrowser:"undefined"!=typeof document,isReactNative:"undefined"!=typeof navigator&&"ReactNative"==navigator.product,isNativeScript:"object"==typeof h&&(void 0!==h.android||void 0!==h.NSObject),getEnv:function(){return{nativescript:this.isNativeScript,reactnative:this.isReactNative,browser:this.isBrowser,node:!this.isBrowser&&!this.isNativeScript&&!this.isReactNative}},isWebRTCAvailble:function(){const t=window.RTCPeerConnection,h=window.RTCIceCandidate,f=window.RTCSessionDescription;let r=!0;return t&&h&&f||(r=!1),r}};t.exports=f}).call(this,f(8))},function(t,h){var f=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(t){return t.encoding?"rtpmap:%d %s/%s/%s":t.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(t){return null!=t.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(t){return null!=t.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(t){return"extmap:%d"+(t.direction?"/%s":"%v")+" %s"+(t.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(t){return null!=t.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(t){var h="candidate:%s %d %s %d %s %d typ %s";return h+=null!=t.raddr?" raddr %s rport %d":"%v%v",h+=null!=t.tcptype?" tcptype %s":"%v",null!=t.generation&&(h+=" generation %d"),h+=null!=t["network-id"]?" network-id %d":"%v",h+=null!=t["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(t){var h="ssrc:%d";return null!=t.attribute&&(h+=" %s",null!=t.value&&(h+=":%s")),h}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(t){return null!=t.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(t){return t.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(t){return"imageattr:%s %s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(t){return"simulcast:%s %s"+(t.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"invalid",names:["value"]}]};Object.keys(f).forEach(function(t){f[t].forEach(function(t){t.reg||(t.reg=/(.*)/),t.format||(t.format="%s")})})},function(t,h,f){var r,c,m,y,v,_,C;t.exports=(r=f(4),m=(c=r).lib,y=m.Base,v=c.enc,_=v.Utf8,C=c.algo,void(C.HMAC=y.extend({init:function(t,h){t=this._hasher=new t.init,"string"==typeof h&&(h=_.parse(h));var f=t.blockSize,r=4*f;h.sigBytes>r&&(h=t.finalize(h)),h.clamp();for(var c=this._oKey=h.clone(),m=this._iKey=h.clone(),y=c.words,v=m.words,C=0;C<f;C++)y[C]^=1549556828,v[C]^=909522486;c.sigBytes=m.sigBytes=r,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var h=this._hasher,f=h.finalize(t);h.reset();var r=h.finalize(this._oKey.clone().concat(f));return r}})))},function(t,h,f){"use strict";var r=f(1),c=f(5),m=f(3).SDPTransform,y=window.RTCPeerConnection,v=window.RTCSessionDescription,_=window.RTCIceCandidate;function C(t,h,f){if(!f)return t.replace(/b=AS:.*\r\n/,"").replace(/b=TIAS:.*\r\n/,"");for(var r=t.split("\n"),m=-1,y=c.getVersionFirefox()?"TIAS":"AS",v=c.getVersionFirefox()?1024*f:f,_=0;_<r.length;_++)if(0===r[_].indexOf("m="+h)){m=_;break}if(-1===m)return t;for(m++;0===r[m].indexOf("i=")||0===r[m].indexOf("c=");)m++;if(0===r[m].indexOf("b"))return r[m]="b="+y+":"+v,r.join("\n");var C=r.slice(0,m);return C.push("b="+y+":"+v),(C=C.concat(r.slice(m,r.length))).join("\n")}y.State={NEW:1,CONNECTING:2,CHECKING:3,CONNECTED:4,DISCONNECTED:5,FAILED:6,CLOSED:7,COMPLETED:8},y.prototype._init=function(t,h,f,r){c.trace("RTCPeerConnection init. userID: "+h+", sessionID: "+f+", type: "+r),this.delegate=t,this.sessionID=f,this.userID=h,this.type=r,this.remoteSDP=null,this.state=y.State.NEW,this.onicecandidate=this.onIceCandidateCallback.bind(this),this.onsignalingstatechange=this.onSignalingStateCallback.bind(this),this.oniceconnectionstatechange=this.onIceConnectionStateCallback.bind(this),c.getVersionSafari()>=11?(this.remoteStream=new MediaStream,this.ontrack=this.onAddRemoteMediaCallback.bind(this),this.onStatusClosedChecker=void 0):(this.remoteStream=null,this.onaddstream=this.onAddRemoteMediaCallback.bind(this)),this.dialingTimer=null,this.answerTimeInterval=0,this.statsReportTimer=null,this.iceCandidates=[]},y.prototype.release=function(){this._clearDialingTimer(),this._clearStatsReportTimer(),"closed"!==this.connectionState&&this.close(),c.getVersionSafari()>=11&&this.onIceConnectionStateCallback()},y.prototype.updateRemoteSDP=function(t){if(!t)throw new Error("sdp string can't be empty.");this.remoteSDP=t},y.prototype.getRemoteSDP=function(){return this.remoteSDP},y.prototype.setRemoteSessionDescription=function(t,h,f){var r=new v({sdp:h,type:t}),m=c.getVersionFirefox();null===m||56!==m&&57!==m||this.delegate.bandwidth?r.sdp=C(r.sdp,"video",this.delegate.bandwidth):r.sdp=C(r.sdp,"video",12288),this.setRemoteDescription(r).then(function(t){f(null)},function(t){f(t)})},y.prototype.addLocalStream=function(t){if(!t)throw new Error("'RTCPeerConnection.addStream' error: stream is 'null'.");this.addStream(t)},y.prototype.getAndSetLocalSessionDescription=function(t,h){var f=this;function r(r){var y,_,C=c.getVersionFirefox();null!==C&&C<55&&2===t&&"offer"===f.type&&(r.sdp=(y=r.sdp,(_=m.parse(y)).groups=_.groups?_.groups:[],_.groups.push({mids:"sdparta_0",type:"BUNDLE"}),m.write(_))),f.setLocalDescription(r).then(function(){h(null)}).catch(function(t){v(t)})}function v(t){h(t)}f.state=y.State.CONNECTING,"offer"===f.type?f.createOffer().then(function(t){t.sdp=C(t.sdp,"video",f.delegate.bandwidth),r(t)}).catch(function(t){v(t)}):f.createAnswer().then(function(t){t.sdp=C(t.sdp,"video",f.delegate.bandwidth),r(t)}).catch(function(t){v(t)})},y.prototype.addCandidates=function(t){for(var h,f=0,r=t.length;f<r;f++)h={sdpMLineIndex:t[f].sdpMLineIndex,sdpMid:t[f].sdpMid,candidate:t[f].candidate},this.addIceCandidate(new _(h),function(){},function(t){c.traceError("Error on 'addIceCandidate': "+t)})},y.prototype.toString=function(){return"sessionID: "+this.sessionID+", userID:  "+this.userID+", type: "+this.type+", state: "+this.state},y.prototype.onSignalingStateCallback=function(){"stable"===this.signalingState&&this.iceCandidates.length>0&&(this.delegate.processIceCandidates(this,this.iceCandidates),this.iceCandidates.length=0)},y.prototype.onIceCandidateCallback=function(t){var h=t.candidate;if(h){var f={sdpMLineIndex:h.sdpMLineIndex,sdpMid:h.sdpMid,candidate:h.candidate};"stable"===this.signalingState?this.delegate.processIceCandidates(this,[f]):this.iceCandidates.push(f)}},y.prototype.onAddRemoteMediaCallback=function(t){"function"==typeof this.delegate._onRemoteStreamListener&&("addstream"===t.type?this.remoteStream=t.stream:this.remoteStream.addTrack(t.track),(1==this.delegate.callType&&this.remoteStream.getVideoTracks().length||2==this.delegate.callType&&this.remoteStream.getAudioTracks().length)&&this.delegate._onRemoteStreamListener(this.userID,this.remoteStream),this._getStatsWrap())},y.prototype.onIceConnectionStateCallback=function(){c.trace("onIceConnectionStateCallback: "+this.iceConnectionState);var t=this;if("function"==typeof this.delegate._onSessionConnectionStateChangedListener){var h=null;switch(c.getVersionSafari()>=11&&clearTimeout(this.onStatusClosedChecker),this.iceConnectionState){case"checking":this.state=y.State.CHECKING,h=c.SessionConnectionState.CONNECTING;break;case"connected":this._clearWaitingReconnectTimer(),this.state=y.State.CONNECTED,h=c.SessionConnectionState.CONNECTED;break;case"completed":this._clearWaitingReconnectTimer(),this.state=y.State.COMPLETED,h=c.SessionConnectionState.COMPLETED;break;case"failed":this.state=y.State.FAILED,h=c.SessionConnectionState.FAILED;break;case"disconnected":this._startWaitingReconnectTimer(),this.state=y.State.DISCONNECTED,h=c.SessionConnectionState.DISCONNECTED,c.getVersionSafari()>=11&&(this.onStatusClosedChecker=setTimeout(function(){t.onIceConnectionStateCallback()},500));break;case"closed":this._clearWaitingReconnectTimer(),this.state=y.State.CLOSED,h=c.SessionConnectionState.CLOSED}h&&t.delegate._onSessionConnectionStateChangedListener(this.userID,h)}},y.prototype._clearStatsReportTimer=function(){this.statsReportTimer&&(clearInterval(this.statsReportTimer),this.statsReportTimer=null)},y.prototype._getStatsWrap=function(){var t,h,f=this;if(r.videochat&&r.videochat.statsReportTimeInterval){if(isNaN(+r.videochat.statsReportTimeInterval))return void c.traceError("statsReportTimeInterval ("+r.videochat.statsReportTimeInterval+") must be integer.");t=1e3*r.videochat.statsReportTimeInterval;c.trace("Stats tracker has been started."),f.statsReportTimer=setInterval(function(){!function(t,h,f,r){var m={local:{audio:{},video:{},candidate:{}},remote:{audio:{},video:{},candidate:{}}};if(c.getVersionFirefox()){var y=t.getLocalStreams().length?t.getLocalStreams()[0]:t.delegate.localStream,v=y.getVideoTracks().length?y.getVideoTracks()[0].getSettings():null;m.local.video.frameHeight=v&&v.height,m.local.video.frameWidth=v&&v.width}function _(t,h,f){var r,c=h&&h.get(t.id),m=c?(t.timestamp-c.timestamp)/1e3:5;return r=c?f?8*(t.bytesSent-c.bytesSent)/(1024*m):8*(t.bytesReceived-c.bytesReceived)/(1024*m):0,Math.round(r)}function C(t,h,f){var r,c=h&&h.get(t.id),m=c?(t.timestamp-c.timestamp)/1e3:5;return r=c?f?(t.framesSent-c.framesSent)/m:(t.framesReceived-c.framesReceived)/m:0,Math.round(10*r)/10}t.getStats(null).then(function(t){t.forEach(function(t){var f;t.bytesReceived&&"inbound-rtp"===t.type?((f=m.remote[t.mediaType]).bitrate=_(t,h,!1),f.bytesReceived=t.bytesReceived,f.packetsReceived=t.packetsReceived,f.timestamp=t.timestamp,"video"===t.mediaType&&t.framerateMean&&(f.framesPerSecond=Math.round(10*t.framerateMean)/10)):t.bytesSent&&"outbound-rtp"===t.type?((f=m.local[t.mediaType]).bitrate=_(t,h,!0),f.bytesSent=t.bytesSent,f.packetsSent=t.packetsSent,f.timestamp=t.timestamp,"video"===t.mediaType&&t.framerateMean&&(f.framesPerSecond=Math.round(10*t.framerateMean)/10)):"local-candidate"===t.type?(f=m.local.candidate,"host"===t.candidateType&&"udp"===t.mozLocalTransport&&"udp"===t.transport?(f.protocol=t.transport,f.ip=t.ipAddress,f.port=t.portNumber):c.getVersionFirefox()||(f.protocol=t.protocol,f.ip=t.ip,f.port=t.port)):"remote-candidate"===t.type?((f=m.remote.candidate).protocol=t.protocol||t.transport,f.ip=t.ip||t.ipAddress,f.port=t.port||t.portNumber):"track"!==t.type||"video"!==t.kind||c.getVersionFirefox()||(t.remoteSource?((f=m.remote.video).frameHeight=t.frameHeight,f.frameWidth=t.frameWidth,f.framesPerSecond=C(t,h,!1)):((f=m.local.video).frameHeight=t.frameHeight,f.frameWidth=t.frameWidth,f.framesPerSecond=C(t,h,!0)))}),f(m,t)},r)}(f,h,function(t,r){h=r,f.delegate._onCallStatsReport(f.userID,t,null)},function(t){c.traceError("_getStats error. "+t.name+": "+t.message),f.delegate._onCallStatsReport(f.userID,null,t)})},t)}},y.prototype._clearWaitingReconnectTimer=function(){this.waitingReconnectTimeoutCallback&&(c.trace("_clearWaitingReconnectTimer"),clearTimeout(this.waitingReconnectTimeoutCallback),this.waitingReconnectTimeoutCallback=null)},y.prototype._startWaitingReconnectTimer=function(){var t=this,h=1e3*r.videochat.disconnectTimeInterval;c.trace("_startWaitingReconnectTimer, timeout: "+h),t.waitingReconnectTimeoutCallback=setTimeout(function(){c.trace("waitingReconnectTimeoutCallback"),clearTimeout(t.waitingReconnectTimeoutCallback),t.release(),t.delegate._closeSessionIfAllConnectionsClosed()},h)},y.prototype._clearDialingTimer=function(){this.dialingTimer&&(c.trace("_clearDialingTimer"),clearInterval(this.dialingTimer),this.dialingTimer=null,this.answerTimeInterval=0)},y.prototype._startDialingTimer=function(t,h){var f=this,m=1e3*r.videochat.dialingTimeInterval;c.trace("_startDialingTimer, dialingTimeInterval: "+m);var y=function(t,h,m){m||(f.answerTimeInterval+=1e3*r.videochat.dialingTimeInterval),c.trace("_dialingCallback, answerTimeInterval: "+f.answerTimeInterval),f.answerTimeInterval>=1e3*r.videochat.answerTimeInterval?(f._clearDialingTimer(),h&&f.delegate.processOnNotAnswer(f)):f.delegate.processCall(f,t)};f.dialingTimer=setInterval(y,m,t,h,!1),y(t,h,!0)},t.exports=y},function(t,h,f){"use strict";var r=function(t){function h(f,r,c){!function(t,h){if(!(t instanceof h))throw new TypeError("Cannot call a class as a function")}(this,h),t.call(this,f),this.listener=r,this.context=c}return function(t,h){if("function"!=typeof h&&null!==h)throw new TypeError("Super expression must either be null or a function, not "+typeof h);t.prototype=Object.create(h&&h.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),h&&(Object.setPrototypeOf?Object.setPrototypeOf(t,h):t.__proto__=h)}(h,t),h}(f(56));t.exports=r},function(t,h,f){"use strict";var r=function(t){};t.exports=function(t,h,f,c,m,y,v,_){if(r(h),!t){var C;if(void 0===h)C=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var w=[f,c,m,y,v,_],T=0;(C=new Error(h.replace(/%s/g,function(){return w[T++]}))).name="Invariant Violation"}throw C.framesToPop=1,C}}},function(t,h,f){"use strict";f.r(h);var r=f(7),c=f.n(r);c.a.init.apply(c.a,[{appId:19,authKey:"JHjjDn53msUDzX3",authSecret:"AAnMKH7N3b4xX79"},{debug:{mode:1}}]);c.a.createSession({id:38120,login:"lemma",password:"youaintguessmypwd"},function(t,h){var f=document.getElementById("printer");f.innerHTML=h?JSON.stringify(h):JSON.stringify(t)})},function(t,h,f){const r=f(1),c=f(0),m=f(3).fetchImpl,y=f(3).formDataImpl;function v(){this.sdkInstance={config:r,session:null},this.currentUserId=null,this.reqCount=0}v.prototype={setSession:function(t){this.sdkInstance.session=t},getSession:function(){return this.sdkInstance.session},setCurrentUserId:function(t){this.currentUserId=t},getCurrentUserId:function(){return this.currentUserId},handleResponse:function(t,h,f,m){c.isExpiredSessionError(t)&&"function"==typeof r.on.sessionExpired?r.on.sessionExpired(function(){f(t,h)},m):t?f(t,null):f(null,h)},logRequest:function(t){let h;++this.reqCount,t.data&&t.data.file?(h=JSON.parse(JSON.stringify(t.data))).file="...":h=c.getEnv().nativescript?JSON.stringify(t.data):t.data,c.DLog("[Request]["+this.reqCount+"]",(t.type||"GET")+" "+t.url,h||"")},ajax:function(t,h){this.logRequest(t);const f=this,v=!t.type||"GET"===t.type||"HEAD"===t.type,_=f.sdkInstance&&f.sdkInstance.session&&f.sdkInstance.session.token,C=-1===t.url.indexOf("s3.amazonaws.com"),w=!1===t.contentType,T=t.dataType||"json";let S,E,A=t.url,R={};function O(t){return encodeURIComponent(t).replace(/[#$&+,\/:;=?@\[\]]/g,function(t){return"%"+t.charCodeAt(0).toString(16)})}function D(m,y,v){const _=y&&(y.status||y.statusCode);let C,w;if(m||200!==_&&201!==_&&202!==_){let T;try{T={code:y&&_||m&&m.code,status:y&&y.headers&&y.headers.status||"error",message:v||m&&m.errno,detail:v&&v.errors||m&&m.syscall}}catch(t){T=m}w=v||m||v.errors,C=c.getEnv().nativescript?JSON.stringify(w):w,c.DLog("[Response]["+f.reqCount+"]","error",_,C),-1===t.url.indexOf(r.urls.session)?f.handleResponse(T,null,h,x):h(T,null)}else w=v&&" "!==v?v:"empty body",C=c.getEnv().nativescript?JSON.stringify(w):w,c.DLog("[Response]["+f.reqCount+"]",C),-1===t.url.indexOf(r.urls.session)?f.handleResponse(null,v,h,x):h(null,v)}function x(r){r&&(f.setSession(r),f.ajax(t,h))}R.method=t.type||"GET",t.data&&(S=function(){const h=t.data;let f;w?(f=new y,Object.keys(h).forEach(function(r){t.fileToCustomObject&&"file"===r?f.append(r,h[r].data,h[r].name):f.append(r,t.data[r])})):f=t.isNeedStringify?JSON.stringify(h):Object.keys(h).map(function(t){return c.isObject(h[t])?Object.keys(h[t]).map(function(f){return O(t)+"["+(c.isArray(h[t])?"":f)+"]="+O(h[t][f])}).sort().join("&"):O(t)+(c.isArray(h[t])?"[]":"")+"="+O(h[t])}).sort().join("&");return f}(),v?A+="?"+S:R.body=S),w||(R.headers={"Content-Type":t.contentType||"application/x-www-form-urlencoded; charset=UTF-8"}),C&&(R.headers||(R.headers={}),R.headers["CB-SDK"]="JS "+r.version+" - Client",_&&(R.headers["CB-Token"]=_)),r.timeout&&(R.timeout=r.timeout),m(A,R).then(function(t){return E=t,"text"===T?t.text():t.json()},function(){return E={status:200}," "}).then(function(t){D(null,E,t)},function(t){D(t)})}},t.exports=v},function(t,h,f){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var r=f(18),c=f(19),m=f(20);function y(){return _.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function v(t,h){if(y()<h)throw new RangeError("Invalid typed array length");return _.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(h)).__proto__=_.prototype:(null===t&&(t=new _(h)),t.length=h),t}function _(t,h,f){if(!(_.TYPED_ARRAY_SUPPORT||this instanceof _))return new _(t,h,f);if("number"==typeof t){if("string"==typeof h)throw new Error("If encoding is specified then the first argument must be a string");return T(this,t)}return C(this,t,h,f)}function C(t,h,f,r){if("number"==typeof h)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&h instanceof ArrayBuffer?function(t,h,f,r){if(h.byteLength,f<0||h.byteLength<f)throw new RangeError("'offset' is out of bounds");if(h.byteLength<f+(r||0))throw new RangeError("'length' is out of bounds");h=void 0===f&&void 0===r?new Uint8Array(h):void 0===r?new Uint8Array(h,f):new Uint8Array(h,f,r);_.TYPED_ARRAY_SUPPORT?(t=h).__proto__=_.prototype:t=S(t,h);return t}(t,h,f,r):"string"==typeof h?function(t,h,f){"string"==typeof f&&""!==f||(f="utf8");if(!_.isEncoding(f))throw new TypeError('"encoding" must be a valid string encoding');var r=0|A(h,f),c=(t=v(t,r)).write(h,f);c!==r&&(t=t.slice(0,c));return t}(t,h,f):function(t,h){if(_.isBuffer(h)){var f=0|E(h.length);return 0===(t=v(t,f)).length?t:(h.copy(t,0,0,f),t)}if(h){if("undefined"!=typeof ArrayBuffer&&h.buffer instanceof ArrayBuffer||"length"in h)return"number"!=typeof h.length||(r=h.length)!=r?v(t,0):S(t,h);if("Buffer"===h.type&&m(h.data))return S(t,h.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,h)}function w(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function T(t,h){if(w(h),t=v(t,h<0?0:0|E(h)),!_.TYPED_ARRAY_SUPPORT)for(var f=0;f<h;++f)t[f]=0;return t}function S(t,h){var f=h.length<0?0:0|E(h.length);t=v(t,f);for(var r=0;r<f;r+=1)t[r]=255&h[r];return t}function E(t){if(t>=y())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+y().toString(16)+" bytes");return 0|t}function A(t,h){if(_.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var f=t.length;if(0===f)return 0;for(var r=!1;;)switch(h){case"ascii":case"latin1":case"binary":return f;case"utf8":case"utf-8":case void 0:return o(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*f;case"hex":return f>>>1;case"base64":return i(t).length;default:if(r)return o(t).length;h=(""+h).toLowerCase(),r=!0}}function R(t,h,f){var r=t[h];t[h]=t[f],t[f]=r}function O(t,h,f,r,c){if(0===t.length)return-1;if("string"==typeof f?(r=f,f=0):f>2147483647?f=2147483647:f<-2147483648&&(f=-2147483648),f=+f,isNaN(f)&&(f=c?0:t.length-1),f<0&&(f=t.length+f),f>=t.length){if(c)return-1;f=t.length-1}else if(f<0){if(!c)return-1;f=0}if("string"==typeof h&&(h=_.from(h,r)),_.isBuffer(h))return 0===h.length?-1:D(t,h,f,r,c);if("number"==typeof h)return h&=255,_.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?c?Uint8Array.prototype.indexOf.call(t,h,f):Uint8Array.prototype.lastIndexOf.call(t,h,f):D(t,[h],f,r,c);throw new TypeError("val must be string, number or Buffer")}function D(t,h,f,r,c){var m,y=1,v=t.length,_=h.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||h.length<2)return-1;y=2,v/=2,_/=2,f/=2}function C(t,h){return 1===y?t[h]:t.readUInt16BE(h*y)}if(c){var w=-1;for(m=f;m<v;m++)if(C(t,m)===C(h,-1===w?0:m-w)){if(-1===w&&(w=m),m-w+1===_)return w*y}else-1!==w&&(m-=m-w),w=-1}else for(f+_>v&&(f=v-_),m=f;m>=0;m--){for(var T=!0,S=0;S<_;S++)if(C(t,m+S)!==C(h,S)){T=!1;break}if(T)return m}return-1}function x(t,h,f,r){f=Number(f)||0;var c=t.length-f;r?(r=Number(r))>c&&(r=c):r=c;var m=h.length;if(m%2!=0)throw new TypeError("Invalid hex string");r>m/2&&(r=m/2);for(var y=0;y<r;++y){var v=parseInt(h.substr(2*y,2),16);if(isNaN(v))return y;t[f+y]=v}return y}function L(t,h,f,r){return g(o(h,t.length-f),t,f,r)}function b(t,h,f,r){return g(function(t){for(var h=[],f=0;f<t.length;++f)h.push(255&t.charCodeAt(f));return h}(h),t,f,r)}function N(t,h,f,r){return b(t,h,f,r)}function M(t,h,f,r){return g(i(h),t,f,r)}function F(t,h,f,r){return g(function(t,h){for(var f,r,c,m=[],y=0;y<t.length&&!((h-=2)<0);++y)f=t.charCodeAt(y),r=f>>8,c=f%256,m.push(c),m.push(r);return m}(h,t.length-f),t,f,r)}function U(t,h,f){return 0===h&&f===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(h,f))}function P(t,h,f){f=Math.min(t.length,f);for(var r=[],c=h;c<f;){var m,y,v,_,C=t[c],w=null,T=C>239?4:C>223?3:C>191?2:1;if(c+T<=f)switch(T){case 1:C<128&&(w=C);break;case 2:128==(192&(m=t[c+1]))&&(_=(31&C)<<6|63&m)>127&&(w=_);break;case 3:m=t[c+1],y=t[c+2],128==(192&m)&&128==(192&y)&&(_=(15&C)<<12|(63&m)<<6|63&y)>2047&&(_<55296||_>57343)&&(w=_);break;case 4:m=t[c+1],y=t[c+2],v=t[c+3],128==(192&m)&&128==(192&y)&&128==(192&v)&&(_=(15&C)<<18|(63&m)<<12|(63&y)<<6|63&v)>65535&&_<1114112&&(w=_)}null===w?(w=65533,T=1):w>65535&&(w-=65536,r.push(w>>>10&1023|55296),w=56320|1023&w),r.push(w),c+=T}return function(t){var h=t.length;if(h<=B)return String.fromCharCode.apply(String,t);var f="",r=0;for(;r<h;)f+=String.fromCharCode.apply(String,t.slice(r,r+=B));return f}(r)}h.Buffer=_,h.SlowBuffer=function(t){+t!=t&&(t=0);return _.alloc(+t)},h.INSPECT_MAX_BYTES=50,_.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),h.kMaxLength=y(),_.poolSize=8192,_._augment=function(t){return t.__proto__=_.prototype,t},_.from=function(t,h,f){return C(null,t,h,f)},_.TYPED_ARRAY_SUPPORT&&(_.prototype.__proto__=Uint8Array.prototype,_.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&_[Symbol.species]===_&&Object.defineProperty(_,Symbol.species,{value:null,configurable:!0})),_.alloc=function(t,h,f){return function(t,h,f,r){return w(h),h<=0?v(t,h):void 0!==f?"string"==typeof r?v(t,h).fill(f,r):v(t,h).fill(f):v(t,h)}(null,t,h,f)},_.allocUnsafe=function(t){return T(null,t)},_.allocUnsafeSlow=function(t){return T(null,t)},_.isBuffer=function(t){return!(null==t||!t._isBuffer)},_.compare=function(t,h){if(!_.isBuffer(t)||!_.isBuffer(h))throw new TypeError("Arguments must be Buffers");if(t===h)return 0;for(var f=t.length,r=h.length,c=0,m=Math.min(f,r);c<m;++c)if(t[c]!==h[c]){f=t[c],r=h[c];break}return f<r?-1:r<f?1:0},_.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},_.concat=function(t,h){if(!m(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return _.alloc(0);var f;if(void 0===h)for(h=0,f=0;f<t.length;++f)h+=t[f].length;var r=_.allocUnsafe(h),c=0;for(f=0;f<t.length;++f){var y=t[f];if(!_.isBuffer(y))throw new TypeError('"list" argument must be an Array of Buffers');y.copy(r,c),c+=y.length}return r},_.byteLength=A,_.prototype._isBuffer=!0,_.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var h=0;h<t;h+=2)R(this,h,h+1);return this},_.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var h=0;h<t;h+=4)R(this,h,h+3),R(this,h+1,h+2);return this},_.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var h=0;h<t;h+=8)R(this,h,h+7),R(this,h+1,h+6),R(this,h+2,h+5),R(this,h+3,h+4);return this},_.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?P(this,0,t):function(t,h,f){var r=!1;if((void 0===h||h<0)&&(h=0),h>this.length)return"";if((void 0===f||f>this.length)&&(f=this.length),f<=0)return"";if((f>>>=0)<=(h>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return X(this,h,f);case"utf8":case"utf-8":return P(this,h,f);case"ascii":return q(this,h,f);case"latin1":case"binary":return z(this,h,f);case"base64":return U(this,h,f);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return W(this,h,f);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}.apply(this,arguments)},_.prototype.equals=function(t){if(!_.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===_.compare(this,t)},_.prototype.inspect=function(){var t="",f=h.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,f).match(/.{2}/g).join(" "),this.length>f&&(t+=" ... ")),"<Buffer "+t+">"},_.prototype.compare=function(t,h,f,r,c){if(!_.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===h&&(h=0),void 0===f&&(f=t?t.length:0),void 0===r&&(r=0),void 0===c&&(c=this.length),h<0||f>t.length||r<0||c>this.length)throw new RangeError("out of range index");if(r>=c&&h>=f)return 0;if(r>=c)return-1;if(h>=f)return 1;if(this===t)return 0;for(var m=(c>>>=0)-(r>>>=0),y=(f>>>=0)-(h>>>=0),v=Math.min(m,y),C=this.slice(r,c),w=t.slice(h,f),T=0;T<v;++T)if(C[T]!==w[T]){m=C[T],y=w[T];break}return m<y?-1:y<m?1:0},_.prototype.includes=function(t,h,f){return-1!==this.indexOf(t,h,f)},_.prototype.indexOf=function(t,h,f){return O(this,t,h,f,!0)},_.prototype.lastIndexOf=function(t,h,f){return O(this,t,h,f,!1)},_.prototype.write=function(t,h,f,r){if(void 0===h)r="utf8",f=this.length,h=0;else if(void 0===f&&"string"==typeof h)r=h,f=this.length,h=0;else{if(!isFinite(h))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");h|=0,isFinite(f)?(f|=0,void 0===r&&(r="utf8")):(r=f,f=void 0)}var c=this.length-h;if((void 0===f||f>c)&&(f=c),t.length>0&&(f<0||h<0)||h>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var m=!1;;)switch(r){case"hex":return x(this,t,h,f);case"utf8":case"utf-8":return L(this,t,h,f);case"ascii":return b(this,t,h,f);case"latin1":case"binary":return N(this,t,h,f);case"base64":return M(this,t,h,f);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return F(this,t,h,f);default:if(m)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),m=!0}},_.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var B=4096;function q(t,h,f){var r="";f=Math.min(t.length,f);for(var c=h;c<f;++c)r+=String.fromCharCode(127&t[c]);return r}function z(t,h,f){var r="";f=Math.min(t.length,f);for(var c=h;c<f;++c)r+=String.fromCharCode(t[c]);return r}function X(t,h,f){var r=t.length;(!h||h<0)&&(h=0),(!f||f<0||f>r)&&(f=r);for(var c="",m=h;m<f;++m)c+=I(t[m]);return c}function W(t,h,f){for(var r=t.slice(h,f),c="",m=0;m<r.length;m+=2)c+=String.fromCharCode(r[m]+256*r[m+1]);return c}function G(t,h,f){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+h>f)throw new RangeError("Trying to access beyond buffer length")}function V(t,h,f,r,c,m){if(!_.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(h>c||h<m)throw new RangeError('"value" argument is out of bounds');if(f+r>t.length)throw new RangeError("Index out of range")}function Y(t,h,f,r){h<0&&(h=65535+h+1);for(var c=0,m=Math.min(t.length-f,2);c<m;++c)t[f+c]=(h&255<<8*(r?c:1-c))>>>8*(r?c:1-c)}function K(t,h,f,r){h<0&&(h=4294967295+h+1);for(var c=0,m=Math.min(t.length-f,4);c<m;++c)t[f+c]=h>>>8*(r?c:3-c)&255}function $(t,h,f,r,c,m){if(f+r>t.length)throw new RangeError("Index out of range");if(f<0)throw new RangeError("Index out of range")}function Q(t,h,f,r,m){return m||$(t,0,f,4),c.write(t,h,f,r,23,4),f+4}function Z(t,h,f,r,m){return m||$(t,0,f,8),c.write(t,h,f,r,52,8),f+8}_.prototype.slice=function(t,h){var f,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(h=void 0===h?r:~~h)<0?(h+=r)<0&&(h=0):h>r&&(h=r),h<t&&(h=t),_.TYPED_ARRAY_SUPPORT)(f=this.subarray(t,h)).__proto__=_.prototype;else{var c=h-t;f=new _(c,void 0);for(var m=0;m<c;++m)f[m]=this[m+t]}return f},_.prototype.readUIntLE=function(t,h,f){t|=0,h|=0,f||G(t,h,this.length);for(var r=this[t],c=1,m=0;++m<h&&(c*=256);)r+=this[t+m]*c;return r},_.prototype.readUIntBE=function(t,h,f){t|=0,h|=0,f||G(t,h,this.length);for(var r=this[t+--h],c=1;h>0&&(c*=256);)r+=this[t+--h]*c;return r},_.prototype.readUInt8=function(t,h){return h||G(t,1,this.length),this[t]},_.prototype.readUInt16LE=function(t,h){return h||G(t,2,this.length),this[t]|this[t+1]<<8},_.prototype.readUInt16BE=function(t,h){return h||G(t,2,this.length),this[t]<<8|this[t+1]},_.prototype.readUInt32LE=function(t,h){return h||G(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},_.prototype.readUInt32BE=function(t,h){return h||G(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},_.prototype.readIntLE=function(t,h,f){t|=0,h|=0,f||G(t,h,this.length);for(var r=this[t],c=1,m=0;++m<h&&(c*=256);)r+=this[t+m]*c;return r>=(c*=128)&&(r-=Math.pow(2,8*h)),r},_.prototype.readIntBE=function(t,h,f){t|=0,h|=0,f||G(t,h,this.length);for(var r=h,c=1,m=this[t+--r];r>0&&(c*=256);)m+=this[t+--r]*c;return m>=(c*=128)&&(m-=Math.pow(2,8*h)),m},_.prototype.readInt8=function(t,h){return h||G(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},_.prototype.readInt16LE=function(t,h){h||G(t,2,this.length);var f=this[t]|this[t+1]<<8;return 32768&f?4294901760|f:f},_.prototype.readInt16BE=function(t,h){h||G(t,2,this.length);var f=this[t+1]|this[t]<<8;return 32768&f?4294901760|f:f},_.prototype.readInt32LE=function(t,h){return h||G(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},_.prototype.readInt32BE=function(t,h){return h||G(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},_.prototype.readFloatLE=function(t,h){return h||G(t,4,this.length),c.read(this,t,!0,23,4)},_.prototype.readFloatBE=function(t,h){return h||G(t,4,this.length),c.read(this,t,!1,23,4)},_.prototype.readDoubleLE=function(t,h){return h||G(t,8,this.length),c.read(this,t,!0,52,8)},_.prototype.readDoubleBE=function(t,h){return h||G(t,8,this.length),c.read(this,t,!1,52,8)},_.prototype.writeUIntLE=function(t,h,f,r){(t=+t,h|=0,f|=0,r)||V(this,t,h,f,Math.pow(2,8*f)-1,0);var c=1,m=0;for(this[h]=255&t;++m<f&&(c*=256);)this[h+m]=t/c&255;return h+f},_.prototype.writeUIntBE=function(t,h,f,r){(t=+t,h|=0,f|=0,r)||V(this,t,h,f,Math.pow(2,8*f)-1,0);var c=f-1,m=1;for(this[h+c]=255&t;--c>=0&&(m*=256);)this[h+c]=t/m&255;return h+f},_.prototype.writeUInt8=function(t,h,f){return t=+t,h|=0,f||V(this,t,h,1,255,0),_.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[h]=255&t,h+1},_.prototype.writeUInt16LE=function(t,h,f){return t=+t,h|=0,f||V(this,t,h,2,65535,0),_.TYPED_ARRAY_SUPPORT?(this[h]=255&t,this[h+1]=t>>>8):Y(this,t,h,!0),h+2},_.prototype.writeUInt16BE=function(t,h,f){return t=+t,h|=0,f||V(this,t,h,2,65535,0),_.TYPED_ARRAY_SUPPORT?(this[h]=t>>>8,this[h+1]=255&t):Y(this,t,h,!1),h+2},_.prototype.writeUInt32LE=function(t,h,f){return t=+t,h|=0,f||V(this,t,h,4,4294967295,0),_.TYPED_ARRAY_SUPPORT?(this[h+3]=t>>>24,this[h+2]=t>>>16,this[h+1]=t>>>8,this[h]=255&t):K(this,t,h,!0),h+4},_.prototype.writeUInt32BE=function(t,h,f){return t=+t,h|=0,f||V(this,t,h,4,4294967295,0),_.TYPED_ARRAY_SUPPORT?(this[h]=t>>>24,this[h+1]=t>>>16,this[h+2]=t>>>8,this[h+3]=255&t):K(this,t,h,!1),h+4},_.prototype.writeIntLE=function(t,h,f,r){if(t=+t,h|=0,!r){var c=Math.pow(2,8*f-1);V(this,t,h,f,c-1,-c)}var m=0,y=1,v=0;for(this[h]=255&t;++m<f&&(y*=256);)t<0&&0===v&&0!==this[h+m-1]&&(v=1),this[h+m]=(t/y>>0)-v&255;return h+f},_.prototype.writeIntBE=function(t,h,f,r){if(t=+t,h|=0,!r){var c=Math.pow(2,8*f-1);V(this,t,h,f,c-1,-c)}var m=f-1,y=1,v=0;for(this[h+m]=255&t;--m>=0&&(y*=256);)t<0&&0===v&&0!==this[h+m+1]&&(v=1),this[h+m]=(t/y>>0)-v&255;return h+f},_.prototype.writeInt8=function(t,h,f){return t=+t,h|=0,f||V(this,t,h,1,127,-128),_.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[h]=255&t,h+1},_.prototype.writeInt16LE=function(t,h,f){return t=+t,h|=0,f||V(this,t,h,2,32767,-32768),_.TYPED_ARRAY_SUPPORT?(this[h]=255&t,this[h+1]=t>>>8):Y(this,t,h,!0),h+2},_.prototype.writeInt16BE=function(t,h,f){return t=+t,h|=0,f||V(this,t,h,2,32767,-32768),_.TYPED_ARRAY_SUPPORT?(this[h]=t>>>8,this[h+1]=255&t):Y(this,t,h,!1),h+2},_.prototype.writeInt32LE=function(t,h,f){return t=+t,h|=0,f||V(this,t,h,4,2147483647,-2147483648),_.TYPED_ARRAY_SUPPORT?(this[h]=255&t,this[h+1]=t>>>8,this[h+2]=t>>>16,this[h+3]=t>>>24):K(this,t,h,!0),h+4},_.prototype.writeInt32BE=function(t,h,f){return t=+t,h|=0,f||V(this,t,h,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),_.TYPED_ARRAY_SUPPORT?(this[h]=t>>>24,this[h+1]=t>>>16,this[h+2]=t>>>8,this[h+3]=255&t):K(this,t,h,!1),h+4},_.prototype.writeFloatLE=function(t,h,f){return Q(this,t,h,!0,f)},_.prototype.writeFloatBE=function(t,h,f){return Q(this,t,h,!1,f)},_.prototype.writeDoubleLE=function(t,h,f){return Z(this,t,h,!0,f)},_.prototype.writeDoubleBE=function(t,h,f){return Z(this,t,h,!1,f)},_.prototype.copy=function(t,h,f,r){if(f||(f=0),r||0===r||(r=this.length),h>=t.length&&(h=t.length),h||(h=0),r>0&&r<f&&(r=f),r===f)return 0;if(0===t.length||0===this.length)return 0;if(h<0)throw new RangeError("targetStart out of bounds");if(f<0||f>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-h<r-f&&(r=t.length-h+f);var c,m=r-f;if(this===t&&f<h&&h<r)for(c=m-1;c>=0;--c)t[c+h]=this[c+f];else if(m<1e3||!_.TYPED_ARRAY_SUPPORT)for(c=0;c<m;++c)t[c+h]=this[c+f];else Uint8Array.prototype.set.call(t,this.subarray(f,f+m),h);return m},_.prototype.fill=function(t,h,f,r){if("string"==typeof t){if("string"==typeof h?(r=h,h=0,f=this.length):"string"==typeof f&&(r=f,f=this.length),1===t.length){var c=t.charCodeAt(0);c<256&&(t=c)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!_.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(h<0||this.length<h||this.length<f)throw new RangeError("Out of range index");if(f<=h)return this;var m;if(h>>>=0,f=void 0===f?this.length:f>>>0,t||(t=0),"number"==typeof t)for(m=h;m<f;++m)this[m]=t;else{var y=_.isBuffer(t)?t:o(new _(t,r).toString()),v=y.length;for(m=0;m<f-h;++m)this[m+h]=y[m%v]}return this};var k=/[^+\/0-9A-Za-z-_]/g;function I(t){return t<16?"0"+t.toString(16):t.toString(16)}function o(t,h){var f;h=h||1/0;for(var r=t.length,c=null,m=[],y=0;y<r;++y){if((f=t.charCodeAt(y))>55295&&f<57344){if(!c){if(f>56319){(h-=3)>-1&&m.push(239,191,189);continue}if(y+1===r){(h-=3)>-1&&m.push(239,191,189);continue}c=f;continue}if(f<56320){(h-=3)>-1&&m.push(239,191,189),c=f;continue}f=65536+(c-55296<<10|f-56320)}else c&&(h-=3)>-1&&m.push(239,191,189);if(c=null,f<128){if((h-=1)<0)break;m.push(f)}else if(f<2048){if((h-=2)<0)break;m.push(f>>6|192,63&f|128)}else if(f<65536){if((h-=3)<0)break;m.push(f>>12|224,f>>6&63|128,63&f|128)}else{if(!(f<1114112))throw new Error("Invalid code point");if((h-=4)<0)break;m.push(f>>18|240,f>>12&63|128,f>>6&63|128,63&f|128)}}return m}function i(t){return r.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(k,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function g(t,h,f,r){for(var c=0;c<r&&!(c+f>=h.length||c>=t.length);++c)h[c+f]=t[c];return c}}).call(this,f(8))},function(t,h,f){"use strict";h.byteLength=function(t){return 3*t.length/4-C(t)},h.toByteArray=function(t){var h,f,r,y,v,_,w=t.length;v=C(t),_=new m(3*w/4-v),r=v>0?w-4:w;var T=0;for(h=0,f=0;h<r;h+=4,f+=3)y=c[t.charCodeAt(h)]<<18|c[t.charCodeAt(h+1)]<<12|c[t.charCodeAt(h+2)]<<6|c[t.charCodeAt(h+3)],_[T++]=y>>16&255,_[T++]=y>>8&255,_[T++]=255&y;2===v?(y=c[t.charCodeAt(h)]<<2|c[t.charCodeAt(h+1)]>>4,_[T++]=255&y):1===v&&(y=c[t.charCodeAt(h)]<<10|c[t.charCodeAt(h+1)]<<4|c[t.charCodeAt(h+2)]>>2,_[T++]=y>>8&255,_[T++]=255&y);return _},h.fromByteArray=function(t){for(var h,f=t.length,c=f%3,m="",y=[],v=0,_=f-c;v<_;v+=16383)y.push(w(t,v,v+16383>_?_:v+16383));1===c?(h=t[f-1],m+=r[h>>2],m+=r[h<<4&63],m+="=="):2===c&&(h=(t[f-2]<<8)+t[f-1],m+=r[h>>10],m+=r[h>>4&63],m+=r[h<<2&63],m+="=");return y.push(m),y.join("")};for(var r=[],c=[],m="undefined"!=typeof Uint8Array?Uint8Array:Array,y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",v=0,_=y.length;v<_;++v)r[v]=y[v],c[y.charCodeAt(v)]=v;function C(t){var h=t.length;if(h%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===t[h-2]?2:"="===t[h-1]?1:0}function w(t,h,f){for(var c,m,y=[],v=h;v<f;v+=3)c=(t[v]<<16)+(t[v+1]<<8)+t[v+2],y.push(r[(m=c)>>18&63]+r[m>>12&63]+r[m>>6&63]+r[63&m]);return y.join("")}c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63},function(t,h){h.read=function(t,h,f,r,c){var m,y,v=8*c-r-1,_=(1<<v)-1,C=_>>1,w=-7,T=f?c-1:0,S=f?-1:1,E=t[h+T];for(T+=S,m=E&(1<<-w)-1,E>>=-w,w+=v;w>0;m=256*m+t[h+T],T+=S,w-=8);for(y=m&(1<<-w)-1,m>>=-w,w+=r;w>0;y=256*y+t[h+T],T+=S,w-=8);if(0===m)m=1-C;else{if(m===_)return y?NaN:1/0*(E?-1:1);y+=Math.pow(2,r),m-=C}return(E?-1:1)*y*Math.pow(2,m-r)},h.write=function(t,h,f,r,c,m){var y,v,_,C=8*m-c-1,w=(1<<C)-1,T=w>>1,S=23===c?Math.pow(2,-24)-Math.pow(2,-77):0,E=r?0:m-1,A=r?1:-1,R=h<0||0===h&&1/h<0?1:0;for(h=Math.abs(h),isNaN(h)||h===1/0?(v=isNaN(h)?1:0,y=w):(y=Math.floor(Math.log(h)/Math.LN2),h*(_=Math.pow(2,-y))<1&&(y--,_*=2),(h+=y+T>=1?S/_:S*Math.pow(2,1-T))*_>=2&&(y++,_/=2),y+T>=w?(v=0,y=w):y+T>=1?(v=(h*_-1)*Math.pow(2,c),y+=T):(v=h*Math.pow(2,T-1)*Math.pow(2,c),y=0));c>=8;t[f+E]=255&v,E+=A,v/=256,c-=8);for(y=y<<c|v,C+=c;C>0;t[f+E]=255&y,E+=A,y/=256,C-=8);t[f+E-A]|=128*R}},function(t,h){var f={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==f.call(t)}},function(t,h,f){var r;window,r=function(){return function(t){var h={};function f(r){if(h[r])return h[r].exports;var c=h[r]={i:r,l:!1,exports:{}};return t[r].call(c.exports,c,c.exports,f),c.l=!0,c.exports}return f.m=t,f.c=h,f.d=function(t,h,r){f.o(t,h)||Object.defineProperty(t,h,{enumerable:!0,get:r})},f.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},f.t=function(t,h){if(1&h&&(t=f(t)),8&h)return t;if(4&h&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(f.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&h&&"string"!=typeof t)for(var c in t)f.d(r,c,function(h){return t[h]}.bind(null,c));return r},f.n=function(t){var h=t&&t.__esModule?function(){return t.default}:function(){return t};return f.d(h,"a",h),h},f.o=function(t,h){return Object.prototype.hasOwnProperty.call(t,h)},f.p="",f(f.s="./src/strophe.js")}({"./node_modules/webpack/buildin/global.js":
/*!***********************************!*\
  !*** (webpack)/buildin/global.js ***!
  \***********************************/
/*! no static exports found */function(t,h){var f;f=function(){return this}();try{f=f||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(f=window)}t.exports=f},"./src/bosh.js":
/*!*********************!*\
  !*** ./src/bosh.js ***!
  \*********************/
/*! no exports provided */function(t,h,f){"use strict";f.r(h);var r=f(/*! core */"./src/core.js"),c=r.default.Strophe,m=r.default.$build;c.Request=function(t,h,f,r){this.id=++c._requestId,this.xmlData=t,this.data=c.serialize(t),this.origFunc=h,this.func=h,this.rid=f,this.date=NaN,this.sends=r||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()},c.Request.prototype={getResponse:function(){var t=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if("parsererror"===(t=this.xhr.responseXML.documentElement).tagName)throw c.error("invalid response received"),c.error("responseText: "+this.xhr.responseText),c.error("responseXML: "+c.serialize(this.xhr.responseXML)),new Error("parsererror")}else if(this.xhr.responseText){if(c.debug("Got responseText but no responseXML; attempting to parse it with DOMParser..."),!(t=(new DOMParser).parseFromString(this.xhr.responseText,"application/xml").documentElement))throw new Error("Parsing produced null node");if(t.querySelector("parsererror")){c.error("invalid response received: "+t.querySelector("parsererror").textContent),c.error("responseText: "+this.xhr.responseText);var h=new Error;throw h.name=c.ErrorCondition.BAD_FORMAT,h}}return t},_newXHR:function(){var t=null;return window.XMLHttpRequest?(t=new XMLHttpRequest).overrideMimeType&&t.overrideMimeType("text/xml; charset=utf-8"):window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLHTTP")),t.onreadystatechange=this.func.bind(null,this),t}},c.Bosh=function(t){this._conn=t,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.lastResponseHeaders=null,this._requests=[]},c.Bosh.prototype={strip:null,_buildBody:function(){var t=m("body",{rid:this.rid++,xmlns:c.NS.HTTPBIND});return null!==this.sid&&t.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),t},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(t,h,f){this.wait=t||this.wait,this.hold=h||this.hold,this.errors=0;var r=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":c.NS.BOSH});f&&r.attrs({route:f});var m=this._conn._connect_cb;this._requests.push(new c.Request(r.tree(),this._onRequestStateChange.bind(this,m.bind(this._conn)),r.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(t,h,f,r,m,y,v){this._conn.jid=t,this.sid=h,this.rid=f,this._conn.connect_callback=r,this._conn.domain=c.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=m||this.wait,this.hold=y||this.hold,this.window=v||this.window,this._conn._changeConnectStatus(c.Status.ATTACHED,null)},_restore:function(t,h,f,r,m){var y=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(null!=y&&y.rid&&y.sid&&y.jid&&(null==t||c.getBareJidFromJid(y.jid)===c.getBareJidFromJid(t)||null===c.getNodeFromJid(t)&&c.getDomainFromJid(y.jid)===t))){var v=new Error("_restore: no restoreable session.");throw v.name="StropheSessionError",v}this._conn.restored=!0,this._attach(y.jid,y.sid,y.rid,h,f,r,m)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(t){var h=t.getAttribute("type");if(null!==h&&"terminate"===h){var f=t.getAttribute("condition");c.error("BOSH-Connection failed: "+f);var r=t.getElementsByTagName("conflict");return null!==f?("remote-stream-error"===f&&r.length>0&&(f="conflict"),this._conn._changeConnectStatus(c.Status.CONNFAIL,f)):this._conn._changeConnectStatus(c.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(f),c.Status.CONNFAIL}this.sid||(this.sid=t.getAttribute("sid"));var m=t.getAttribute("requests");m&&(this.window=parseInt(m,10));var y=t.getAttribute("hold");y&&(this.hold=parseInt(y,10));var v=t.getAttribute("wait");v&&(this.wait=parseInt(v,10));var _=t.getAttribute("inactivity");_&&(this.inactivity=parseInt(_,10))},_disconnect:function(t){this._sendTerminate(t)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_callProtocolErrorHandlers:function(t){var h=this._getRequestStatus(t),f=this._conn.protocolErrorHandlers.HTTP[h];f&&f.call(this,h)},_hitError:function(t){this.errors++,c.warn("request errored, status: "+t+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()},_no_auth_received:function(t){c.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),t=t?t.bind(this._conn):this._conn._connect_cb.bind(this._conn);var h=this._buildBody();this._requests.push(new c.Request(h.tree(),this._onRequestStateChange.bind(this,t),h.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(;this._requests.length>0;){var t=this._requests.pop();t.abort=!0,t.xhr.abort(),t.xhr.onreadystatechange=function(){}}},_onIdle:function(){var t=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===t.length&&!this._conn.disconnecting&&(c.info("no requests during idle cycle, sending blank request"),t.push(null)),!this._conn.paused){if(this._requests.length<2&&t.length>0){for(var h=this._buildBody(),f=0;f<t.length;f++)null!==t[f]&&("restart"===t[f]?h.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":c.NS.BOSH}):h.cnode(t[f]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new c.Request(h.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),h.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var r=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(c.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),r>Math.floor(c.TIMEOUT*this.wait)&&(c.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(c.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_getRequestStatus:function(t,h){var f;if(4===t.xhr.readyState)try{f=t.xhr.status}catch(t){c.error("Caught an error while retrieving a request's status, reqStatus: "+f)}return void 0===f&&(f="number"==typeof h?h:0),f},_onRequestStateChange:function(t,h){if(c.debug("request id "+h.id+"."+h.sends+" state changed to "+h.xhr.readyState),h.abort)h.abort=!1;else if(4===h.xhr.readyState){var f=this._getRequestStatus(h);if(this.lastResponseHeaders=h.xhr.getAllResponseHeaders(),this.disconnecting&&f>=400)return this._hitError(f),void this._callProtocolErrorHandlers(h);var r=f>0&&f<500,m=h.sends>this._conn.maxRetries;if((r||m)&&(this._removeRequest(h),c.debug("request id "+h.id+" should now be removed")),200===f){var y=this._requests[0]===h;(this._requests[1]===h||y&&this._requests.length>0&&this._requests[0].age()>Math.floor(c.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(h.rid)+1),c.debug("request id "+h.id+"."+h.sends+" got 200"),t(h),this.errors=0}else 0===f||f>=400&&f<600||f>=12e3?(c.error("request id "+h.id+"."+h.sends+" error "+f+" happened"),this._hitError(f),this._callProtocolErrorHandlers(h),f>=400&&f<500&&(this._conn._changeConnectStatus(c.Status.DISCONNECTING,null),this._conn._doDisconnect())):c.error("request id "+h.id+"."+h.sends+" error "+f+" happened");r||m?m&&!this._conn.connected&&this._conn._changeConnectStatus(c.Status.CONNFAIL,"giving-up"):this._throttledRequestHandler()}},_processRequest:function(t){var h=this,f=this._requests[t],r=this._getRequestStatus(f,-1);if(f.sends>this._conn.maxRetries)this._conn._onDisconnectTimeout();else{var m=f.age(),y=!isNaN(m)&&m>Math.floor(c.TIMEOUT*this.wait),v=null!==f.dead&&f.timeDead()>Math.floor(c.SECONDARY_TIMEOUT*this.wait),_=4===f.xhr.readyState&&(r<1||r>=500);if((y||v||_)&&(v&&c.error("Request ".concat(this._requests[t].id," timed out (secondary), restarting")),f.abort=!0,f.xhr.abort(),f.xhr.onreadystatechange=function(){},this._requests[t]=new c.Request(f.xmlData,f.origFunc,f.rid,f.sends),f=this._requests[t]),0===f.xhr.readyState){c.debug("request id "+f.id+"."+f.sends+" posting");try{var C=this._conn.options.contentType||"text/xml; charset=utf-8";f.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==f.xhr.setRequestHeader&&f.xhr.setRequestHeader("Content-Type",C),this._conn.options.withCredentials&&(f.xhr.withCredentials=!0)}catch(t){return c.error("XHR open failed: "+t.toString()),this._conn.connected||this._conn._changeConnectStatus(c.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var w=function(){if(f.date=new Date,h._conn.options.customHeaders){var t=h._conn.options.customHeaders;for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&f.xhr.setRequestHeader(r,t[r])}f.xhr.send(f.data)};if(f.sends>1){var T=1e3*Math.min(Math.floor(c.TIMEOUT*this.wait),Math.pow(f.sends,3));setTimeout(function(){w()},T)}else w();f.sends++,this._conn.xmlOutput!==c.Connection.prototype.xmlOutput&&(f.xmlData.nodeName===this.strip&&f.xmlData.childNodes.length?this._conn.xmlOutput(f.xmlData.childNodes[0]):this._conn.xmlOutput(f.xmlData)),this._conn.rawOutput!==c.Connection.prototype.rawOutput&&this._conn.rawOutput(f.data)}else c.debug("_processRequest: "+(0===t?"first":"second")+" request has readyState of "+f.xhr.readyState)}},_removeRequest:function(t){c.debug("removing request");for(var h=this._requests.length-1;h>=0;h--)t===this._requests[h]&&this._requests.splice(h,1);t.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(t){var h=this._requests[t];null===h.dead&&(h.dead=new Date),this._processRequest(t)},_reqToData:function(t){try{return t.getResponse()}catch(t){if("parsererror"!==t.message)throw t;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(t){c.info("_sendTerminate was called");var h=this._buildBody().attrs({type:"terminate"});t&&h.cnode(t.tree());var f=new c.Request(h.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),h.tree().getAttribute("rid"));this._requests.push(f),this._throttledRequestHandler()},_send:function(){var t=this;clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(function(){return t._conn._onIdle()},100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?c.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):c.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}}},"./src/core.js":
/*!*********************!*\
  !*** ./src/core.js ***!
  \*********************/
/*! exports provided: Strophe, $build, $iq, $msg, $pres, SHA1, MD5, default */function(t,h,f){"use strict";f.r(h),f.d(h,"Strophe",function(){return S}),f.d(h,"$build",function(){return _}),f.d(h,"$iq",function(){return w}),f.d(h,"$msg",function(){return C}),f.d(h,"$pres",function(){return T});var r=f(/*! md5 */"./src/md5.js");f.d(h,"MD5",function(){return r.default});var c=f(/*! sha1 */"./src/sha1.js");f.d(h,"SHA1",function(){return c.default});var m=f(/*! utils */"./src/utils.js");function y(t){return function(t){if(Array.isArray(t)){for(var h=0,f=new Array(t.length);h<t.length;h++)f[h]=t[h];return f}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function v(t){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _(t,h){return new S.Builder(t,h)}function C(t){return new S.Builder("message",t)}function w(t){return new S.Builder("iq",t)}function T(t){return new S.Builder("presence",t)}var S={VERSION:"1.3.1",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(t){for(var h=0;h<S.XHTML.tags.length;h++)if(t===S.XHTML.tags[h])return!0;return!1},validAttribute:function(t,h){if(void 0!==S.XHTML.attributes[t]&&S.XHTML.attributes[t].length>0)for(var f=0;f<S.XHTML.attributes[t].length;f++)if(h===S.XHTML.attributes[t][f])return!0;return!1},validCSS:function(t){for(var h=0;h<S.XHTML.css.length;h++)if(t===S.XHTML.css[h])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},ErrorCondition:{BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(t,h){S.NS[t]=h},forEachChild:function(t,h,f){for(var r=0;r<t.childNodes.length;r++){var c=t.childNodes[r];c.nodeType!==S.ElementType.NORMAL||h&&!this.isTagEqual(c,h)||f(c)}},isTagEqual:function(t,h){return t.tagName===h},_xmlGenerator:null,_makeGenerator:function(){var t;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(t=this._getIEXmlDom()).appendChild(t.createElement("strophe")):t=document.implementation.createDocument("jabber:client","strophe",null),t},xmlGenerator:function(){return S._xmlGenerator||(S._xmlGenerator=S._makeGenerator()),S._xmlGenerator},_getIEXmlDom:function(){for(var t=null,h=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],f=0;f<h.length&&null===t;f++)try{t=new ActiveXObject(h[f])}catch(h){t=null}return t},xmlElement:function(t){if(!t)return null;for(var h=S.xmlGenerator().createElement(t),f=1;f<arguments.length;f++){var r=arguments[f];if(r)if("string"==typeof r||"number"==typeof r)h.appendChild(S.xmlTextNode(r));else if("object"===v(r)&&"function"==typeof r.sort)for(var c=0;c<r.length;c++){var m=r[c];"object"===v(m)&&"function"==typeof m.sort&&void 0!==m[1]&&null!==m[1]&&h.setAttribute(m[0],m[1])}else if("object"===v(r))for(var y in r)Object.prototype.hasOwnProperty.call(r,y)&&void 0!==r[y]&&null!==r[y]&&h.setAttribute(y,r[y])}return h},xmlescape:function(t){return t=(t=(t=(t=(t=t.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")},xmlunescape:function(t){return t=(t=(t=(t=(t=t.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')},xmlTextNode:function(t){return S.xmlGenerator().createTextNode(t)},xmlHtmlNode:function(t){var h;DOMParser?h=(new DOMParser).parseFromString(t,"text/xml"):((h=new ActiveXObject("Microsoft.XMLDOM")).async="false",h.loadXML(t));return h},getText:function(t){if(!t)return null;var h="";0===t.childNodes.length&&t.nodeType===S.ElementType.TEXT&&(h+=t.nodeValue);for(var f=0;f<t.childNodes.length;f++)t.childNodes[f].nodeType===S.ElementType.TEXT&&(h+=t.childNodes[f].nodeValue);return S.xmlescape(h)},copyElement:function(t){var h;if(t.nodeType===S.ElementType.NORMAL){h=S.xmlElement(t.tagName);for(var f=0;f<t.attributes.length;f++)h.setAttribute(t.attributes[f].nodeName,t.attributes[f].value);for(var r=0;r<t.childNodes.length;r++)h.appendChild(S.copyElement(t.childNodes[r]))}else t.nodeType===S.ElementType.TEXT&&(h=S.xmlGenerator().createTextNode(t.nodeValue));return h},createHtml:function(t){var h;if(t.nodeType===S.ElementType.NORMAL){var f=t.nodeName.toLowerCase();if(S.XHTML.validTag(f))try{h=S.xmlElement(f);for(var r=0;r<S.XHTML.attributes[f].length;r++){var c=S.XHTML.attributes[f][r],m=t.getAttribute(c);if(null!=m&&""!==m&&!1!==m&&0!==m)if("style"===c&&"object"===v(m)&&void 0!==m.cssText&&(m=m.cssText),"style"===c){for(var y=[],_=m.split(";"),C=0;C<_.length;C++){var w=_[C].split(":"),T=w[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(S.XHTML.validCSS(T)){var E=w[1].replace(/^\s*/,"").replace(/\s*$/,"");y.push(T+": "+E)}}y.length>0&&(m=y.join("; "),h.setAttribute(c,m))}else h.setAttribute(c,m)}for(var A=0;A<t.childNodes.length;A++)h.appendChild(S.createHtml(t.childNodes[A]))}catch(t){h=S.xmlTextNode("")}else{h=S.xmlGenerator().createDocumentFragment();for(var R=0;R<t.childNodes.length;R++)h.appendChild(S.createHtml(t.childNodes[R]))}}else if(t.nodeType===S.ElementType.FRAGMENT){h=S.xmlGenerator().createDocumentFragment();for(var O=0;O<t.childNodes.length;O++)h.appendChild(S.createHtml(t.childNodes[O]))}else t.nodeType===S.ElementType.TEXT&&(h=S.xmlTextNode(t.nodeValue));return h},escapeNode:function(t){return"string"!=typeof t?t:t.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(t){return"string"!=typeof t?t:t.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(t){return t.indexOf("@")<0?null:t.split("@")[0]},getDomainFromJid:function(t){var h=S.getBareJidFromJid(t);if(h.indexOf("@")<0)return h;var f=h.split("@");return f.splice(0,1),f.join("@")},getResourceFromJid:function(t){var h=t.split("/");return h.length<2?null:(h.splice(0,1),h.join("/"))},getBareJidFromJid:function(t){return t?t.split("/")[0]:null},_handleError:function(t){void 0!==t.stack&&S.fatal(t.stack),t.sourceURL?S.fatal("error: "+this.handler+" "+t.sourceURL+":"+t.line+" - "+t.name+": "+t.message):t.fileName?S.fatal("error: "+this.handler+" "+t.fileName+":"+t.lineNumber+" - "+t.name+": "+t.message):S.fatal("error: "+t.message)},log:function(t,h){t===this.LogLevel.FATAL&&"object"===v(window.console)&&"function"==typeof window.console.error&&window.console.error(h)},debug:function(t){this.log(this.LogLevel.DEBUG,t)},info:function(t){this.log(this.LogLevel.INFO,t)},warn:function(t){this.log(this.LogLevel.WARN,t)},error:function(t){this.log(this.LogLevel.ERROR,t)},fatal:function(t){this.log(this.LogLevel.FATAL,t)},serialize:function(t){if(!t)return null;"function"==typeof t.tree&&(t=t.tree());var h=y(Array(t.attributes.length).keys()).map(function(h){return t.attributes[h].nodeName});h.sort();var f=h.reduce(function(h,f){return"".concat(h," ").concat(f,'="').concat(S.xmlescape(t.attributes.getNamedItem(f).value),'"')},"<".concat(t.nodeName));if(t.childNodes.length>0){f+=">";for(var r=0;r<t.childNodes.length;r++){var c=t.childNodes[r];switch(c.nodeType){case S.ElementType.NORMAL:f+=S.serialize(c);break;case S.ElementType.TEXT:f+=S.xmlescape(c.nodeValue);break;case S.ElementType.CDATA:f+="<![CDATA["+c.nodeValue+"]]>"}}f+="</"+t.nodeName+">"}else f+="/>";return f},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(t,h){S._connectionPlugins[t]=h},Builder:function(t,h){"presence"!==t&&"message"!==t&&"iq"!==t||(h&&!h.xmlns?h.xmlns=S.NS.CLIENT:h||(h={xmlns:S.NS.CLIENT})),this.nodeTree=S.xmlElement(t,h),this.node=this.nodeTree}};S.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return S.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},root:function(){return this.node=this.nodeTree,this},attrs:function(t){for(var h in t)Object.prototype.hasOwnProperty.call(t,h)&&(void 0===t[h]?this.node.removeAttribute(h):this.node.setAttribute(h,t[h]));return this},c:function(t,h,f){var r=S.xmlElement(t,h,f);return this.node.appendChild(r),"string"!=typeof f&&"number"!=typeof f&&(this.node=r),this},cnode:function(t){var h,f=S.xmlGenerator();try{h=void 0!==f.importNode}catch(t){h=!1}var r=h?f.importNode(t,!0):S.copyElement(t);return this.node.appendChild(r),this.node=r,this},t:function(t){var h=S.xmlTextNode(t);return this.node.appendChild(h),this},h:function(t){var h=document.createElement("body");h.innerHTML=t;for(var f=S.createHtml(h);f.childNodes.length>0;)this.node.appendChild(f.childNodes[0]);return this}},S.Handler=function(t,h,f,r,c,m,y){this.handler=t,this.ns=h,this.name=f,this.type=r,this.id=c,this.options=y||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBare&&(S.warn('The "matchBare" option is deprecated, use "matchBareFromJid" instead.'),this.options.matchBareFromJid=this.options.matchBare,delete this.options.matchBare),this.options.matchBareFromJid?this.from=m?S.getBareJidFromJid(m):null:this.from=m,this.user=!0},S.Handler.prototype={getNamespace:function(t){var h=t.getAttribute("xmlns");return h&&this.options.ignoreNamespaceFragment&&(h=h.split("#")[0]),h},namespaceMatch:function(t){var h=this,f=!1;return!this.ns||(S.forEachChild(t,null,function(t){h.getNamespace(t)===h.ns&&(f=!0)}),f||this.getNamespace(t)===this.ns)},isMatch:function(t){var h=t.getAttribute("from");this.options.matchBareFromJid&&(h=S.getBareJidFromJid(h));var f=t.getAttribute("type");return!(!this.namespaceMatch(t)||this.name&&!S.isTagEqual(t,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(f):f!==this.type)||this.id&&t.getAttribute("id")!==this.id||this.from&&h!==this.from)},run:function(t){var h=null;try{h=this.handler(t)}catch(t){throw S._handleError(t),t}return h},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},S.TimedHandler=function(t,h){this.period=t,this.handler=h,this.lastCalled=(new Date).getTime(),this.user=!0},S.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},S.Connection=function(t,h){var f=this;this.service=t,this.options=h||{};var r=this.options.protocol||"";for(var c in 0===t.indexOf("ws:")||0===t.indexOf("wss:")||0===r.indexOf("ws")?this._proto=new S.Websocket(this):this._proto=new S.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(function(){return f._onIdle()},100),m.default.addCookies(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),S._connectionPlugins)if(Object.prototype.hasOwnProperty.call(S._connectionPlugins,c)){var y=function(){};y.prototype=S._connectionPlugins[c],this[c]=new y,this[c].init(this)}},S.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(t){var h="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var h=16*Math.random()|0;return("x"===t?h:3&h|8).toString(16)});return"string"==typeof t||"number"==typeof t?h+":"+t:h+""},addProtocolErrorHandler:function(t,h,f){this.protocolErrorHandlers[t][h]=f},connect:function(t,h,f,r,c,m,y){this.jid=t,this.authzid=S.getBareJidFromJid(this.jid),this.authcid=y||S.getNodeFromJid(this.jid),this.pass=h,this.servtype="xmpp",this.connect_callback=f,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=S.getDomainFromJid(this.jid),this._changeConnectStatus(S.Status.CONNECTING,null),this._proto._connect(r,c,m)},attach:function(t,h,f,r,c,m,y){if(!(this._proto instanceof S.Bosh)){var v=new Error('The "attach" method can only be used with a BOSH connection.');throw v.name="StropheSessionError",v}this._proto._attach(t,h,f,r,c,m,y)},restore:function(t,h,f,r,c){if(!this._sessionCachingSupported()){var m=new Error('The "restore" method can only be used with a BOSH connection.');throw m.name="StropheSessionError",m}this._proto._restore(t,h,f,r,c)},_sessionCachingSupported:function(){if(this._proto instanceof S.Bosh){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(t){return!1}return!0}return!1},xmlInput:function(t){},xmlOutput:function(t){},rawInput:function(t){},rawOutput:function(t){},nextValidRid:function(t){},send:function(t){if(null!==t){if("function"==typeof t.sort)for(var h=0;h<t.length;h++)this._queueData(t[h]);else"function"==typeof t.tree?this._queueData(t.tree()):this._queueData(t);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendPresence:function(t,h,f,r){var c=this,m=null;"function"==typeof t.tree&&(t=t.tree());var y=t.getAttribute("id");if(y||(y=this.getUniqueId("sendPresence"),t.setAttribute("id",y)),"function"==typeof h||"function"==typeof f){var v=this.addHandler(function(t){m&&c.deleteTimedHandler(m),"error"===t.getAttribute("type")?f&&f(t):h&&h(t)},null,"presence",null,y);r&&(m=this.addTimedHandler(r,function(){return c.deleteHandler(v),f&&f(null),!1}))}return this.send(t),y},sendIQ:function(t,h,f,r){var c=this,m=null;"function"==typeof t.tree&&(t=t.tree());var y=t.getAttribute("id");if(y||(y=this.getUniqueId("sendIQ"),t.setAttribute("id",y)),"function"==typeof h||"function"==typeof f){var v=this.addHandler(function(t){m&&c.deleteTimedHandler(m);var r=t.getAttribute("type");if("result"===r)h&&h(t);else{if("error"!==r){var y=new Error("Got bad IQ type of ".concat(r));throw y.name="StropheError",y}f&&f(t)}},null,"iq",["error","result"],y);r&&(m=this.addTimedHandler(r,function(){return c.deleteHandler(v),f&&f(null),!1}))}return this.send(t),y},_queueData:function(t){if(null===t||!t.tagName||!t.childNodes){var h=new Error("Cannot queue non-DOMElement.");throw h.name="StropheError",h}this._data.push(t)},_sendRestart:function(){var t=this;this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(function(){return t._onIdle()},100)},addTimedHandler:function(t,h){var f=new S.TimedHandler(t,h);return this.addTimeds.push(f),f},deleteTimedHandler:function(t){this.removeTimeds.push(t)},addHandler:function(t,h,f,r,c,m,y){var v=new S.Handler(t,h,f,r,c,m,y);return this.addHandlers.push(v),v},deleteHandler:function(t){this.removeHandlers.push(t);var h=this.addHandlers.indexOf(t);h>=0&&this.addHandlers.splice(h,1)},registerSASLMechanisms:function(t){this.mechanisms={},(t=t||[S.SASLAnonymous,S.SASLExternal,S.SASLMD5,S.SASLOAuthBearer,S.SASLXOAuth2,S.SASLPlain,S.SASLSHA1]).forEach(this.registerSASLMechanism.bind(this))},registerSASLMechanism:function(t){this.mechanisms[t.prototype.name]=t},disconnect:function(t){if(this._changeConnectStatus(S.Status.DISCONNECTING,t),S.info("Disconnect was called because: "+t),this.connected){var h=!1;this.disconnecting=!0,this.authenticated&&(h=T({xmlns:S.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(h)}else S.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()},_changeConnectStatus:function(t,h,f){for(var r in S._connectionPlugins)if(Object.prototype.hasOwnProperty.call(S._connectionPlugins,r)){var c=this[r];if(c.statusChanged)try{c.statusChanged(t,h)}catch(t){S.error("".concat(r," plugin caused an exception changing status: ").concat(t))}}if(this.connect_callback)try{this.connect_callback(t,h,f)}catch(t){S._handleError(t),S.error("User connection callback caused an exception: ".concat(t))}},_doDisconnect:function(t){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),S.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(S.Status.DISCONNECTED,t),this.connected=!1},_dataRecv:function(t,h){var f=this;S.info("_dataRecv called");var r=this._proto._reqToData(t);if(null!==r){for(this.xmlInput!==S.Connection.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==S.Connection.prototype.rawInput&&(h?this.rawInput(h):this.rawInput(S.serialize(r)));this.removeHandlers.length>0;){var c=this.removeHandlers.pop(),m=this.handlers.indexOf(c);m>=0&&this.handlers.splice(m,1)}for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())this._doDisconnect();else{var y=r.getAttribute("type");if(null!==y&&"terminate"===y){if(this.disconnecting)return;var v=r.getAttribute("condition"),_=r.getElementsByTagName("conflict");return null!==v?("remote-stream-error"===v&&_.length>0&&(v="conflict"),this._changeConnectStatus(S.Status.CONNFAIL,v)):this._changeConnectStatus(S.Status.CONNFAIL,S.ErrorCondition.UNKOWN_REASON),void this._doDisconnect(v)}S.forEachChild(r,null,function(t){var h=f.handlers;f.handlers=[];for(var r=0;r<h.length;r++){var c=h[r];try{!c.isMatch(t)||!f.authenticated&&c.user?f.handlers.push(c):c.run(t)&&f.handlers.push(c)}catch(t){S.warn("Removing Strophe handlers due to uncaught exception: "+t.message)}}})}}},mechanisms:{},_connect_cb:function(t,h,f){var r;S.info("_connect_cb was called"),this.connected=!0;try{r=this._proto._reqToData(t)}catch(t){if(t.name!==S.ErrorCondition.BAD_FORMAT)throw t;this._changeConnectStatus(S.Status.CONNFAIL,S.ErrorCondition.BAD_FORMAT),this._doDisconnect(S.ErrorCondition.BAD_FORMAT)}if(r&&(this.xmlInput!==S.Connection.prototype.xmlInput&&(r.nodeName===this._proto.strip&&r.childNodes.length?this.xmlInput(r.childNodes[0]):this.xmlInput(r)),this.rawInput!==S.Connection.prototype.rawInput&&(f?this.rawInput(f):this.rawInput(S.serialize(r))),this._proto._connect_cb(r)!==S.Status.CONNFAIL))if(r.getElementsByTagNameNS?r.getElementsByTagNameNS(S.NS.STREAM,"features").length>0:r.getElementsByTagName("stream:features").length>0||r.getElementsByTagName("features").length>0){var c=[],m=r.getElementsByTagName("mechanism");if(m.length>0)for(var y=0;y<m.length;y++){var v=S.getText(m[y]);this.mechanisms[v]&&c.push(this.mechanisms[v])}0!==c.length||0!==r.getElementsByTagName("auth").length?!1!==this.do_authentication&&this.authenticate(c):this._proto._no_auth_received(h)}else this._proto._no_auth_received(h)},sortMechanismsByPriority:function(t){for(var h=0;h<t.length-1;++h){for(var f=h,r=h+1;r<t.length;++r)t[r].prototype.priority>t[f].prototype.priority&&(f=r);if(f!==h){var c=t[h];t[h]=t[f],t[f]=c}}return t},_attemptSASLAuth:function(t){t=this.sortMechanismsByPriority(t||[]);for(var h=!1,f=0;f<t.length;++f)if(t[f].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new t[f],this._sasl_mechanism.onStart(this);var r=_("auth",{xmlns:S.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var c=this._sasl_mechanism.onChallenge(this,null);r.t(btoa(c))}this.send(r.tree()),h=!0;break}return h},_attemptLegacyAuth:function(){null===S.getNodeFromJid(this.jid)?(this._changeConnectStatus(S.Status.CONNFAIL,S.ErrorCondition.MISSING_JID_NODE),this.disconnect(S.ErrorCondition.MISSING_JID_NODE)):(this._changeConnectStatus(S.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(w({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:S.NS.AUTH}).c("username",{}).t(S.getNodeFromJid(this.jid)).tree()))},authenticate:function(t){this._attemptSASLAuth(t)||this._attemptLegacyAuth()},_sasl_challenge_cb:function(t){var h=atob(S.getText(t)),f=this._sasl_mechanism.onChallenge(this,h),r=_("response",{xmlns:S.NS.SASL});return""!==f&&r.t(btoa(f)),this.send(r.tree()),!0},_auth1_cb:function(t){var h=w({type:"set",id:"_auth_2"}).c("query",{xmlns:S.NS.AUTH}).c("username",{}).t(S.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return S.getResourceFromJid(this.jid)||(this.jid=S.getBareJidFromJid(this.jid)+"/strophe"),h.up().c("resource",{}).t(S.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(h.tree()),!1},_sasl_success_cb:function(t){var h=this;if(this._sasl_data["server-signature"]){var f,r=atob(S.getText(t)).match(/([a-z]+)=([^,]+)(,|$)/);if("v"===r[1]&&(f=r[2]),f!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}S.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var c=[],m=function(t,f){for(;t.length;)h.deleteHandler(t.pop());return h._sasl_auth1_cb(f),!1};return c.push(this._addSysHandler(function(t){return m(c,t)},null,"stream:features",null,null)),c.push(this._addSysHandler(function(t){return m(c,t)},S.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(t){this.features=t;for(var h=0;h<t.childNodes.length;h++){var f=t.childNodes[h];"bind"===f.nodeName&&(this.do_bind=!0),"session"===f.nodeName&&(this.do_session=!0)}if(!this.do_bind)return this._changeConnectStatus(S.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var r=S.getResourceFromJid(this.jid);return r?this.send(w({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:S.NS.BIND}).c("resource",{}).t(r).tree()):this.send(w({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:S.NS.BIND}).tree()),!1},_sasl_bind_cb:function(t){var h;if("error"===t.getAttribute("type"))return S.info("SASL binding failed."),t.getElementsByTagName("conflict").length>0&&(h=S.ErrorCondition.CONFLICT),this._changeConnectStatus(S.Status.AUTHFAIL,h,t),!1;var f=t.getElementsByTagName("bind");if(!(f.length>0))return S.info("SASL binding failed."),this._changeConnectStatus(S.Status.AUTHFAIL,null,t),!1;var r=f[0].getElementsByTagName("jid");r.length>0&&(this.jid=S.getText(r[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(w({type:"set",id:"_session_auth_2"}).c("session",{xmlns:S.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(S.Status.CONNECTED,null)))},_sasl_session_cb:function(t){if("result"===t.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(S.Status.CONNECTED,null);else if("error"===t.getAttribute("type"))return S.info("Session creation failed."),this._changeConnectStatus(S.Status.AUTHFAIL,null,t),!1;return!1},_sasl_failure_cb:function(t){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(S.Status.AUTHFAIL,null,t),!1},_auth2_cb:function(t){return"result"===t.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(S.Status.CONNECTED,null)):"error"===t.getAttribute("type")&&(this._changeConnectStatus(S.Status.AUTHFAIL,null,t),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(t,h){var f=new S.TimedHandler(t,h);return f.user=!1,this.addTimeds.push(f),f},_addSysHandler:function(t,h,f,r,c){var m=new S.Handler(t,h,f,r,c);return m.user=!1,this.addHandlers.push(m),m},_onDisconnectTimeout:function(){return S.info("_onDisconnectTimeout was called"),this._changeConnectStatus(S.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var t=this;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;){var h=this.removeTimeds.pop(),f=this.timedHandlers.indexOf(h);f>=0&&this.timedHandlers.splice(f,1)}for(var r=(new Date).getTime(),c=[],m=0;m<this.timedHandlers.length;m++){var y=this.timedHandlers[m];if(this.authenticated||!y.user)y.lastCalled+y.period-r<=0?y.run()&&c.push(y):c.push(y)}this.timedHandlers=c,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(function(){return t._onIdle()},100))}},S.SASLMechanism=function(t,h,f){this.name=t,this.isClientFirst=h,this.priority=f},S.SASLMechanism.prototype={test:function(t){return!0},onStart:function(t){this._connection=t},onChallenge:function(t,h){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},S.SASLAnonymous=function(){},S.SASLAnonymous.prototype=new S.SASLMechanism("ANONYMOUS",!1,20),S.SASLAnonymous.prototype.test=function(t){return null===t.authcid},S.SASLPlain=function(){},S.SASLPlain.prototype=new S.SASLMechanism("PLAIN",!0,50),S.SASLPlain.prototype.test=function(t){return null!==t.authcid},S.SASLPlain.prototype.onChallenge=function(t){var h=t.authzid;return h+="\0",h+=t.authcid,h+="\0",h+=t.pass,m.default.utf16to8(h)},S.SASLSHA1=function(){},S.SASLSHA1.prototype=new S.SASLMechanism("SCRAM-SHA-1",!0,70),S.SASLSHA1.prototype.test=function(t){return null!==t.authcid},S.SASLSHA1.prototype.onChallenge=function(t,h,f){var y=f||r.default.hexdigest(1234567890*Math.random()),v="n="+m.default.utf16to8(t.authcid);return v+=",r=",v+=y,t._sasl_data.cnonce=y,t._sasl_data["client-first-message-bare"]=v,v="n,,"+v,this.onChallenge=function(t,h){for(var f,r,y,v,_,C,w,T,S="c=biws,",E="".concat(t._sasl_data["client-first-message-bare"],",").concat(h,","),A=t._sasl_data.cnonce,R=/([a-z]+)=([^,]+)(,|$)/;h.match(R);){var O=h.match(R);switch(h=h.replace(O[0],""),O[1]){case"r":f=O[2];break;case"s":r=O[2];break;case"i":y=O[2]}}if(f.substr(0,A.length)!==A)return t._sasl_data={},t._sasl_failure_cb();E+=S+="r="+f,r=atob(r),r+="\0\0\0";var D=m.default.utf16to8(t.pass);for(v=C=c.default.core_hmac_sha1(D,r),w=1;w<y;w++){for(_=c.default.core_hmac_sha1(D,c.default.binb2str(C)),T=0;T<5;T++)v[T]^=_[T];C=_}v=c.default.binb2str(v);var x=c.default.core_hmac_sha1(v,"Client Key"),L=c.default.str_hmac_sha1(v,"Server Key"),b=c.default.core_hmac_sha1(c.default.str_sha1(c.default.binb2str(x)),E);for(t._sasl_data["server-signature"]=c.default.b64_hmac_sha1(L,E),T=0;T<5;T++)x[T]^=b[T];return S+=",p="+btoa(c.default.binb2str(x))},v},S.SASLMD5=function(){},S.SASLMD5.prototype=new S.SASLMechanism("DIGEST-MD5",!1,60),S.SASLMD5.prototype.test=function(t){return null!==t.authcid},S.SASLMD5.prototype._quote=function(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},S.SASLMD5.prototype.onChallenge=function(t,h,f){for(var c=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,y=f||r.default.hexdigest(""+1234567890*Math.random()),v="",_=null,C="";h.match(c);){var w=h.match(c);switch(h=h.replace(w[0],""),w[2]=w[2].replace(/^"(.+)"$/,"$1"),w[1]){case"realm":v=w[2];break;case"nonce":C=w[2];break;case"qop":w[2];break;case"host":_=w[2]}}var T=t.servtype+"/"+t.domain;null!==_&&(T=T+"/"+_);var S=m.default.utf16to8(t.authcid+":"+v+":"+this._connection.pass),E=r.default.hash(S)+":"+C+":"+y,A="AUTHENTICATE:"+T,R="";return R+="charset=utf-8,",R+="username="+this._quote(m.default.utf16to8(t.authcid))+",",R+="realm="+this._quote(v)+",",R+="nonce="+this._quote(C)+",",R+="nc=00000001,",R+="cnonce="+this._quote(y)+",",R+="digest-uri="+this._quote(T)+",",R+="response="+r.default.hexdigest(r.default.hexdigest(E)+":"+C+":00000001:"+y+":auth:"+r.default.hexdigest(A))+",",R+="qop=auth",this.onChallenge=function(){return""},R},S.SASLOAuthBearer=function(){},S.SASLOAuthBearer.prototype=new S.SASLMechanism("OAUTHBEARER",!0,40),S.SASLOAuthBearer.prototype.test=function(t){return null!==t.pass},S.SASLOAuthBearer.prototype.onChallenge=function(t){var h="n,";return null!==t.authcid&&(h=h+"a="+t.authzid),h+=",",h+="",h+="auth=Bearer ",h+=t.pass,h+="",h+="",m.default.utf16to8(h)},S.SASLExternal=function(){},S.SASLExternal.prototype=new S.SASLMechanism("EXTERNAL",!0,10),S.SASLExternal.prototype.onChallenge=function(t){return t.authcid===t.authzid?"":t.authzid},S.SASLXOAuth2=function(){},S.SASLXOAuth2.prototype=new S.SASLMechanism("X-OAUTH2",!0,30),S.SASLXOAuth2.prototype.test=function(t){return null!==t.pass},S.SASLXOAuth2.prototype.onChallenge=function(t){var h="\0";return null!==t.authcid&&(h+=t.authzid),h+="\0",h+=t.pass,m.default.utf16to8(h)},h.default={Strophe:S,$build:_,$iq:w,$msg:C,$pres:T,SHA1:c.default,MD5:r.default,b64_hmac_sha1:c.default.b64_hmac_sha1,b64_sha1:c.default.b64_sha1,str_hmac_sha1:c.default.str_hmac_sha1,str_sha1:c.default.str_sha1}},"./src/md5.js":
/*!********************!*\
  !*** ./src/md5.js ***!
  \********************/
/*! exports provided: default */function(t,h,f){"use strict";f.r(h),f.d(h,"default",function(){return T});var r=function(t,h){var f=(65535&t)+(65535&h);return(t>>16)+(h>>16)+(f>>16)<<16|65535&f},c=function(t){for(var h=[],f=0;f<8*t.length;f+=8)h[f>>5]|=(255&t.charCodeAt(f/8))<<f%32;return h},m=function(t,h,f,c,m,y){return r((v=r(r(h,t),r(c,y)))<<(_=m)|v>>>32-_,f);var v,_},y=function(t,h,f,r,c,y,v){return m(h&f|~h&r,t,h,c,y,v)},v=function(t,h,f,r,c,y,v){return m(h&r|f&~r,t,h,c,y,v)},_=function(t,h,f,r,c,y,v){return m(h^f^r,t,h,c,y,v)},C=function(t,h,f,r,c,y,v){return m(f^(h|~r),t,h,c,y,v)},w=function(t,h){t[h>>5]|=128<<h%32,t[14+(h+64>>>9<<4)]=h;for(var f,c,m,w,T=1732584193,S=-271733879,E=-1732584194,A=271733878,R=0;R<t.length;R+=16)f=T,c=S,m=E,w=A,T=y(T,S,E,A,t[R+0],7,-680876936),A=y(A,T,S,E,t[R+1],12,-389564586),E=y(E,A,T,S,t[R+2],17,606105819),S=y(S,E,A,T,t[R+3],22,-1044525330),T=y(T,S,E,A,t[R+4],7,-176418897),A=y(A,T,S,E,t[R+5],12,1200080426),E=y(E,A,T,S,t[R+6],17,-1473231341),S=y(S,E,A,T,t[R+7],22,-45705983),T=y(T,S,E,A,t[R+8],7,1770035416),A=y(A,T,S,E,t[R+9],12,-1958414417),E=y(E,A,T,S,t[R+10],17,-42063),S=y(S,E,A,T,t[R+11],22,-1990404162),T=y(T,S,E,A,t[R+12],7,1804603682),A=y(A,T,S,E,t[R+13],12,-40341101),E=y(E,A,T,S,t[R+14],17,-1502002290),S=y(S,E,A,T,t[R+15],22,1236535329),T=v(T,S,E,A,t[R+1],5,-165796510),A=v(A,T,S,E,t[R+6],9,-1069501632),E=v(E,A,T,S,t[R+11],14,643717713),S=v(S,E,A,T,t[R+0],20,-373897302),T=v(T,S,E,A,t[R+5],5,-701558691),A=v(A,T,S,E,t[R+10],9,38016083),E=v(E,A,T,S,t[R+15],14,-660478335),S=v(S,E,A,T,t[R+4],20,-405537848),T=v(T,S,E,A,t[R+9],5,568446438),A=v(A,T,S,E,t[R+14],9,-1019803690),E=v(E,A,T,S,t[R+3],14,-187363961),S=v(S,E,A,T,t[R+8],20,1163531501),T=v(T,S,E,A,t[R+13],5,-1444681467),A=v(A,T,S,E,t[R+2],9,-51403784),E=v(E,A,T,S,t[R+7],14,1735328473),S=v(S,E,A,T,t[R+12],20,-1926607734),T=_(T,S,E,A,t[R+5],4,-378558),A=_(A,T,S,E,t[R+8],11,-2022574463),E=_(E,A,T,S,t[R+11],16,1839030562),S=_(S,E,A,T,t[R+14],23,-35309556),T=_(T,S,E,A,t[R+1],4,-1530992060),A=_(A,T,S,E,t[R+4],11,1272893353),E=_(E,A,T,S,t[R+7],16,-155497632),S=_(S,E,A,T,t[R+10],23,-1094730640),T=_(T,S,E,A,t[R+13],4,681279174),A=_(A,T,S,E,t[R+0],11,-358537222),E=_(E,A,T,S,t[R+3],16,-722521979),S=_(S,E,A,T,t[R+6],23,76029189),T=_(T,S,E,A,t[R+9],4,-640364487),A=_(A,T,S,E,t[R+12],11,-421815835),E=_(E,A,T,S,t[R+15],16,530742520),S=_(S,E,A,T,t[R+2],23,-995338651),T=C(T,S,E,A,t[R+0],6,-198630844),A=C(A,T,S,E,t[R+7],10,1126891415),E=C(E,A,T,S,t[R+14],15,-1416354905),S=C(S,E,A,T,t[R+5],21,-57434055),T=C(T,S,E,A,t[R+12],6,1700485571),A=C(A,T,S,E,t[R+3],10,-1894986606),E=C(E,A,T,S,t[R+10],15,-1051523),S=C(S,E,A,T,t[R+1],21,-2054922799),T=C(T,S,E,A,t[R+8],6,1873313359),A=C(A,T,S,E,t[R+15],10,-30611744),E=C(E,A,T,S,t[R+6],15,-1560198380),S=C(S,E,A,T,t[R+13],21,1309151649),T=C(T,S,E,A,t[R+4],6,-145523070),A=C(A,T,S,E,t[R+11],10,-1120210379),E=C(E,A,T,S,t[R+2],15,718787259),S=C(S,E,A,T,t[R+9],21,-343485551),T=r(T,f),S=r(S,c),E=r(E,m),A=r(A,w);return[T,S,E,A]},T={hexdigest:function(t){return function(t){for(var h="",f=0;f<4*t.length;f++)h+="0123456789abcdef".charAt(t[f>>2]>>f%4*8+4&15)+"0123456789abcdef".charAt(t[f>>2]>>f%4*8&15);return h}(w(c(t),8*t.length))},hash:function(t){return function(t){for(var h="",f=0;f<32*t.length;f+=8)h+=String.fromCharCode(t[f>>5]>>>f%32&255);return h}(w(c(t),8*t.length))}}},"./src/sha1.js":
/*!*********************!*\
  !*** ./src/sha1.js ***!
  \*********************/
/*! exports provided: default */function(t,h,f){"use strict";function r(t,h){t[h>>5]|=128<<24-h%32,t[15+(h+64>>9<<4)]=h;var f,r,y,C,w,T,S,E,A=new Array(80),R=1732584193,O=-271733879,D=-1732584194,x=271733878,L=-1009589776;for(f=0;f<t.length;f+=16){for(C=R,w=O,T=D,S=x,E=L,r=0;r<80;r++)A[r]=r<16?t[f+r]:_(A[r-3]^A[r-8]^A[r-14]^A[r-16],1),y=v(v(_(R,5),c(r,O,D,x)),v(v(L,A[r]),m(r))),L=x,x=D,D=_(O,30),O=R,R=y;R=v(R,C),O=v(O,w),D=v(D,T),x=v(x,S),L=v(L,E)}return[R,O,D,x,L]}function c(t,h,f,r){return t<20?h&f|~h&r:t<40?h^f^r:t<60?h&f|h&r|f&r:h^f^r}function m(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function y(t,h){var f=C(t);f.length>16&&(f=r(f,8*t.length));for(var c=new Array(16),m=new Array(16),y=0;y<16;y++)c[y]=909522486^f[y],m[y]=1549556828^f[y];var v=r(c.concat(C(h)),512+8*h.length);return r(m.concat(v),672)}function v(t,h){var f=(65535&t)+(65535&h);return(t>>16)+(h>>16)+(f>>16)<<16|65535&f}function _(t,h){return t<<h|t>>>32-h}function C(t){for(var h=[],f=0;f<8*t.length;f+=8)h[f>>5]|=(255&t.charCodeAt(f/8))<<24-f%32;return h}function w(t){for(var h,f,r="",c=0;c<4*t.length;c+=3)for(h=(t[c>>2]>>8*(3-c%4)&255)<<16|(t[c+1>>2]>>8*(3-(c+1)%4)&255)<<8|t[c+2>>2]>>8*(3-(c+2)%4)&255,f=0;f<4;f++)8*c+6*f>32*t.length?r+="=":r+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(h>>6*(3-f)&63);return r}function T(t){for(var h="",f=0;f<32*t.length;f+=8)h+=String.fromCharCode(t[f>>5]>>>24-f%32&255);return h}f.r(h),f.d(h,"default",function(){return S});var S={b64_hmac_sha1:function(t,h){return w(y(t,h))},b64_sha1:function(t){return w(r(C(t),8*t.length))},binb2str:T,core_hmac_sha1:y,str_hmac_sha1:function(t,h){return T(y(t,h))},str_sha1:function(t){return T(r(C(t),8*t.length))}}},"./src/strophe.js":
/*!************************!*\
  !*** ./src/strophe.js ***!
  \************************/
/*! exports provided: default */function(t,h,f){"use strict";f.r(h),function(t){var r=f(/*! core */"./src/core.js");f(/*! bosh */"./src/bosh.js"),f(/*! websocket */"./src/websocket.js");f.d(h,"default",function(){return r.default}),t.Strophe=r.default.Strophe,t.$build=r.default.$build,t.$iq=r.default.$iq,t.$msg=r.default.$msg,t.$pres=r.default.$pres}.call(this,f(/*! ./../node_modules/webpack/buildin/global.js */"./node_modules/webpack/buildin/global.js"))},"./src/utils.js":
/*!**********************!*\
  !*** ./src/utils.js ***!
  \**********************/
/*! exports provided: default */function(t,h,f){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}f.r(h),f.d(h,"default",function(){return c});var c={utf16to8:function(t){var h,f,r="",c=t.length;for(h=0;h<c;h++)(f=t.charCodeAt(h))>=0&&f<=127?r+=t.charAt(h):f>2047?(r+=String.fromCharCode(224|f>>12&15),r+=String.fromCharCode(128|f>>6&63),r+=String.fromCharCode(128|f>>0&63)):(r+=String.fromCharCode(192|f>>6&31),r+=String.fromCharCode(128|f>>0&63));return r},addCookies:function(t){for(var h in t=t||{})if(Object.prototype.hasOwnProperty.call(t,h)){var f="",c="",m="",y=t[h],v="object"===r(y),_=escape(unescape(v?y.value:y));v&&(f=y.expires?";expires="+y.expires:"",c=y.domain?";domain="+y.domain:"",m=y.path?";path="+y.path:""),document.cookie=h+"="+_+f+c+m}}}},"./src/websocket.js":
/*!**************************!*\
  !*** ./src/websocket.js ***!
  \**************************/
/*! no exports provided */function(t,h,f){"use strict";f.r(h);var r=f(/*! core */"./src/core.js"),c=r.default.Strophe,m=r.default.$build;c.Websocket=function(t){this._conn=t,this.strip="wrapper";var h=t.service;if(0!==h.indexOf("ws:")&&0!==h.indexOf("wss:")){var f="";"ws"===t.options.protocol&&"https:"!==window.location.protocol?f+="ws":f+="wss",f+="://"+window.location.host,0!==h.indexOf("/")?f+=window.location.pathname+h:f+=h,t.service=f}},c.Websocket.prototype={_buildStream:function(){return m("open",{xmlns:c.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(t,h){var f;if(0===(f=t.getElementsByTagNameNS?t.getElementsByTagNameNS(c.NS.STREAM,"error"):t.getElementsByTagName("stream:error")).length)return!1;for(var r=f[0],m="",y="",v=0;v<r.childNodes.length;v++){var _=r.childNodes[v];if("urn:ietf:params:xml:ns:xmpp-streams"!==_.getAttribute("xmlns"))break;"text"===_.nodeName?y=_.textContent:m=_.nodeName}var C="WebSocket stream error: ";return C+=m||"unknown",y&&(C+=" - "+y),c.error(C),this._conn._changeConnectStatus(h,m),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(t){if(this._check_streamerror(t,c.Status.CONNFAIL))return c.Status.CONNFAIL},_handleStreamStart:function(t){var h=!1,f=t.getAttribute("xmlns");"string"!=typeof f?h="Missing xmlns in <open />":f!==c.NS.FRAMING&&(h="Wrong xmlns in <open />: "+f);var r=t.getAttribute("version");return"string"!=typeof r?h="Missing version in <open />":"1.0"!==r&&(h="Wrong version in <open />: "+r),!h||(this._conn._changeConnectStatus(c.Status.CONNFAIL,h),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(t){if(0===t.data.indexOf("<open ")||0===t.data.indexOf("<?xml")){var h=t.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===h)return;var f=(new DOMParser).parseFromString(h,"text/xml").documentElement;this._conn.xmlInput(f),this._conn.rawInput(t.data),this._handleStreamStart(f)&&this._connect_cb(f)}else if(0===t.data.indexOf("<close ")){var r=(new DOMParser).parseFromString(t.data,"text/xml").documentElement;this._conn.xmlInput(r),this._conn.rawInput(t.data);var m=r.getAttribute("see-other-uri");if(m){var y=this._conn.service;(y.indexOf("wss:")>=0&&m.indexOf("wss:")>=0||y.indexOf("ws:")>=0)&&(this._conn._changeConnectStatus(c.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=m,this._connect())}else this._conn._changeConnectStatus(c.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{var v=this._streamWrap(t.data),_=(new DOMParser).parseFromString(v,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(_,null,t.data)}},_disconnect:function(t){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){t&&this._conn.send(t);var h=m("close",{xmlns:c.NS.FRAMING});this._conn.xmlOutput(h.tree());var f=c.serialize(h);this._conn.rawOutput(f);try{this.socket.send(f)}catch(t){c.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){c.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(t){return"<wrapper>"+t+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.onerror=null,this.socket.close()}catch(t){c.debug(t.message)}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(t){this._conn.connected&&!this._conn.disconnecting?(c.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):t&&1006===t.code&&!this._conn.connected&&this.socket?(c.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(c.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):c.info("Websocket closed")},_no_auth_received:function(t){c.error("Server did not offer a supported authentication mechanism"),this._changeConnectStatus(c.Status.CONNFAIL,c.ErrorCondition.NO_AUTH_MECH),t&&t.call(this._conn),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(t){c.error("Websocket error "+t),this._conn._changeConnectStatus(c.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){var t=this._conn._data;if(t.length>0&&!this._conn.paused){for(var h=0;h<t.length;h++)if(null!==t[h]){var f=void 0;f="restart"===t[h]?this._buildStream().tree():t[h];var r=c.serialize(f);this._conn.xmlOutput(f),this._conn.rawOutput(r),this.socket.send(r)}this._conn._data=[]}},_onMessage:function(t){var h,f='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(t.data===f)return this._conn.rawInput(f),this._conn.xmlInput(t),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===t.data.search("<open ")){if(h=(new DOMParser).parseFromString(t.data,"text/xml").documentElement,!this._handleStreamStart(h))return}else{var r=this._streamWrap(t.data);h=(new DOMParser).parseFromString(r,"text/xml").documentElement}return this._check_streamerror(h,c.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===h.firstChild.nodeName&&"unavailable"===h.firstChild.getAttribute("type")?(this._conn.xmlInput(h),void this._conn.rawInput(c.serialize(h))):void this._conn._dataRecv(h,t.data)},_onOpen:function(){c.info("Websocket open");var t=this._buildStream();this._conn.xmlOutput(t.tree());var h=c.serialize(t);this._conn.rawOutput(h),this.socket.send(h)},_reqToData:function(t){return t},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}}}}).default},t.exports=r()},function(t,h,f){const r=f(1).chatProtocol,c=f(0);t.exports=function(){const t=1===r.active?r.bosh:r.websocket,h=new Strophe.Connection(t);return 1===r.active?(h.xmlInput=function(t){if(t.childNodes[0])for(let h=0,f=t.childNodes.length;h<f;h++)c.DLog("[Chat]","RECV:",t.childNodes[h])},h.xmlOutput=function(t){if(t.childNodes[0])for(let h=0,f=t.childNodes.length;h<f;h++)c.DLog("[Chat]","SENT:",t.childNodes[h])}):(h.xmlInput=function(t){c.DLog("[Chat]","RECV:",t)},h.xmlOutput=function(t){c.DLog("[Chat]","SENT:",t)}),h}},function(t,h,f){var r=f(24),c=f(25);h.write=c,h.parse=r.parse,h.parseFmtpConfig=r.parseFmtpConfig,h.parseParams=r.parseParams,h.parsePayloads=r.parsePayloads,h.parseRemoteCandidates=r.parseRemoteCandidates,h.parseImageAttributes=r.parseImageAttributes,h.parseSimulcastStreamList=r.parseSimulcastStreamList},function(t,h,f){var r=function(t){return String(Number(t))===t?Number(t):t},c=function(t,h,f){var c=t.name&&t.names;t.push&&!h[t.push]?h[t.push]=[]:c&&!h[t.name]&&(h[t.name]={});var m=t.push?{}:c?h[t.name]:h;!function(t,h,f,c){if(c&&!f)h[c]=r(t[1]);else for(var m=0;m<f.length;m+=1)null!=t[m+1]&&(h[f[m]]=r(t[m+1]))}(f.match(t.reg),m,t.names,t.name),t.push&&h[t.push].push(m)},m=f(10),y=RegExp.prototype.test.bind(/^([a-z])=(.*)/);h.parse=function(t){var h={},f=[],r=h;return t.split(/(\r\n|\r|\n)/).filter(y).forEach(function(t){var h=t[0],y=t.slice(2);"m"===h&&(f.push({rtp:[],fmtp:[]}),r=f[f.length-1]);for(var v=0;v<(m[h]||[]).length;v+=1){var _=m[h][v];if(_.reg.test(y))return c(_,r,y)}}),h.media=f,h};var v=function(t,h){var f=h.split(/=(.+)/,2);return 2===f.length?t[f[0]]=r(f[1]):1===f.length&&h.length>1&&(t[f[0]]=void 0),t};h.parseParams=function(t){return t.split(/\;\s?/).reduce(v,{})},h.parseFmtpConfig=h.parseParams,h.parsePayloads=function(t){return t.split(" ").map(Number)},h.parseRemoteCandidates=function(t){for(var h=[],f=t.split(" ").map(r),c=0;c<f.length;c+=3)h.push({component:f[c],ip:f[c+1],port:f[c+2]});return h},h.parseImageAttributes=function(t){return t.split(" ").map(function(t){return t.substring(1,t.length-1).split(",").reduce(v,{})})},h.parseSimulcastStreamList=function(t){return t.split(";").map(function(t){return t.split(",").map(function(t){var h,f=!1;return"~"!==t[0]?h=r(t):(h=r(t.substring(1,t.length)),f=!0),{scid:h,paused:f}})})}},function(t,h,f){var r=f(10),c=/%[sdv%]/g,m=function(t,h,f){var r=[t+"="+(h.format instanceof Function?h.format(h.push?f:f[h.name]):h.format)];if(h.names)for(var m=0;m<h.names.length;m+=1){var y=h.names[m];h.name?r.push(f[h.name][y]):r.push(f[h.names[m]])}else r.push(f[h.name]);return function(t){var h=1,f=arguments,r=f.length;return t.replace(c,function(t){if(h>=r)return t;var c=f[h];switch(h+=1,t){case"%%":return"%";case"%s":return String(c);case"%d":return Number(c);case"%v":return""}})}.apply(null,r)},y=["v","o","s","i","u","e","p","c","b","t","r","z","a"],v=["i","c","b","a"];t.exports=function(t,h){h=h||{},null==t.version&&(t.version=0),null==t.name&&(t.name=" "),t.media.forEach(function(t){null==t.payloads&&(t.payloads="")});var f=h.outerOrder||y,c=h.innerOrder||v,_=[];return f.forEach(function(h){r[h].forEach(function(f){f.name in t&&null!=t[f.name]?_.push(m(h,f,t)):f.push in t&&null!=t[f.push]&&t[f.push].forEach(function(t){_.push(m(h,f,t))})})}),t.media.forEach(function(t){_.push(m("m",r.m[0],t)),c.forEach(function(h){r[h].forEach(function(f){f.name in t&&null!=t[f.name]?_.push(m(h,f,t)):f.push in t&&null!=t[f.push]&&t[f.push].forEach(function(t){_.push(m(h,f,t))})})})}),_.join("\r\n")+"\r\n"}},function(t,h){t.exports=nativescript-xmpp-client},function(t,h){t.exports=node-fetch},function(t,h){t.exports=form-data},function(t,h){t.exports=node-xmpp-client},function(t,h,f){const r=f(1),c=f(0),m=f(31),y=f(33);function v(t){this.service=t,this.webSessionCheckInterval=null}v.prototype={getSession:function(t){const h={url:c.getUrl(r.urls.session)};this.service.ajax(h,function(h,f){t(h,f&&f.session)})},createSession:function(t,h){if(""===r.creds.appId||""===r.creds.authKey||""===r.creds.authSecret)throw new Error("Cannot create a new session without app credentials (app ID, auth key and auth secret)");const f=this;let v,_=r.urls.session;"function"==typeof t&&void 0===h&&(h=t,t={}),t.hasOwnProperty("long")&&(_=r.urls.webSession),(v=function(t){let h={application_id:r.creds.appId,auth_key:r.creds.authKey,nonce:c.randomNonce(),timestamp:c.unixTime()};t.login&&t.password?h.user={login:t.login,password:t.password}:t.email&&t.password?h.user={email:t.email,password:t.password}:t.provider?(h.provider=t.provider,t.scope&&(h.scope=t.scope),t.keys&&t.keys.token&&(h.keys={token:t.keys.token}),t.keys&&t.keys.secret&&(h.keys.secret=t.keys.secret)):t.hasOwnProperty("long")&&(h.long=t.long);return h}(t)).signature=function(t,h){let f,c=Object.keys(t).map(function(h){return"object"==typeof t[h]?Object.keys(t[h]).map(function(f){return h+"["+f+"]="+t[h][f]}).sort().join("&"):h+"="+t[h]}).sort().join("&");if("sha1"===r.hash)f=m(c,h).toString();else{if("sha256"!==r.hash)throw new Error("Unknown crypto standards, available sha1 or sha256");f=y(c,h).toString()}return f}(v,r.creds.authSecret);const C={url:c.getUrl(_),type:"POST",data:v};this.service.ajax(C,function(t,r){if(t)h(t,null);else{const t=r.qr_code?r.qr_code:r.session;f.service.setSession(r.session),f.service.setCurrentUserId(r.session.user_id),h(null,t)}})},destroySession:function(t){const h=this,f={url:c.getUrl(r.urls.session),type:"DELETE",dataType:"text"};this.service.ajax(f,function(f,r){f?t(f,null):(h.service.setSession(null),t(null)),h.service.setCurrentUserId(null)})},createWebSession:function(t,h){"function"==typeof t&&void 0===h&&(h=t,t={long:0}),this.createSession(t,function(t,f){h(t,f)})},checkWebSessionUntilUpgrade:function(t){const h=this,f=r.webSession.getSessionTimeInterval,c=new Error("The web session check interval was stopped (timeout)");let m=r.webSession.getSessionTimeout;function y(){h.webSessionCheckInterval&&clearInterval(h.webSessionCheckInterval)}return y(),h.webSessionCheckInterval=setInterval(function(){h.getSession(function(r,v){if(r)y(),t(r,null);else if(0!==v.user_id)y(),h.service.setCurrentUserId(v.user_id),h.service.setSession(v),t(null,v);else{if(!(m>f))throw y(),t(c,null),c;m-=f}})},1e3*f),h.webSessionCheckInterval},upgradeWebSession:function(t,h){const f={url:c.getUrl(r.urls.webSession),type:"PATCH",dataType:"text",data:{web_token:t}};this.service.ajax(f,function(t){t&&h(t)})},login:function(t,h){const f=this,m={type:"POST",url:c.getUrl(r.urls.login),data:t};this.service.ajax(m,function(t,r){t?h(t,null):(f.service.setCurrentUserId(r.user.id),h(null,r.user))})},logout:function(t){const h={url:c.getUrl(r.urls.login),type:"DELETE",dataType:"text"};this.service.ajax(h,t),this.service.setCurrentUserId(null)}},t.exports=v},function(t,h,f){var r;t.exports=(r=f(4),f(32),f(11),r.HmacSHA1)},function(t,h,f){var r,c,m,y,v,_,C,w;t.exports=(r=f(4),m=(c=r).lib,y=m.WordArray,v=m.Hasher,_=c.algo,C=[],w=_.SHA1=v.extend({_doReset:function(){this._hash=new y.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,h){for(var f=this._hash.words,r=f[0],c=f[1],m=f[2],y=f[3],v=f[4],_=0;_<80;_++){if(_<16)C[_]=0|t[h+_];else{var w=C[_-3]^C[_-8]^C[_-14]^C[_-16];C[_]=w<<1|w>>>31}var T=(r<<5|r>>>27)+v+C[_];T+=_<20?1518500249+(c&m|~c&y):_<40?1859775393+(c^m^y):_<60?(c&m|c&y|m&y)-1894007588:(c^m^y)-899497514,v=y,y=m,m=c<<30|c>>>2,c=r,r=T}f[0]=f[0]+r|0,f[1]=f[1]+c|0,f[2]=f[2]+m|0,f[3]=f[3]+y|0,f[4]=f[4]+v|0},_doFinalize:function(){var t=this._data,h=t.words,f=8*this._nDataBytes,r=8*t.sigBytes;return h[r>>>5]|=128<<24-r%32,h[14+(r+64>>>9<<4)]=Math.floor(f/4294967296),h[15+(r+64>>>9<<4)]=f,t.sigBytes=4*h.length,this._process(),this._hash},clone:function(){var t=v.clone.call(this);return t._hash=this._hash.clone(),t}}),c.SHA1=v._createHelper(w),c.HmacSHA1=v._createHmacHelper(w),r.SHA1)},function(t,h,f){var r;t.exports=(r=f(4),f(34),f(11),r.HmacSHA256)},function(t,h,f){var r;t.exports=(r=f(4),function(t){var h=r,f=h.lib,c=f.WordArray,m=f.Hasher,y=h.algo,v=[],_=[];!function(){function h(h){for(var f=t.sqrt(h),r=2;r<=f;r++)if(!(h%r))return!1;return!0}function f(t){return 4294967296*(t-(0|t))|0}for(var r=2,c=0;c<64;)h(r)&&(c<8&&(v[c]=f(t.pow(r,.5))),_[c]=f(t.pow(r,1/3)),c++),r++}();var C=[],w=y.SHA256=m.extend({_doReset:function(){this._hash=new c.init(v.slice(0))},_doProcessBlock:function(t,h){for(var f=this._hash.words,r=f[0],c=f[1],m=f[2],y=f[3],v=f[4],w=f[5],T=f[6],S=f[7],E=0;E<64;E++){if(E<16)C[E]=0|t[h+E];else{var A=C[E-15],R=(A<<25|A>>>7)^(A<<14|A>>>18)^A>>>3,O=C[E-2],D=(O<<15|O>>>17)^(O<<13|O>>>19)^O>>>10;C[E]=R+C[E-7]+D+C[E-16]}var x=r&c^r&m^c&m,L=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),b=S+((v<<26|v>>>6)^(v<<21|v>>>11)^(v<<7|v>>>25))+(v&w^~v&T)+_[E]+C[E];S=T,T=w,w=v,v=y+b|0,y=m,m=c,c=r,r=b+(L+x)|0}f[0]=f[0]+r|0,f[1]=f[1]+c|0,f[2]=f[2]+m|0,f[3]=f[3]+y|0,f[4]=f[4]+v|0,f[5]=f[5]+w|0,f[6]=f[6]+T|0,f[7]=f[7]+S|0},_doFinalize:function(){var h=this._data,f=h.words,r=8*this._nDataBytes,c=8*h.sigBytes;return f[c>>>5]|=128<<24-c%32,f[14+(c+64>>>9<<4)]=t.floor(r/4294967296),f[15+(c+64>>>9<<4)]=r,h.sigBytes=4*f.length,this._process(),this._hash},clone:function(){var t=m.clone.call(this);return t._hash=this._hash.clone(),t}});h.SHA256=m._createHelper(w),h.HmacSHA256=m._createHmacHelper(w)}(Math),r.SHA256)},function(t,h,f){const r=f(1),c=f(0),m=["created_at","updated_at","last_request_at"],y=["id","external_user_id"],v=r.urls.users+"/password/reset";function _(t){this.service=t}function C(t){let h=t.field in m?"date":typeof t.value;return c.isArray(t.value)&&("object"===h&&(h=typeof t.value[0]),t.value=t.value.toString()),[h,t.field,t.param,t.value].join(" ")}_.prototype={get:function(t,h){let f,v,_=[];t.order&&(t.order=function(t){const h=t.field in m?"date":t.field in y?"number":"string";return[t.sort,h,t.field].join(" ")}(t.order)),t&&t.filter&&(c.isArray(t.filter)?t.filter.forEach(function(t){v=C(t),_.push(v)}):(v=C(t.filter),_.push(v)),t.filter=_),"number"==typeof t?(f=t,t={}):t.login?f="by_login":t.full_name?f="by_full_name":t.facebook_id?f="by_facebook_id":t.twitter_id?f="by_twitter_id":t.phone?f="phone":t.email?f="by_email":t.tags?f="by_tags":t.external&&(f="external/"+t.external,t={});const w={url:c.getUrl(r.urls.users,f),data:t};this.service.ajax(w,function(t,f){t?h(t,null):h(null,f.user||f)})},signup:function(t,h){const f={url:c.getUrl(r.urls.users),type:"POST",data:{user:t}};this.service.ajax(f,function(t,f){t?h(t,null):h(null,f.user)})},update:function(t,h){const f={url:c.getUrl(r.urls.users,this.service.getCurrentUserId()),type:"PUT",data:{user:t}};this.service.ajax(f,function(t,f){t?h(t,null):h(null,f.user)})},delete:function(t){const h={url:c.getUrl(r.urls.users,this.service.getCurrentUserId()),type:"DELETE",dataType:"text"};this.service.ajax(h,t)},resetPassword:function(t,h){const f={url:c.getUrl(v),data:{email:t},dataType:"text"};this.service.ajax(f,h)}},t.exports=_},function(t,h,f){const r=f(1),c=f(0);function m(t){this.service=t}function y(t){const h=y.options,f=h.parser[h.strictMode?"strict":"loose"].exec(t);let r={},c=14;for(;c--;)r[h.key[c]]=f[c]||"";return r[h.q.name]={},r[h.key[12]].replace(h.q.parser,function(t,f,c){f&&(r[h.q.name][f]=c)}),r}m.prototype={list:function(t,h){"function"==typeof t&&void 0===h&&(h=t,t=null);const f={url:c.getUrl(r.urls.blobs),data:t,type:"GET"};this.service.ajax(f,function(t,f){h(t,t?null:f)})},create:function(t,h){const f={type:"POST",data:{blob:t},url:c.getUrl(r.urls.blobs)};this.service.ajax(f,function(t,f){h(t,t?null:f.blob)})},delete:function(t,h){const f={url:c.getUrl(r.urls.blobs,t),type:"DELETE",dataType:"text"};this.service.ajax(f,function(t,f){t?h(t,null):h(null,!0)})},createAndUpload:function(t,h){const f=this;let r,c,m,v,_,C={};JSON.parse(JSON.stringify(t)).file.data="...",r=t.file,c=t.name||r.name,m=t.type||r.type,v=t.size||r.size,C.name=c,C.content_type=m,t.public&&(C.public=t.public),t.tag_list&&(C.tag_list=t.tag_list),this.create(C,function(t,c){if(t)h(t,null);else{const t=y(c.blob_object_access.params);let m={url:t.protocol+"://"+t.authority+t.path},C={};_=c.id,c.size=v,Object.keys(t.queryKey).forEach(function(h){C[h]=decodeURIComponent(t.queryKey[h])}),C.file=r,m.data=C,f.upload(m,function(t,r){if(t)h(t,null);else{const t={id:_,size:v};f.markUploaded(t,function(t,f){t?h(t,null):h(null,c)})}})}})},upload:function(t,h){const f={type:"POST",dataType:"text",contentType:!1,url:t.url,data:t.data};this.service.ajax(f,function(t,f){t?h(t,null):h(null,{})})},markUploaded:function(t,h){const f={url:c.getUrl(r.urls.blobs,t.id+"/complete"),type:"PUT",data:{size:t.size},dataType:"text"};this.service.ajax(f,function(t,f){t?h(t,null):h(null,f)})},getInfo:function(t,h){const f={url:c.getUrl(r.urls.blobs,t)};this.service.ajax(f,function(t,f){t?h(t,null):h(null,f)})},getFile:function(t,h){const f={url:c.getUrl(r.urls.blobs,t)};this.service.ajax(f,function(t,f){t?h(t,null):h(null,f)})},update:function(t,h){let f={blob:{}};void 0!==t.name&&(f.blob.name=t.name);const m={url:c.getUrl(r.urls.blobs,t.id),data:f};this.service.ajax(m,function(t,f){t?h(t,null):h(null,f)})},privateUrl:function(t){return"https://"+r.endpoints.api+"/blobs/"+t+"?token="+this.service.getSession().token},publicUrl:function(t){return"https://"+r.endpoints.api+"/blobs/"+t}},t.exports=m,y.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}}},function(t,h,f){const r=f(1),c=f(0);function m(t){this.service=t}function y(t){this.service=t}m.prototype={create:function(t,h){const f={url:c.getUrl(r.urls.subscriptions),type:"POST",data:t};this.service.ajax(f,h)},list:function(t){const h={url:c.getUrl(r.urls.subscriptions)};this.service.ajax(h,t)},delete:function(t,h){const f={type:"DELETE",dataType:"text",url:c.getUrl(r.urls.subscriptions,t)};this.service.ajax(f,function(t,f){h(t||null)})}},y.prototype={create:function(t,h){const f={url:c.getUrl(r.urls.events),type:"POST",contentType:"application/json; charset=utf-8",isNeedStringify:!0,data:{event:t}};this.service.ajax(f,h)},list:function(t,h){"function"==typeof t&&void 0===h&&(h=t,t=null);const f={url:c.getUrl(r.urls.events),data:t};this.service.ajax(f,h)},get:function(t,h){const f={url:c.getUrl(r.urls.events,t)};this.service.ajax(f,h)},delete:function(t,h){const f={url:c.getUrl(r.urls.events,t),dataType:"text",type:"DELETE"};this.service.ajax(f,h)},status:function(t,h){const f={url:c.getUrl(r.urls.events,t+"/status")};this.service.ajax(f,h)}},t.exports=function(t){this.service=t,this.subscriptions=new m(t),this.events=new y(t),this.base64Encode=function(t){return c.toBase64(t)}}},function(t,h,f){const r=f(1),c=f(0);function m(t){this.service=t}m.prototype={create:function(t,h,f){const m={type:"POST",data:h,isNeedStringify:!0,contentType:"application/json; charset=utf-8",url:c.getUrl(r.urls.data,t)};this.service.ajax(m,function(t,h){f(t,t?null:h)})},list:function(t,h,f){void 0===f&&"function"==typeof h&&(f=h,h=null),this.service.ajax({url:c.getUrl(r.urls.data,t),data:h},function(t,h){f(t,t?null:h)})},update:function(t,h,f){const m={url:c.getUrl(r.urls.data,t+"/"+h._id),type:"PUT",contentType:"application/json; charset=utf-8",isNeedStringify:!0,data:h};this.service.ajax(m,function(t,h){f(t,t?null:h)})},delete:function(t,h,f){const m={id:1,ids:2,criteria:3};let y,v={deleted:[],deletedCount:0},_={type:"DELETE",dataType:"text"};"string"==typeof h?y=m.id:c.isArray(h)?y=m.ids:c.isObject(h)&&(y=m.criteria),y===m.id?_.url=c.getUrl(r.urls.data,t+"/"+h):y===m.ids?_.url=c.getUrl(r.urls.data,t+"/"+h.toString()):y===m.criteria&&(_.url=c.getUrl(r.urls.data,t+"/by_criteria"),_.data=h),this.service.ajax(_,function(t,r){if(t)f(t,null);else{let c;y===m.id?(v.deleted.push(h),v.deletedCount=v.deleted.length):y===m.ids?(c=JSON.parse(r),v.deleted=c.SuccessfullyDeleted.ids.slice(0),v.deletedCount=v.deleted.length):y===m.criteria&&(c=JSON.parse(r),v.deleted=null,v.deletedCount=c.total_deleted),f(t,v)}})},uploadFile:function(t,h,f){const m={url:c.getUrl(r.urls.data,t+"/"+h.id+"/file"),type:"POST",fileToCustomObject:!0,contentType:!1,data:{field_name:h.field_name,file:{data:h.file,name:h.name}}};this.service.ajax(m,function(t,h){f(t,t?null:h)})},downloadFile:function(t,h,f){f(null,this.fileUrl(t,h))},fileUrl:function(t,h){let f=c.getUrl(r.urls.data,t+"/"+h.id+"/file");return f+="?field_name="+h.field_name+"&token="+this.service.getSession().token},deleteFile:function(t,h,f){const m={url:c.getUrl(r.urls.data,t+"/"+h.id+"/file"),data:{field_name:h.field_name},dataType:"text",type:"DELETE"};this.service.ajax(m,function(t,h){f(t,!t||null)})}},t.exports=m},function(t,h,f){const r=f(0),c=f(1);function m(t){this.service=t}function y(t){const h=t.detail?t.detail:t.message.errors;return 404===t.code&&"Empty address book"===h[0]}m.prototype={uploadAddressBook:function(t,h,f){if(!r.isArray(t))return void new Error("First parameter must be an Array.");let m,y;r.isFunction(h)?y=h:(m=h,y=f);let v={contacts:t};m&&(m.force&&(v.force=m.force),m.udid&&(v.udid=m.udid));const _={type:"POST",url:r.getUrl(c.urls.addressbook),data:v,contentType:"application/json; charset=utf-8",isNeedStringify:!0};this.service.ajax(_,function(t,h){t?y(t,null):y(null,h)})},get:function(t,h){let f,m;if(r.isFunction(t)?m=t:(f=t,m=h),!r.isFunction(m))throw new Error("A callback function is required.");let v={type:"GET",url:r.getUrl(c.urls.addressbook),contentType:"application/json; charset=utf-8",isNeedStringify:!0};f&&(v.data={udid:f}),this.service.ajax(v,function(t,h){if(t){y(t)?m(null,[]):m(t,null)}else m(null,h)})},getRegisteredUsers:function(t,h){let f,m;if(r.isFunction(t)?m=t:(f=t,m=h),!r.isFunction(m))throw new Error("A callback function is required.");let v={type:"GET",url:r.getUrl(c.urls.addressbookRegistered),contentType:"application/json; charset=utf-8"};f&&(v.data={compact:1}),this.service.ajax(v,function(t,h){if(t){y(t)?m(null,[]):m(t,null)}else m(null,h)})}},t.exports=m},function(t,h,f){"use strict";const r=f(1),c=f(0),m=f(2),y=f(41),v=f(42),_=f(43),C=f(44),w=f(45),T=f(3).XMPPClient;function S(t){var h=this;if(h.webrtcSignalingProcessor=null,c.getEnv().browser)h.xmppClient=new T,h.xmppClient.XHandlerReferences=[],h.xmppClient.XAddTrackedHandler=function(t,f,r,c,m,y,v){h.xmppClient.XHandlerReferences.push(h.xmppClient.addHandler(t,f,r,c,m,y,v))},h.xmppClient.XDeleteHandlers=function(){for(;h.xmppClient.XHandlerReferences.length;)h.xmppClient.deleteHandler(h.xmppClient.XHandlerReferences.pop())};else{if(c.getEnv().nativescript?h.xmppClient=new T.Client({websocket:{url:r.chatProtocol.websocket},autostart:!1}):c.getEnv().node?h.xmppClient=new T({autostart:!1}):c.getEnv().reactnative&&(h.xmppClient=T.client({service:r.chatProtocol.websocket,credentials:function(t,f){return t({username:h.xmppClient.cbUserName,password:h.xmppClient.cbUserPassword})}})),c.getEnv().node||c.getEnv().nativescript){var f=h.xmppClient.send;h.xmppClient.send=function(t){c.DLog("[Chat]","SENT:",t.toString()),f.call(h.xmppClient,t)}}h.nodeStanzasCallbacks={}}this.service=t,this.isConnected=!1,this._isConnecting=!1,this._isLogout=!1,this._checkConnectionTimer=void 0,this.helpers=new y,this.xmppClientListeners=[];var S={xmppClient:h.xmppClient,helpers:h.helpers,nodeStanzasCallbacks:h.nodeStanzasCallbacks};this.contactList=new _(S),this.privacylist=new C(S),this.muc=new w(S),r.chat.streamManagement.enable&&(2===r.chatProtocol.active?(this.streamManagement=new v,h._sentMessageCallback=function(t,f){"function"==typeof h.onSentMessageCallback&&(f?h.onSentMessageCallback(null,f):h.onSentMessageCallback(t))}):c.DLog("[Chat] StreamManagement:",'BOSH protocol doesn\'t support stream management. Set WebSocket as the "chatProtocol" parameter to use this functionality.')),this._onMessage=function(t){var f,r,y,v=m.getAttr(t,"from"),_=m.getAttr(t,"type"),C=m.getAttr(t,"id"),w=m.getElement(t,"markable"),T=m.getElement(t,"received"),S=m.getElement(t,"displayed"),E=m.getElement(t,"composing"),A=m.getElement(t,"paused"),R=m.getElement(t,"invite"),O=m.getElement(t,"delay"),D=m.getElement(t,"extraParams"),x=m.getElementText(t,"body"),L=m.getElement(t,"forwarded"),b=L?m.getElement(L,"message"):null;r=(y=b?m.getAttr(b,"to"):null)?h.helpers.getIdFromNode(y):null;var N="groupchat"===_?h.helpers.getDialogIdFromNode(v):null,M="groupchat"===_?h.helpers.getIdFromResource(v):h.helpers.getIdFromNode(v),F=T||S||null;if(R)return!0;if(D&&(f=m.parseExtraParams(D)).dialogId&&(N=f.dialogId),E||A)return"function"!=typeof h.onMessageTypingListener||"chat"!==_&&"groupchat"!==_&&O||c.safeCallbackCall(h.onMessageTypingListener,!!E,M,N),!0;if(F)return T?"function"==typeof h.onDeliveredStatusListener&&"chat"===_&&c.safeCallbackCall(h.onDeliveredStatusListener,m.getAttr(T,"id"),N,M):"function"==typeof h.onReadStatusListener&&"chat"===_&&c.safeCallbackCall(h.onReadStatusListener,m.getAttr(S,"id"),N,M),!0;if(w&&M!=h.helpers.getIdFromNode(h.helpers.userCurrentJid(h.xmppClient))){var U={messageId:C,userId:M,dialogId:N};h.sendDeliveredStatus(U)}var P={id:C,dialog_id:N,recipient_id:r,type:_,body:x,extension:f?f.extension:null,delay:O};return w&&(P.markable=1),"function"!=typeof h.onMessageListener||"chat"!==_&&"groupchat"!==_||c.safeCallbackCall(h.onMessageListener,M,P),!0},this._onPresence=function(t){var f,r,y,v,_,C,w=m.getAttr(t,"from"),T=m.getAttr(t,"id"),S=m.getAttr(t,"type"),E=h.helpers.getIdFromNode(h.helpers.userCurrentJid(h.xmppClient)),A=m.getElement(t,"x");if(A&&(f=m.getAttr(A,"xmlns"),(r=m.getElement(A,"status"))&&(y=m.getAttr(r,"code"))),f&&"http://jabber.org/protocol/muc#user"==f){if(v=h.helpers.getDialogIdFromNode(w),_=h.helpers.getUserIdFromRoomJid(w),r&&"301"==y){if("function"==typeof h.onKickOccupant){var R=m.getElement(m.getElement(A,"item"),"actor"),O=m.getAttr(R,"jid");c.safeCallbackCall(h.onKickOccupant,v,h.helpers.getIdFromNode(O))}return delete h.muc.joinedRooms[h.helpers.getRoomJidFromRoomFullJid(w)],!0}if(!r&&_!=E)return S&&"unavailable"===S?("function"==typeof h.onLeaveOccupant&&c.safeCallbackCall(h.onLeaveOccupant,v,parseInt(_)),!0):("function"==typeof h.onJoinOccupant&&c.safeCallbackCall(h.onJoinOccupant,v,parseInt(_)),!0)}if(!c.getEnv().browser&&f)if("http://jabber.org/protocol/muc#user"==f){if(S&&"unavailable"===S)return r&&"110"==y&&"function"==typeof h.nodeStanzasCallbacks["muc:leave"]&&c.safeCallbackCall(h.nodeStanzasCallbacks["muc:leave"],null),!0;if(T.endsWith(":join")&&r&&"110"==y)return"function"==typeof h.nodeStanzasCallbacks[T]&&h.nodeStanzasCallbacks[T](t),!0}else if(S&&"error"===S&&"http://jabber.org/protocol/muc"==f)return T.endsWith(":join")&&"function"==typeof h.nodeStanzasCallbacks[T]&&h.nodeStanzasCallbacks[T](t),!0;if(_=h.helpers.getIdFromNode(w),C=h.contactList.contacts[_],S)switch(S){case"subscribe":C&&"to"===C.subscription?(C?C.ask=null:C={ask:null},C.subscription="both",h.contactList._sendSubscriptionPresence({jid:w,type:"subscribed"})):"function"==typeof h.onSubscribeListener&&c.safeCallbackCall(h.onSubscribeListener,_);break;case"subscribed":C&&"from"===C.subscription?(C?C.ask=null:C={ask:null},C.subscription="both"):(C?C.ask=null:C={ask:null},C.subscription="to","function"==typeof h.onConfirmSubscribeListener&&c.safeCallbackCall(h.onConfirmSubscribeListener,_));break;case"unsubscribed":C?C.ask=null:C={ask:null},C.subscription="none","function"==typeof h.onRejectSubscribeListener&&c.safeCallbackCall(h.onRejectSubscribeListener,_);break;case"unsubscribe":C?C.ask=null:C={ask:null},C.subscription="to";break;case"unavailable":"function"==typeof h.onContactListListener&&C&&"none"!==C.subscription&&c.safeCallbackCall(h.onContactListListener,_,S),_===E&&h.xmppClient.send(m.createPresenceStanza())}else"function"==typeof h.onContactListListener&&C&&"none"!==C.subscription&&c.safeCallbackCall(h.onContactListListener,_);return!0},this._onIQ=function(t){var f=m.getAttr(t,"id"),r=f.indexOf("lastActivity")>-1;if("function"==typeof h.onLastUserActivityListener&&r){var y=m.getAttr(t,"from"),v=h.helpers.getIdFromNode(y),_=m.getElement(t,"query"),C=m.getElement(t,"error")?void 0:+m.getAttr(_,"seconds");c.safeCallbackCall(h.onLastUserActivityListener,v,C)}return c.getEnv().browser||h.nodeStanzasCallbacks[f]&&(c.safeCallbackCall(h.nodeStanzasCallbacks[f],t),delete h.nodeStanzasCallbacks[f]),!0},this._onSystemMessageListener=function(t){var f,r=m.getAttr(t,"from"),y=(m.getAttr(t,"to"),m.getAttr(t,"id")),v=m.getElement(t,"extraParams"),_=h.helpers.getIdFromNode(r),C=m.getElement(t,"delay"),w=m.getElementText(v,"moduleIdentifier"),T=m.getElementText(t,"body"),S=m.parseExtraParams(v);return"SystemNotifications"===w&&"function"==typeof h.onSystemMessageListener?(f={id:y,userId:_,body:T,extension:S.extension},c.safeCallbackCall(h.onSystemMessageListener,f)):h.webrtcSignalingProcessor&&!C&&"WebRTCVideoChat"===w&&h.webrtcSignalingProcessor._onMessage(r,v,C,_,S.extension),!0},this._onMessageErrorListener=function(t){var f=m.getAttr(t,"id"),r=m.getErrorFromXMLNode(t);return"function"==typeof h.onMessageErrorListener&&c.safeCallbackCall(h.onMessageErrorListener,f,r),!0}}c.getEnv().browser&&(Strophe.addNamespace("CARBONS",m.MARKERS.CARBONS),Strophe.addNamespace("CHAT_MARKERS",m.MARKERS.CHAT),Strophe.addNamespace("PRIVACY_LIST",m.MARKERS.PRIVACY),Strophe.addNamespace("CHAT_STATES",m.MARKERS.STATES)),S.prototype={connect:function(t,h){c.DLog("[Chat]","Connect with parameters "+JSON.stringify(t));var f,y=this,v=m.buildUserJid(t),_="function"==typeof h;if(y._isConnecting)return f=c.getError(422,"REJECT - The connection is still in the CONNECTING state","Chat"),void(_&&h(f,null));if(y.isConnected)return c.DLog("[Chat]","CONNECTED - You are already connected"),void(_&&h(null,y.contactList.contacts));if(y._isConnecting=!0,y._isLogout=!1,c.getEnv().browser)y.xmppClient.connect(v,t.password,function(m){switch(m){case Strophe.Status.ERROR:y.isConnected=!1,y._isConnecting=!1,f=c.getError(422,"ERROR - An error has occurred","Chat"),_&&h(f,null);break;case Strophe.Status.CONNFAIL:y.isConnected=!1,y._isConnecting=!1,f=c.getError(422,"CONNFAIL - The connection attempt failed","Chat"),_&&h(f,null);break;case Strophe.Status.AUTHENTICATING:c.DLog("[Chat]","AUTHENTICATING");break;case Strophe.Status.AUTHFAIL:y.isConnected=!1,y._isConnecting=!1,f=c.getError(401,"Status.AUTHFAIL - The authentication attempt failed","Chat"),_&&h(f,null),y.isConnected||"function"!=typeof y.onReconnectFailedListener||c.safeCallbackCall(y.onReconnectFailedListener,f);break;case Strophe.Status.CONNECTING:c.DLog("[Chat]","Status.CONNECTING","(Chat Protocol - "+(1===r.chatProtocol.active?"BOSH":"WebSocket)"));break;case Strophe.Status.CONNECTED:y.xmppClient.XDeleteHandlers(),y.xmppClient.XAddTrackedHandler(y._onMessage,null,"message","chat"),y.xmppClient.XAddTrackedHandler(y._onMessage,null,"message","groupchat"),y.xmppClient.XAddTrackedHandler(y._onPresence,null,"presence"),y.xmppClient.XAddTrackedHandler(y._onIQ,null,"iq"),y.xmppClient.XAddTrackedHandler(y._onSystemMessageListener,null,"message","headline"),y.xmppClient.XAddTrackedHandler(y._onMessageErrorListener,null,"message","error"),y._postConnectActions(function(t){h(null,t)},_);break;case Strophe.Status.DISCONNECTING:c.DLog("[Chat]","DISCONNECTING");break;case Strophe.Status.DISCONNECTED:c.DLog("[Chat]","DISCONNECTED"),y.isConnected&&"function"==typeof y.onDisconnectedListener&&c.safeCallbackCall(y.onDisconnectedListener),y.isConnected=!1,y._isConnecting=!1,y._establishConnection(t);break;case Strophe.Status.ATTACHED:c.DLog("[Chat]","Status.ATTACHED")}});else if(c.getEnv().node||c.getEnv().nativescript)y.xmppClient.removeAllListeners(),y.xmppClient.on("connect",function(){c.DLog("[Chat]","CONNECTING","(Chat Protocol - "+(1===r.chatProtocol.active?"BOSH":"WebSocket)"))}),y.xmppClient.on("auth",function(){c.DLog("[Chat]","AUTHENTICATING")}),y.xmppClient.on("online",function(){c.DLog("[Chat]","ONLINE"),y._postConnectActions(function(t){h(null,t)},_)}),y.xmppClient.on("stanza",function(t){c.DLog("[Chat] RECV:",t.toString()),t.is("presence")?y._onPresence(t):t.is("iq")?y._onIQ(t):t.is("message")&&("headline"===t.attrs.type?y._onSystemMessageListener(t):"error"===t.attrs.type?y._onMessageErrorListener(t):y._onMessage(t))}),y.xmppClient.on("disconnect",function(){c.DLog("[Chat]","DISCONNECTED"),"function"==typeof y.onDisconnectedListener&&c.safeCallbackCall(y.onDisconnectedListener),y.isConnected=!1,y._isConnecting=!1,y._establishConnection(t)}),y.xmppClient.on("error",function(){c.DLog("[Chat]","ERROR"),f=c.getError(422,"ERROR - An error has occurred","Chat"),_&&h(f,null),y.isConnected=!1,y._isConnecting=!1}),y.xmppClient.on("end",function(){y.xmppClient.removeAllListeners()}),y.xmppClient.options.jid=v,y.xmppClient.options.password=t.password,y.xmppClient.connect();else{if(!c.getEnv().reactnative)throw"Unsupported platform for Chat/XMPP functionality";{y.xmppClientListeners.forEach(function(t){y.xmppClient.removeListener(t.name,t.callback)}),y.xmppClientListeners=[];const f=function(){c.DLog("[Chat]","CONNECTING")};y.xmppClient.on("connect",f),y.xmppClientListeners.push({name:"connect",callback:f});const r=function(t){c.DLog("[Chat]","ONLINE"),y._postConnectActions(function(t){h(null,t)},_)};y.xmppClient.on("online",r),y.xmppClientListeners.push({name:"online",callback:r});const v=function(){c.DLog("[Chat]","OFFLINE")};y.xmppClient.on("offline",v),y.xmppClientListeners.push({name:"offline",callback:v});const C=function(h){c.DLog("[Chat]","DISCONNECTED");var f=function(){y.isConnected=!1,y._isConnecting=!1};y.isConnected&&"function"==typeof y.onDisconnectedListener?(f(),c.safeCallbackCall(y.onDisconnectedListener)):f(),y._establishConnection(t)};y.xmppClient.on("disconnect",C),y.xmppClientListeners.push({name:"disconnect",callback:C});const w=function(t,h){c.DLog("[Chat]","status",t,h?h.toString():"")};y.xmppClient.on("status",w),y.xmppClientListeners.push({name:"status",callback:w});const T=function(t){t.is("presence")?y._onPresence(t):t.is("iq")?y._onIQ(t):t.is("message")&&("headline"===t.attrs.type?y._onSystemMessageListener(t):"error"===t.attrs.type?y._onMessageErrorListener(t):y._onMessage(t))};y.xmppClient.on("stanza",T),y.xmppClientListeners.push({name:"stanza",callback:T});const S=function(t){c.DLog("[Chat]","ERROR:",t),_&&("SASLError"==t.name&&(t=t.condition),h(t,null)),y.isConnected=!1,y._isConnecting=!1};y.xmppClient.on("error",S),y.xmppClientListeners.push({name:"error",callback:S});const E=function(t){c.DLog("[Chat]","SENT:",t)};y.xmppClient.on("output",E),y.xmppClientListeners.push({name:"output",callback:E});const A=function(t){c.DLog("[Chat]","RECV:",t)};y.xmppClient.on("input",A),y.xmppClientListeners.push({name:"input",callback:A}),Object.defineProperty(y.xmppClient,"cbUserName",{value:m.buildUserJidLocalPart(t.userId),writable:!1}),Object.defineProperty(y.xmppClient,"cbUserPassword",{value:t.password,writable:!1}),y.xmppClient.start()}}},_postConnectActions:function(t,h){c.DLog("[Chat]","CONNECTED");var f=this,y=m.createPresenceStanza();if(r.chat.streamManagement.enable&&2===r.chatProtocol.active&&(f.streamManagement.enable(f.xmppClient),f.streamManagement.sentMessageCallback=f._sentMessageCallback),f.helpers.setUserCurrentJid(f.helpers.userCurrentJid(f.xmppClient)),f.isConnected=!0,f._isConnecting=!1,f._enableCarbons(),h)f.contactList.get(function(h){f.xmppClient.send(y),f.contactList.contacts=h,t(f.contactList.contacts)});else{var v=Object.keys(f.muc.joinedRooms);f.xmppClient.send(y),c.DLog("[Chat]","Re-joining "+v.length+" rooms...");for(var _=0,C=v.length;_<C;_++)f.muc.join(v[_]);"function"==typeof f.onReconnectListener&&c.safeCallbackCall(f.onReconnectListener)}},_establishConnection:function(t){var h=this;if(!h._isLogout&&!h._checkConnectionTimer){var f=function(){h.isConnected||h._isConnecting?(clearInterval(h._checkConnectionTimer),h._checkConnectionTimer=void 0):h.connect(t)};f(),h._checkConnectionTimer=setInterval(function(){f()},1e3*r.chat.reconnectionTimeInterval)}},send:function(t,h){var f={from:this.helpers.getUserCurrentJid(),to:this.helpers.jidOrUserId(t),type:h.type?h.type:"chat",id:h.id?h.id:c.getBsonObjectId()},y=m.createMessageStanza(f);return h.body&&y.c("body",{xmlns:m.MARKERS.CLIENT}).t(h.body).up(),h.markable&&y.c("markable",{xmlns:m.MARKERS.CHAT}).up(),h.extension&&(y.c("extraParams",{xmlns:m.MARKERS.CLIENT}),y=m.filledExtraParams(y,h.extension)),r.chat.streamManagement.enable?(h.id=f.id,this.xmppClient.send(y,h)):this.xmppClient.send(y),f.id},sendSystemMessage:function(t,h){var f={type:"headline",id:h.id?h.id:c.getBsonObjectId(),to:this.helpers.jidOrUserId(t)},r=m.createMessageStanza(f);return h.body&&r.c("body",{xmlns:m.MARKERS.CLIENT}).t(h.body).up(),h.extension&&(r.c("extraParams",{xmlns:m.MARKERS.CLIENT}).c("moduleIdentifier").t("SystemNotifications").up(),r=m.filledExtraParams(r,h.extension)),this.xmppClient.send(r),f.id},sendIsTypingStatus:function(t){var h={from:this.helpers.getUserCurrentJid(),to:this.helpers.jidOrUserId(t),type:this.helpers.typeChat(t)},f=m.createMessageStanza(h);f.c("composing",{xmlns:m.MARKERS.STATES}),this.xmppClient.send(f)},sendIsStopTypingStatus:function(t){var h={from:this.helpers.getUserCurrentJid(),to:this.helpers.jidOrUserId(t),type:this.helpers.typeChat(t)},f=m.createMessageStanza(h);f.c("paused",{xmlns:m.MARKERS.STATES}),this.xmppClient.send(f)},sendDeliveredStatus:function(t){var h={type:"chat",from:this.helpers.getUserCurrentJid(),id:c.getBsonObjectId(),to:this.helpers.jidOrUserId(t.userId)},f=m.createMessageStanza(h);f.c("received",{xmlns:m.MARKERS.MARKERS,id:t.messageId}).up(),f.c("extraParams",{xmlns:m.MARKERS.CLIENT}).c("dialog_id").t(t.dialogId),this.xmppClient.send(f)},sendReadStatus:function(t){var h={type:"chat",from:this.helpers.getUserCurrentJid(),to:this.helpers.jidOrUserId(t.userId),id:c.getBsonObjectId()},f=m.createMessageStanza(h);f.c("displayed",{xmlns:m.MARKERS.MARKERS,id:t.messageId}).up(),f.c("extraParams",{xmlns:m.MARKERS.CLIENT}).c("dialog_id").t(t.dialogId),this.xmppClient.send(f)},getLastUserActivity:function(t){var h={from:this.helpers.getUserCurrentJid(),id:this.helpers.getUniqueId("lastActivity"),to:this.helpers.jidOrUserId(t),type:"get"},f=m.createIqStanza(h);f.c("query",{xmlns:m.MARKERS.LAST}),this.xmppClient.send(f)},disconnect:function(){clearInterval(this._checkConnectionTimer),this._checkConnectionTimer=void 0,this.muc.joinedRooms={},this._isLogout=!0,this.helpers.setUserCurrentJid(""),c.getEnv().browser?(this.xmppClient.flush(),this.xmppClient.disconnect()):c.getEnv().reactnative?this.xmppClient.stop():this.xmppClient.end()},_enableCarbons:function(){var t={type:"set",from:this.helpers.getUserCurrentJid(),id:m.getUniqueId("enableCarbons")},h=m.createIqStanza(t);h.c("enable",{xmlns:m.MARKERS.CARBONS}),c.getEnv().browser?this.xmppClient.sendIQ(h):this.xmppClient.send(h)}},t.exports=S},function(t,h,f){"use strict";const r=f(0),c=f(1),m=f(2);function y(){this._userCurrentJid=""}y.prototype={getUniqueId:m.getUniqueId,jidOrUserId:function(t){var h;if("string"==typeof t)h=t;else{if("number"!=typeof t)throw new Error('The method "jidOrUserId" may take jid or id');h=t+"-"+c.creds.appId+"@"+c.endpoints.chat}return h},typeChat:function(t){var h;if("string"==typeof t)h=t.indexOf("muc")>-1?"groupchat":"chat";else{if("number"!=typeof t)throw new Error("Unsupported chat type");h="chat"}return h},getRecipientId:function(t,h){var f=null;return t.forEach(function(t){t!=h&&(f=t)}),f},getUserJid:function(t,h){return h?t+"-"+h+"@"+c.endpoints.chat:t+"-"+c.creds.appId+"@"+c.endpoints.chat},getUserNickWithMucDomain:function(t){return c.endpoints.muc+"/"+t},getIdFromNode:function(t){return t.indexOf("@")<0?null:parseInt(t.split("@")[0].split("-")[0])},getDialogIdFromNode:function(t){return t.indexOf("@")<0?null:t.split("@")[0].split("_")[1]},getRoomJidFromDialogId:function(t){return c.creds.appId+"_"+t+"@"+c.endpoints.muc},getRoomJid:function(t){return t+"/"+this.getIdFromNode(this._userCurrentJid)},getIdFromResource:function(t){var h=t.split("/");return h.length<2?null:(h.splice(0,1),parseInt(h.join("/")))},getRoomJidFromRoomFullJid:function(t){var h=t.split("/");return h.length<2?null:h[0]},getBsonObjectId:function(){return r.getBsonObjectId()},getUserIdFromRoomJid:function(t){var h=t.toString().split("/");return 0===h.length?null:h[h.length-1]},userCurrentJid:function(t){return r.getEnv().browser?t.jid:r.getEnv().reactnative?t.jid._local+"@"+t.jid._domain+"/"+t.jid._resource:t.jid.user+"@"+t.jid._domain+"/"+t.jid._resource},getUserCurrentJid:function(){return this._userCurrentJid},setUserCurrentJid:function(t){this._userCurrentJid=t},getDialogJid:function(t){return t.indexOf("@")>0?t:this.getRoomJidFromDialogId(t)}},t.exports=y},function(t,h,f){"use strict";const r=f(0),c=f(2);function m(){this._NS="urn:xmpp:sm:3",this._isStreamManagementEnabled=!1,this._clientProcessedStanzasCounter=null,this._clientSentStanzasCounter=null,this._timeInterval=2e3,this.sentMessageCallback=null,r.getEnv().browser&&(this._parser=new DOMParser),this._c=null,this._originalSend=null,this._stanzasQueue=[]}m.prototype.enable=function(t){var h,f={xmlns:this._NS};this._isStreamManagementEnabled||(this._c=t,this._originalSend=this._c.send,this._c.send=this.send.bind(this)),r.getEnv().browser&&(this._clientProcessedStanzasCounter=null,this._clientSentStanzasCounter=null),this._addEnableHandlers(),h=c.createNonza("enable",f),this._c.send(h)},m.prototype._timeoutCallback=function(){var t=Date.now(),h=[];if(this._stanzasQueue.length){for(var f=0;f<this._stanzasQueue.length;f++)this._stanzasQueue[f]&&this._stanzasQueue[f].time<t?this.sentMessageCallback(this._stanzasQueue[f].message):h.push(this._stanzasQueue[f]);this._stanzasQueue=h}},m.prototype._addEnableHandlers=function(){var t=this;function h(h){var f=h.name||h.tagName||h.nodeTree.tagName;if("enabled"===f)return t._isStreamManagementEnabled=!0,setInterval(t._timeoutCallback.bind(t),t._timeInterval),!0;if(c.getAttr(h,"xmlns")!==t._NS&&t._increaseReceivedStanzasCounter(),"r"===f){var r={xmlns:t._NS,h:t._clientProcessedStanzasCounter},m=c.createNonza("a",r);return t._originalSend.call(t._c,m),!0}if("a"===f){var y=parseInt(c.getAttr(h,"h"));t._checkCounterOnIncomeStanza(y)}return!0}r.getEnv().browser?t._c.XAddTrackedHandler(h.bind(t)):r.getEnv().reactnative?t._c.on("element",h.bind(t)):t._c.on("stanza",h.bind(t))},m.prototype.send=function(t,h){var f=t.nodeTree?this._parser.parseFromString(t.nodeTree.outerHTML,"application/xml").childNodes[0]:t,r=f.name||f.tagName||f.nodeTree.tagName,m=c.getAttr(f,"type"),y=c.getElementText(f,"body")||"",v=c.getAllElements(f,"attachment")||"";this._originalSend.call(this._c,t),"message"!==r||"chat"!==m&&"groupchat"!==m||!y&&!v.length||this._sendStanzasRequest({message:h,time:Date.now()+this._timeInterval,expect:this._clientSentStanzasCounter}),this._clientSentStanzasCounter++},m.prototype._sendStanzasRequest=function(t){if(this._isStreamManagementEnabled){this._stanzasQueue.push(t);var h=c.createNonza("r",{xmlns:this._NS});this._originalSend.call(this._c,h)}},m.prototype.getClientSentStanzasCounter=function(){return this._clientSentStanzasCounter},m.prototype._checkCounterOnIncomeStanza=function(t){this._stanzasQueue[0].expect!==t?this.sentMessageCallback(this._stanzasQueue[0].message):this.sentMessageCallback(null,this._stanzasQueue[0].message),this._stanzasQueue.shift()},m.prototype._increaseReceivedStanzasCounter=function(){this._clientProcessedStanzasCounter++},t.exports=m},function(t,h,f){const r=f(2),c=f(0),m=f(1);function y(t){this.helpers=t.helpers,this.xmppClient=t.xmppClient,this.nodeStanzasCallbacks=t.nodeStanzasCallbacks,this.contacts={}}y.prototype={get:function(t){const h=this,f=r.getUniqueId("getRoster");let y={},v=r.createIqStanza({type:"get",from:this.helpers.getUserCurrentJid(),id:f});function _(f){const v=function(t){return c.getEnv().browser?t.getElementsByTagName("item"):t.getChild("query").children}(f);for(let t=0,f=v.length;t<f;t++){const f=h.helpers.getIdFromNode(r.getAttr(v[t],"jid")),c=r.getAttr(v[t],"ask"),_=r.getAttr(v[t],"subscription"),C=r.getAttr(v[t],"name"),w=f+"-"+m.creds.appId!==C;y[f]={subscription:_,ask:c||null,name:w?C:null}}t(y)}v.c("query",{xmlns:r.MARKERS.ROSTER}),c.getEnv().browser?h.xmppClient.sendIQ(v,_):(h.nodeStanzasCallbacks[f]=_,h.xmppClient.send(v))},add:function(t,h){const f=this,m=t.userId||t,y=f.helpers.jidOrUserId(m),v=r.getUniqueId("addContactInRoster");let _=r.createIqStanza({type:"set",from:f.helpers.getUserCurrentJid(),id:v});function C(){f._sendSubscriptionPresence({jid:y,type:"subscribe"}),"function"==typeof h&&h()}f.contacts[m]={subscription:"none",ask:"subscribe",name:t.name||null},_.c("query",{xmlns:r.MARKERS.ROSTER}).c("item",{jid:y,name:t.name||null}),c.getEnv().browser?f.xmppClient.sendIQ(_,C):(f.nodeStanzasCallbacks[v]=C,f.xmppClient.send(_))},confirm:function(t,h){const f=t.userId||t,r=this.helpers.jidOrUserId(f);function c(){"function"==typeof h&&h()}this._sendSubscriptionPresence({jid:r,type:"subscribed"}),m.chat.contactList.subscriptionMode.mutual?this.add(t,function(){c()}):c()},reject:function(t,h){const f=this.helpers.jidOrUserId(t);this.contacts[t]={subscription:"none",ask:null},this._sendSubscriptionPresence({jid:f,type:"unsubscribed"}),"function"==typeof h&&h()},updateName:function(t,h){const f=this.helpers.jidOrUserId(t.userId),m=r.getUniqueId("updateContactInRoster");let y=this.contacts[t.userId];if(!c.isObject(y))return void _("No contact exists with provided user id");y.name=t.name||null;let v=r.createIqStanza({type:"set",from:this.helpers.getUserCurrentJid(),id:m});function _(t){"function"==typeof h&&(t?h(t):h())}v.c("query",{xmlns:r.MARKERS.ROSTER}).c("item",{jid:f,name:t.name||null}),c.getEnv().browser?this.xmppClient.sendIQ(v,_):(this.nodeStanzasCallbacks[m]=_,this.xmppClient.send(v))},remove:function(t,h){const f=this,m=this.helpers.jidOrUserId(t),y=r.getUniqueId("removeConactInRoster");let v=r.createIqStanza({type:"set",from:this.helpers.getUserCurrentJid(),id:y});function _(){delete f.contacts[t],"function"==typeof h&&h()}v.c("query",{xmlns:r.MARKERS.ROSTER}).c("item",{jid:m,subscription:"remove"}),c.getEnv().browser?f.xmppClient.sendIQ(v,_):(f.nodeStanzasCallbacks[y]=_,f.xmppClient.send(v))},_sendSubscriptionPresence:function(t){const h={to:t.jid,type:t.type},f=r.createPresenceStanza(h);this.xmppClient.send(f)}},t.exports=y},function(t,h,f){const r=f(2),c=f(0);function m(t){this.helpers=t.helpers,this.xmppClient=t.xmppClient,this.nodeStanzasCallbacks=t.nodeStanzasCallbacks}m.prototype={create:function(t,h){const f=this;let m,y,v,_,C,w={},T=[];for(let h=t.items.length-1;h>=0;h--){const f=t.items[h];w[f.user_id]={action:f.action,mutualBlock:!0===f.mutualBlock}}T=Object.keys(w);const S={type:"set",from:f.helpers.getUserCurrentJid(),id:r.getUniqueId("edit")};let E=r.createIqStanza(S);function A(t,h){if(c.getEnv().browser)t.c("item",{type:"jid",value:h.jidOrMuc,action:h.userAction,order:h.order}).c("message",{}).up().c("presence-in",{}).up().c("presence-out",{}).up().c("iq",{}).up().up();else{t.getChild("query").getChild("list").c("item",{type:"jid",value:h.jidOrMuc,action:h.userAction,order:h.order}).c("message",{}).up().c("presence-in",{}).up().c("presence-out",{}).up().c("iq",{}).up().up()}return t}function R(t,h){if(c.getEnv().browser)t.c("item",{type:"jid",value:h.jidOrMuc,action:h.userAction,order:h.order}).up();else{t.getChild("query").getChild("list").c("item",{type:"jid",value:h.jidOrMuc,action:h.userAction,order:h.order}).up()}return t}E.c("query",{xmlns:r.MARKERS.PRIVACY}).c("list",{name:t.name});for(let t=0,h=0,r=T.length;t<r;t++,h+=2)C=w[m=T[t]].mutualBlock,_=w[m].action,y=f.helpers.jidOrUserId(parseInt(m,10)),v=f.helpers.getUserNickWithMucDomain(m),C&&"deny"===_?(E=R(E,{order:h+1,jidOrMuc:y,userAction:_}),E=R(E,{order:h+2,jidOrMuc:v,userAction:_}).up().up()):(E=A(E,{order:h+1,jidOrMuc:y,userAction:_}),E=A(E,{order:h+2,jidOrMuc:v,userAction:_}));c.getEnv().browser?f.xmppClient.sendIQ(E,function(t){h(null)},function(t){h(t?r.getErrorFromXMLNode(t):c.getError(408))}):(f.xmppClient.send(E),f.nodeStanzasCallbacks[S.id]=function(t){t.getChildElements("error").length?h(c.getError(408)):h(null)})},getList:function(t,h){const f=this;let m,y,v,_=[],C={};const w={type:"get",from:f.helpers.getUserCurrentJid(),id:r.getUniqueId("getlist")};let T=r.createIqStanza(w);T.c("query",{xmlns:r.MARKERS.PRIVACY}).c("list",{name:t}),c.getEnv().browser?f.xmppClient.sendIQ(T,function(r){for(let t=0,h=(m=r.getElementsByTagName("item")).length;t<h;t+=2)y=m[t].getAttribute("value"),v=f.helpers.getIdFromNode(y),_.push({user_id:v,action:m[t].getAttribute("action")});h(null,C={name:t,items:_})},function(t){h(t?r.getErrorFromXMLNode(t):c.getError(408),null)}):(f.nodeStanzasCallbacks[w.id]=function(t){const r=t.getChild("query");C=r?r.getChild("list"):null;for(let t=0,h=(m=C?C.getChildElements("item"):null).length;t<h;t+=2)y=m[t].attrs.value,v=f.helpers.getIdFromNode(y),_.push({user_id:v,action:m[t].attrs.action});C={name:C.attrs.name,items:_},h(null,C),delete f.nodeStanzasCallbacks[w.id]},f.xmppClient.send(T))},update:function(t,h){const f=this;f.getList(t.name,function(r,m){if(r)h(r,null);else{const y={items:c.MergeArrayOfObjects(m.items,t.items),name:t.name};f.create(y,function(t,f){r?h(t,null):h(null,f)})}})},getNames:function(t){const h=this,f={type:"get",from:h.helpers.getUserCurrentJid(),id:r.getUniqueId("getNames")};let m=r.createIqStanza(f);m.c("query",{xmlns:r.MARKERS.PRIVACY}),c.getEnv().browser?h.xmppClient.sendIQ(m,function(h){const f=h.getElementsByTagName("default"),r=h.getElementsByTagName("active"),c=h.getElementsByTagName("list");let m=f&&f.length>0?f[0].getAttribute("name"):null,y=r&&r.length>0?r[0].getAttribute("name"):null,v=[];for(let t=0,h=c.length;t<h;t++)v.push(c[t].getAttribute("name"));t(null,{default:m,active:y,names:v})},function(h){t(h?r.getErrorFromXMLNode(h):c.getError(408),null)}):(h.nodeStanzasCallbacks[m.attrs.id]=function(h){if("error"!==h.attrs.type){const f=h.getChild("query"),r=f.getChild("default"),c=f.getChild("active"),m=f.getChildElements("list");let y=r?r.attrs.name:null,v=c?c.attrs.name:null,_=[];for(let t=0,h=m.length;t<h;t++)_.push(m[t].attrs.name);t(null,{default:y,active:v,names:_})}else t(c.getError(408))},h.xmppClient.send(m))},delete:function(t,h){const f={from:this.xmppClient.jid||this.xmppClient.jid.user,type:"set",id:r.getUniqueId("remove")};let m=r.createIqStanza(f);m.c("query",{xmlns:r.MARKERS.PRIVACY}).c("list",{name:t||""}),c.getEnv().browser?this.xmppClient.sendIQ(m,function(t){h(null)},function(t){h(t?r.getErrorFromXMLNode(t):c.getError(408))}):(this.nodeStanzasCallbacks[m.attrs.id]=function(t){t.getChildElements("error").length?h(c.getError(408)):h(null)},this.xmppClient.send(m))},setAsDefault:function(t,h){const f={from:this.xmppClient.jid||this.xmppClient.jid.user,type:"set",id:r.getUniqueId("default")};let m=r.createIqStanza(f);m.c("query",{xmlns:r.MARKERS.PRIVACY}).c("default",t&&t.length>0?{name:t}:{}),c.getEnv().browser?this.xmppClient.sendIQ(m,function(t){h(null)},function(t){h(t?r.getErrorFromXMLNode(t):c.getError(408))}):(this.nodeStanzasCallbacks[m.attrs.id]=function(t){t.getChildElements("error").length?h(c.getError(408)):h(null)},this.xmppClient.send(m))}},t.exports=m},function(t,h,f){const r=f(2),c=f(0);function m(t){this.helpers=t.helpers,this.xmppClient=t.xmppClient,this.nodeStanzasCallbacks=t.nodeStanzasCallbacks,this.joinedRooms={}}m.prototype={join:function(t,h){const f=this,m=r.getUniqueId("join"),y=this.helpers.getDialogJid(t),v={id:m,from:f.helpers.getUserCurrentJid(),to:f.helpers.getRoomJid(y)};let _=r.createPresenceStanza(v);function C(t){const y=r.getAttr(t,"from"),v=f.helpers.getDialogIdFromNode(y),_=r.getElement(t,"x"),C=r.getAttr(_,"xmlns"),w=r.getElement(_,"status"),T=r.getAttr(w,"code");if(1==h.length)return c.safeCallbackCall(h,t),!0;if(w&&"110"==T)c.safeCallbackCall(h,null,{dialogId:v});else{const f=r.getAttr(t,"type");if(f&&"error"===f&&"http://jabber.org/protocol/muc"==C&&m.endsWith(":join")){const f=r.getElement(t,"error"),m=r.getAttr(f,"code"),y=r.getElementText(f,"text");c.safeCallbackCall(h,{code:m||500,message:y||"Unknown issue"},{dialogId:v})}}}_.c("x",{xmlns:r.MARKERS.MUC}).c("history",{maxstanzas:0}),this.joinedRooms[y]=!0,c.getEnv().browser?"function"==typeof h&&f.xmppClient.XAddTrackedHandler(C,null,"presence",null,m):"function"==typeof h&&(f.nodeStanzasCallbacks[m]=C),f.xmppClient.send(_)},leave:function(t,h){const f=this,m={type:"unavailable",from:f.helpers.getUserCurrentJid(),to:f.helpers.getRoomJid(t)};let y=r.createPresenceStanza(m);if(delete this.joinedRooms[t],c.getEnv().browser){const r=f.helpers.getRoomJid(t);"function"==typeof h&&f.xmppClient.XAddTrackedHandler(h,null,"presence",m.type,null,r)}else"function"==typeof h&&(f.nodeStanzasCallbacks["muc:leave"]=h);f.xmppClient.send(y)},listOnlineUsers:function(t,h){const f=this,m={type:"get",to:t,from:f.helpers.getUserCurrentJid(),id:r.getUniqueId("muc_disco_items")};let y=r.createIqStanza(m);y.c("query",{xmlns:"http://jabber.org/protocol/disco#items"}),c.getEnv().browser?f.xmppClient.sendIQ(y,function(t){const r=t.getElementsByTagName("item");let c=[];for(let t=0,h=r.length;t<h;t++){let h=f.helpers.getUserIdFromRoomJid(r[t].getAttribute("jid"));c.push(parseInt(h))}h(c)}):(f.xmppClient.send(y),f.nodeStanzasCallbacks[m.id]=function(t){var r=t.attrs.id;if(f.nodeStanzasCallbacks[r]){const r=t.getChild("query").getChildElements("item");let y=[];for(var c=0,m=r.length;c<m;c++){let t=f.helpers.getUserIdFromRoomJid(r[c].attrs.jid);y.push(parseInt(t))}h(y)}})}},t.exports=m},function(t,h,f){const r=f(1),c=f(0),m=r.urls.chat+"/Dialog";function y(t){this.service=t}y.prototype={list:function(t,h){"function"==typeof t&&void 0===h&&(h=t,t={});const f={url:c.getUrl(m),data:t};this.service.ajax(f,h)},create:function(t,h){t&&t.occupants_ids&&c.isArray(t.occupants_ids)&&(t.occupants_ids=t.occupants_ids.join(", "));const f={url:c.getUrl(m),type:"POST",data:t};this.service.ajax(f,h)},update:function(t,h,f){const r={url:c.getUrl(m,t),type:"PUT",contentType:"application/json; charset=utf-8",isNeedStringify:!0,data:h};this.service.ajax(r,f)},delete:function(t,h,f){var r={url:c.getUrl(m,t),type:"DELETE",dataType:"text"};2===arguments.length?this.service.ajax(r,h):3===arguments.length&&(r.data=h,this.service.ajax(r,f))}},t.exports=y},function(t,h,f){const r=f(1),c=f(0),m=r.urls.chat+"/Message";function y(t){this.service=t}y.prototype={list:function(t,h){const f={url:c.getUrl(m),data:t};this.service.ajax(f,h)},create:function(t,h){const f={url:c.getUrl(m),type:"POST",data:t};this.service.ajax(f,h)},update:function(t,h,f){const r={type:"PUT",dataType:"text",url:c.getUrl(m,t),data:h};this.service.ajax(r,f)},delete:function(t,h,f){const r={url:c.getUrl(m,t),type:"DELETE",dataType:"text"};2===arguments.length?this.service.ajax(r,h):3===arguments.length&&(r.data=h,this.service.ajax(r,f))},unreadCount:function(t,h){t&&t.chat_dialog_ids&&c.isArray(t.chat_dialog_ids)&&(t.chat_dialog_ids=t.chat_dialog_ids.join(", "));const f={url:c.getUrl(m+"/unread"),data:t};this.service.ajax(f,h)}},t.exports=y},function(t,h,f){"use strict";var r=f(49),c=f(50),m=f(51),y=f(5),v=f(12),_=f(6),C=f(0);function w(t,h){return w.__instance?w.__instance:this===window?new w:(w.__instance=this,this.connection=h,this.signalingProcessor=new c(t,this,h),this.signalingProvider=new m(t,h),this.SessionConnectionState=y.SessionConnectionState,this.CallType=y.CallType,this.PeerConnectionState=v.State,this.sessions={},void(navigator.mediaDevices&&(navigator.mediaDevices.ondevicechange=this._onDevicesChangeListener.bind(this))))}w.prototype.getMediaDevices=function(t){var h=[],f="Browser does not support output device selection.";return new Promise(function(r,c){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then(function(f){t?(f.forEach(function(f,r){f.kind===t&&h.push(f)}),r(h)):r(f)}):(c(f),y.traceWarning(f))})},w.prototype.sessions={},w.prototype.createNewSession=function(t,h,f,c){var m=function(t){var h=[];Object.keys(t).length>0&&Object.keys(t).forEach(function(f,c,m){var y=t[f];y.state!==r.State.NEW&&y.state!==r.State.ACTIVE||h.push(y.opponentsIDs)});return h}(this.sessions),v=f||y.getIdFromNode(this.connection.jid),_=c&&c.bandwidth&&!isNaN(c.bandwidth)?+c.bandwidth:0,C=h||2;if(!t)throw new Error("Can't create a session without the opponentsIDs.");if(function(t,h){var f=!1,r=h.sort();t.length&&t.forEach(function(t){var h=t.sort();f=h.length==r.length&&h.every(function(t,h){return t===r[h]})});return f}(m,t))throw new Error("Can't create a session with the same opponentsIDs. There is a session already in NEW or ACTIVE state.");return this._createAndStoreSession(null,v,t,C,_)},w.prototype._createAndStoreSession=function(t,h,f,c,m){var v=new r({sessionID:t,initiatorID:h,opIDs:f,callType:c,signalingProvider:this.signalingProvider,currentUserID:y.getIdFromNode(this.connection.jid),bandwidth:m});return v.onUserNotAnswerListener=this.onUserNotAnswerListener,v.onRemoteStreamListener=this.onRemoteStreamListener,v.onSessionConnectionStateChangedListener=this.onSessionConnectionStateChangedListener,v.onSessionCloseListener=this.onSessionCloseListener,v.onCallStatsReport=this.onCallStatsReport,this.sessions[v.ID]=v,v},w.prototype.clearSession=function(t){delete w.sessions[t]},w.prototype.isExistNewOrActiveSessionExceptSessionID=function(t){var h=this,f=!1;return Object.keys(h.sessions).length>0&&Object.keys(h.sessions).forEach(function(c,m,y){var v=h.sessions[c];v.state!==r.State.NEW&&v.state!==r.State.ACTIVE||v.ID!==t&&(f=!0)}),f},w.prototype._onCallListener=function(t,h,f){var r=f.userInfo||{};if(y.trace("onCall. UserID:"+t+". SessionID: "+h),this.isExistNewOrActiveSessionExceptSessionID(h))y.trace("User with id "+t+" is busy at the moment."),delete f.sdp,delete f.platform,f.sessionID=h,this.signalingProvider.sendMessage(t,f,_.SignalingType.REJECT),"function"==typeof this.onInvalidEventsListener&&C.safeCallbackCall(this.onInvalidEventsListener,"onCall",h,t,r);else{var c=this.sessions[h],m=+r.bandwidth||0;c||(c=this._createAndStoreSession(h,f.callerID,f.opponentsIDs,f.callType,m),"function"==typeof this.onCallListener&&C.safeCallbackCall(this.onCallListener,c,r)),c.processOnCall(t,f)}},w.prototype._onAcceptListener=function(t,h,f){var c=this.sessions[h],m=f.userInfo||{};y.trace("onAccept. UserID:"+t+". SessionID: "+h),c?c.state===r.State.ACTIVE?("function"==typeof this.onAcceptCallListener&&C.safeCallbackCall(this.onAcceptCallListener,c,t,m),c.processOnAccept(t,f)):("function"==typeof this.onInvalidEventsListener&&C.safeCallbackCall(this.onInvalidEventsListener,"onAccept",c,t,m),y.traceWarning("Ignore 'onAccept', the session( "+h+" ) has invalid state.")):y.traceError("Ignore 'onAccept', there is no information about session "+h+" by some reason.")},w.prototype._onRejectListener=function(t,h,f){var r=this.sessions[h];if(y.trace("onReject. UserID:"+t+". SessionID: "+h),r){var c=f.userInfo||{};"function"==typeof this.onRejectCallListener&&C.safeCallbackCall(this.onRejectCallListener,r,t,c),r.processOnReject(t,f)}else y.traceError("Ignore 'onReject', there is no information about session "+h+" by some reason.")},w.prototype._onStopListener=function(t,h,f){y.trace("onStop. UserID:"+t+". SessionID: "+h);var c=this.sessions[h],m=f.userInfo||{};!c||c.state!==r.State.ACTIVE&&c.state!==r.State.NEW?("function"==typeof this.onInvalidEventsListener&&C.safeCallbackCall(this.onInvalidEventsListener,"onStop",c,t,m),y.traceError("Ignore 'onStop', there is no information about session "+h+" by some reason.")):("function"==typeof this.onStopCallListener&&C.safeCallbackCall(this.onStopCallListener,c,t,m),setTimeout(c.processOnStop.bind(c),10,t,f))},w.prototype._onIceCandidatesListener=function(t,h,f){var c=this.sessions[h];y.trace("onIceCandidates. UserID:"+t+". SessionID: "+h+". ICE candidates count: "+f.iceCandidates.length),c?c.state===r.State.ACTIVE?c.processOnIceCandidates(t,f):y.traceWarning("Ignore 'OnIceCandidates', the session ( "+h+" ) has invalid state."):y.traceError("Ignore 'OnIceCandidates', there is no information about session "+h+" by some reason.")},w.prototype._onUpdateListener=function(t,h,f){var r=this.sessions[h],c=f.userInfo||{};y.trace("onUpdate. UserID:"+t+". SessionID: "+h+". Extension: "+JSON.stringify(c)),"function"==typeof this.onUpdateCallListener&&C.safeCallbackCall(this.onUpdateCallListener,r,t,c)},w.prototype._onDevicesChangeListener=function(){"function"==typeof this.onDevicesChangeListener&&C.safeCallbackCall(this.onDevicesChangeListener)},t.exports=w},function(t,h,f){"use strict";var r=f(1),c=f(12),m=f(0),y=f(5),v=f(6);function _(t){var h;this.ID=t.sessionID?t.sessionID:(h=(new Date).getTime(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var f=(h+16*Math.random())%16|0;return h=Math.floor(h/16),("x"==t?f:3&f|8).toString(16)})),this.state=_.State.NEW,this.initiatorID=parseInt(t.initiatorID),this.opponentsIDs=t.opIDs,this.callType=parseInt(t.callType),this.peerConnections={},this.localStream=null,this.mediaParams=null,this.signalingProvider=t.signalingProvider,this.currentUserID=t.currentUserID,this.bandwidth=t.bandwidth,this.answerTimer=null,this.startCallTime=0,this.acceptCallTime=0}function C(t){var h={};try{if("[object Object]"!=={}.toString.call(t))throw new Error('Invalid type of "extension" object.');h.userInfo=t,h=JSON.parse(JSON.stringify(h).replace(/null/g,'""'))}catch(t){y.traceWarning(t.message)}return h}function w(t){var h=JSON.parse(JSON.stringify(t));return Object.keys(h).forEach(function(t,f,r){h[f].hasOwnProperty("url")?h[f].urls=h[f].url:h[f].url=h[f].urls}),h}_.State={NEW:1,ACTIVE:2,HUNGUP:3,REJECTED:4,CLOSED:5},_.prototype.getUserMedia=function(t,h){if(!navigator.mediaDevices.getUserMedia)throw new Error("getUserMedia() is not supported in your browser");var f=this;navigator.mediaDevices.getUserMedia({audio:t.audio||!1,video:t.video||!1}).then(function(r){f.localStream=r,f.mediaParams=t,t.elementId&&f.attachMediaStream(t.elementId,r,t.options),h(null,r)}).catch(function(t){h(t,null)})},_.prototype.connectionStateForUser=function(t){var h=this.peerConnections[t];return h?h.state:null},_.prototype.attachMediaStream=function(t,h,f){var r=document.getElementById(t);if(!r)throw new Error("Unable to attach media stream, element "+t+" is undefined");"object"==typeof r.srcObject?r.srcObject=h:r.src=window.URL.createObjectURL(h),f&&f.muted&&(r.muted=!0),f&&f.mirror&&(r.style.webkitTransform="scaleX(-1)",r.style.transform="scaleX(-1)"),r.onloadedmetadata=function(t){r.play()}},_.prototype.detachMediaStream=function(t){var h=document.getElementById(t);h&&(h.pause(),"object"==typeof h.srcObject?h.srcObject=null:h.src="")},_.prototype.switchMediaTracks=function(t,h){if(!navigator.mediaDevices.getUserMedia)throw new Error("getUserMedia() is not supported in your browser");var f=this,r=this.localStream;t&&t.audio&&("boolean"==typeof f.mediaParams.audio&&(f.mediaParams.audio={}),f.mediaParams.audio.deviceId=t.audio),t&&t.video&&("boolean"==typeof f.mediaParams.video&&(f.mediaParams.video={}),f.mediaParams.video.deviceId=t.video),r.getTracks().forEach(function(t){t.stop()}),navigator.mediaDevices.getUserMedia({audio:f.mediaParams.audio||!1,video:f.mediaParams.video||!1}).then(function(t){f._replaceTracks(t),h(null,t)}).catch(function(t){h(t,null)})},_.prototype._replaceTracks=function(t){var h=this.peerConnections,f=this.localStream,r=this.mediaParams.elementId,c=this.mediaParams.options,m=t.getTracks();for(var y in this.detachMediaStream(r),m.forEach(function(t){f.addTrack(t)}),this.attachMediaStream(r,t,c),h)h[y].getSenders().map(function(t){t.replaceTrack(m.find(function(h){return h.kind===t.track.kind}))})},_.prototype.call=function(t,h){var f=this,r=C(t);y.trace("Call, extension: "+JSON.stringify(r.userInfo)),f.state=_.State.ACTIVE,f.opponentsIDs.forEach(function(t,h,c){f._callInternal(t,r,!0)}),"function"==typeof h&&h(null)},_.prototype._callInternal=function(t,h,f){var r=this,c=r._createPeer(t,"offer"),m=y.getVersionSafari();m&&m>=11?r.localStream.getTracks().forEach(function(t){c.addTrack(t,r.localStream)}):c.addLocalStream(r.localStream),this.peerConnections[t]=c,c.getAndSetLocalSessionDescription(this.callType,function(t){t?y.trace("getAndSessionDescription error: "+t):(y.trace("getAndSessionDescription success"),c._startDialingTimer(h,f))})},_.prototype.accept=function(t){var h=this,f=C(t);if(y.trace("Accept, extension: "+JSON.stringify(f.userInfo)),h.state!==_.State.ACTIVE){if(h.state===_.State.CLOSED)return y.traceError("Can't accept, the session is already closed, return."),void h.stop({});h.state=_.State.ACTIVE,h.acceptCallTime=new Date,h._clearAnswerTimer(),h._acceptInternal(h.initiatorID,f);var r=h._uniqueOpponentsIDsWithoutInitiator();if(r.length>0){var c=(h.acceptCallTime-h.startCallTime)/1e3;h._startWaitingOfferOrAnswerTimer(c),r.forEach(function(t,f,r){h.currentUserID>t&&h._callInternal(t,{},!0)})}}else y.traceError("Can't accept, the session is already active, return.")},_.prototype._acceptInternal=function(t,h){var f=this,r=this.peerConnections[t];if(r){var c=y.getVersionSafari();c&&c>=11?f.localStream.getTracks().forEach(function(t){r.addTrack(t,f.localStream)}):r.addLocalStream(f.localStream),r.setRemoteSessionDescription("offer",r.getRemoteSDP(),function(c){c?y.traceError("'setRemoteSessionDescription' error: "+c):(y.trace("'setRemoteSessionDescription' success"),r.getAndSetLocalSessionDescription(f.callType,function(c){c?y.trace("getAndSetLocalSessionDescription error: "+c):(h.sessionID=f.ID,h.callType=f.callType,h.callerID=f.initiatorID,h.opponentsIDs=f.opponentsIDs,h.sdp=r.localDescription.sdp,f.signalingProvider.sendMessage(t,h,v.SignalingType.ACCEPT))}))})}else y.traceError("Can't accept the call, there is no information about peer connection by some reason.")},_.prototype.reject=function(t){var h=C(t),f=Object.keys(this.peerConnections).length;if(y.trace("Reject, extension: "+JSON.stringify(h.userInfo)),this.state=_.State.REJECTED,this._clearAnswerTimer(),h.sessionID=this.ID,h.callType=this.callType,h.callerID=this.initiatorID,h.opponentsIDs=this.opponentsIDs,f>0)for(var r in this.peerConnections){var c=this.peerConnections[r];this.signalingProvider.sendMessage(c.userID,h,v.SignalingType.REJECT)}this._close()},_.prototype.stop=function(t){var h=C(t),f=Object.keys(this.peerConnections).length;if(y.trace("Stop, extension: "+JSON.stringify(h.userInfo)),this.state=_.State.HUNGUP,this.answerTimer&&this._clearAnswerTimer(),h.sessionID=this.ID,h.callType=this.callType,h.callerID=this.initiatorID,h.opponentsIDs=this.opponentsIDs,f>0)for(var r in this.peerConnections){var c=this.peerConnections[r];this.signalingProvider.sendMessage(c.userID,h,v.SignalingType.STOP)}this._close()},_.prototype.closeConnection=function(t){var h=this.peerConnections[t];if(!h)return y.traceWarn("Not found connection with user ("+t+")"),!1;try{h.release()}catch(t){y.traceError(t)}finally{this._closeSessionIfAllConnectionsClosed()}},_.prototype.update=function(t){var h={};if(y.trace("Update, extension: "+JSON.stringify(t)),null!==t)for(var f in(h=C(t)).sessionID=this.ID,this.peerConnections){var r=this.peerConnections[f];this.signalingProvider.sendMessage(r.userID,h,v.SignalingType.PARAMETERS_CHANGED)}else y.trace("extension is null, no parameters to update")},_.prototype.mute=function(t){this._muteStream(0,t)},_.prototype.unmute=function(t){this._muteStream(1,t)},_.prototype.processOnCall=function(t,h){var f=this;f._uniqueOpponentsIDs().forEach(function(r,c,m){var y,v=f.peerConnections[r];v?r==t&&(v.updateRemoteSDP(h.sdp),t!=f.initiatorID&&f.state===_.State.ACTIVE&&f._acceptInternal(t,{})):(y=r!=t&&f.currentUserID>r?f._createPeer(r,"offer"):f._createPeer(r,"answer"),f.peerConnections[r]=y,r==t&&(y.updateRemoteSDP(h.sdp),f._startAnswerTimer()))})},_.prototype.processOnAccept=function(t,h){var f=this.peerConnections[t];f?(f._clearDialingTimer(),f.setRemoteSessionDescription("answer",h.sdp,function(t){t?y.traceError("'setRemoteSessionDescription' error: "+t):y.trace("'setRemoteSessionDescription' success")})):y.traceError("Ignore 'OnAccept', there is no information about peer connection by some reason.")},_.prototype.processOnReject=function(t,h){var f=this.peerConnections[t];this._clearWaitingOfferOrAnswerTimer(),f?f.release():y.traceError("Ignore 'OnReject', there is no information about peer connection by some reason."),this._closeSessionIfAllConnectionsClosed()},_.prototype.processOnStop=function(t,h){var f=this;if(this._clearAnswerTimer(),t===f.initiatorID)Object.keys(f.peerConnections).length?Object.keys(f.peerConnections).forEach(function(t){f.peerConnections[t].release()}):y.traceError("Ignore 'OnStop', there is no information about peer connections by some reason.");else{var r=f.peerConnections[t];r?r.release():y.traceError("Ignore 'OnStop', there is no information about peer connection by some reason.")}this._closeSessionIfAllConnectionsClosed()},_.prototype.processOnIceCandidates=function(t,h){var f=this.peerConnections[t];f?f.addCandidates(h.iceCandidates):y.traceError("Ignore 'OnIceCandidates', there is no information about peer connection by some reason.")},_.prototype.processCall=function(t,h){var f=h||{};f.sessionID=this.ID,f.callType=this.callType,f.callerID=this.initiatorID,f.opponentsIDs=this.opponentsIDs,f.sdp=t.localDescription.sdp,f.userInfo=h.userInfo||{},f.userInfo.bandwidth=this.bandwidth,this.signalingProvider.sendMessage(t.userID,f,v.SignalingType.CALL)},_.prototype.processIceCandidates=function(t,h){var f={};f.sessionID=this.ID,f.callType=this.callType,f.callerID=this.initiatorID,f.opponentsIDs=this.opponentsIDs,this.signalingProvider.sendCandidate(t.userID,h,f)},_.prototype.processOnNotAnswer=function(t){y.trace("Answer timeout callback for session "+this.ID+" for user "+t.userID),this._clearWaitingOfferOrAnswerTimer(),t.release(),"function"==typeof this.onUserNotAnswerListener&&m.safeCallbackCall(this.onUserNotAnswerListener,this,t.userID),this._closeSessionIfAllConnectionsClosed()},_.prototype._onRemoteStreamListener=function(t,h){"function"==typeof this.onRemoteStreamListener&&m.safeCallbackCall(this.onRemoteStreamListener,this,t,h)},_.prototype._onCallStatsReport=function(t,h,f){"function"==typeof this.onCallStatsReport&&m.safeCallbackCall(this.onCallStatsReport,this,t,h,f)},_.prototype._onSessionConnectionStateChangedListener=function(t,h){"function"==typeof this.onSessionConnectionStateChangedListener&&m.safeCallbackCall(this.onSessionConnectionStateChangedListener,this,t,h)},_.prototype._createPeer=function(t,h){if(!c)throw new Error("_createPeer error: RTCPeerConnection() is not supported in your browser");this.startCallTime=new Date;var f={iceServers:w(r.videochat.iceServers)};y.trace("_createPeer, iceServers: "+JSON.stringify(f));var m=new c(f);return m._init(this,t,this.ID,h),m},_.prototype._close=function(){for(var t in y.trace("_close"),this.peerConnections){var h=this.peerConnections[t];try{h.release()}catch(t){console.warn("Peer close error:",t)}}this._closeLocalMediaStream(),this.state=_.State.CLOSED,"function"==typeof this.onSessionCloseListener&&m.safeCallbackCall(this.onSessionCloseListener,this)},_.prototype._closeSessionIfAllConnectionsClosed=function(){var t=!0;for(var h in this.peerConnections){var f,r=this.peerConnections[h];try{f="closed"===r.iceConnectionState?"closed":r.signalingState}catch(t){y.traceError(t),f="closed"}if("closed"!==f){t=!1;break}}y.trace("All peer connections closed: "+t),t&&(this._closeLocalMediaStream(),"function"==typeof this.onSessionCloseListener&&this.onSessionCloseListener(this),this.state=_.State.CLOSED)},_.prototype._closeLocalMediaStream=function(){this.localStream&&(this.localStream.getAudioTracks().forEach(function(t){t.stop()}),this.localStream.getVideoTracks().forEach(function(t){t.stop()}),this.localStream=null)},_.prototype._muteStream=function(t,h){"audio"===h&&this.localStream.getAudioTracks().length>0?this.localStream.getAudioTracks().forEach(function(h){h.enabled=!!t}):"video"===h&&this.localStream.getVideoTracks().length>0&&this.localStream.getVideoTracks().forEach(function(h){h.enabled=!!t})},_.prototype._clearAnswerTimer=function(){this.answerTimer&&(y.trace("_clearAnswerTimer"),clearTimeout(this.answerTimer),this.answerTimer=null)},_.prototype._startAnswerTimer=function(){y.trace("_startAnswerTimer");var t=this,h=1e3*r.videochat.answerTimeInterval;this.answerTimer=setTimeout(function(){y.trace("_answerTimeoutCallback"),"function"==typeof t.onSessionCloseListener&&t._close(),t.answerTimer=null},h)},_.prototype._clearWaitingOfferOrAnswerTimer=function(){this.waitingOfferOrAnswerTimer&&(y.trace("_clearWaitingOfferOrAnswerTimer"),clearTimeout(this.waitingOfferOrAnswerTimer),this.waitingOfferOrAnswerTimer=null)},_.prototype._startWaitingOfferOrAnswerTimer=function(t){var h=this,f=r.videochat.answerTimeInterval-t<0?1:r.videochat.answerTimeInterval-t;y.trace("_startWaitingOfferOrAnswerTimer, timeout: "+f),this.waitingOfferOrAnswerTimer=setTimeout(function(){y.trace("waitingOfferOrAnswerTimeoutCallback"),Object.keys(h.peerConnections).length>0&&Object.keys(h.peerConnections).forEach(function(t){var f=h.peerConnections[t];f.state!==c.State.CONNECTING&&f.state!==c.State.NEW||h.processOnNotAnswer(f)}),h.waitingOfferOrAnswerTimer=null},1e3*f)},_.prototype._uniqueOpponentsIDs=function(){var t=this,h=[];return this.initiatorID!==this.currentUserID&&h.push(this.initiatorID),this.opponentsIDs.forEach(function(f,r,c){f!=t.currentUserID&&h.push(parseInt(f))}),h},_.prototype._uniqueOpponentsIDsWithoutInitiator=function(){var t=this,h=[];return this.opponentsIDs.forEach(function(f,r,c){f!=t.currentUserID&&h.push(parseInt(f))}),h},_.prototype.toString=function(){return"ID: "+this.ID+", initiatorID:  "+this.initiatorID+", opponentsIDs: "+this.opponentsIDs+", state: "+this.state+", callType: "+this.callType},t.exports=_},function(t,h,f){"use strict";var r=f(6),c=f(2);t.exports=function(t,h,f){var m=this;m.service=t,m.delegate=h,m.connection=f,this._onMessage=function(t,h,f,c){var y=m._getExtension(h),v=y.sessionID,_=y.signalType;switch(delete y.moduleIdentifier,delete y.sessionID,delete y.signalType,_){case r.SignalingType.CALL:"function"==typeof m.delegate._onCallListener&&m.delegate._onCallListener(c,v,y);break;case r.SignalingType.ACCEPT:"function"==typeof m.delegate._onAcceptListener&&m.delegate._onAcceptListener(c,v,y);break;case r.SignalingType.REJECT:"function"==typeof m.delegate._onRejectListener&&m.delegate._onRejectListener(c,v,y);break;case r.SignalingType.STOP:"function"==typeof m.delegate._onStopListener&&m.delegate._onStopListener(c,v,y);break;case r.SignalingType.CANDIDATE:"function"==typeof m.delegate._onIceCandidatesListener&&m.delegate._onIceCandidatesListener(c,v,y);break;case r.SignalingType.PARAMETERS_CHANGED:"function"==typeof m.delegate._onUpdateListener&&m.delegate._onUpdateListener(c,v,y)}},this._getExtension=function(t){if(!t)return null;for(var h,f,r,m,y={},v=[],_=[],C=0,w=t.childNodes.length;C<w;C++)if("iceCandidates"===t.childNodes[C].tagName)for(var T=0,S=(r=t.childNodes[C].childNodes).length;T<S;T++){h={};for(var E=0,A=(m=r[T].childNodes).length;E<A;E++)h[m[E].tagName]=m[E].textContent;v.push(h)}else if("opponentsIDs"===t.childNodes[C].tagName)for(var R=0,O=(r=t.childNodes[C].childNodes).length;R<O;R++)f=r[R].textContent,_.push(parseInt(f));else if(t.childNodes[C].childNodes.length>1)if(t.childNodes[C].textContent.length>4096){for(var D="",x=0;x<t.childNodes[C].childNodes.length;++x)D+=t.childNodes[C].childNodes[x].textContent;y[t.childNodes[C].tagName]=D}else y=c._XMLtoJS(y,t.childNodes[C].tagName,t.childNodes[C]);else"userInfo"===t.childNodes[C].tagName?y=c._XMLtoJS(y,t.childNodes[C].tagName,t.childNodes[C]):y[t.childNodes[C].tagName]=t.childNodes[C].textContent;return v.length>0&&(y.iceCandidates=v),_.length>0&&(y.opponentsIDs=_),y}}},function(t,h,f){"use strict";var r=f(5),c=f(6),m=f(0),y=f(1),v=f(2);function _(t,h){this.service=t,this.connection=h}_.prototype.sendCandidate=function(t,h,f){var r=f||{};r.iceCandidates=h,this.sendMessage(t,r,c.SignalingType.CANDIDATE)},_.prototype.sendMessage=function(t,h,f){var _,C,w=h||{};w.moduleIdentifier=c.MODULE_ID,w.signalType=f,w.platform="web",w.userInfo&&!Object.keys(w.userInfo).length&&delete w.userInfo,C={to:r.getUserJid(t,y.creds.appId),type:"headline",id:m.getBsonObjectId()},_=$msg(C).c("extraParams",{xmlns:Strophe.NS.CLIENT}),Object.keys(w).forEach(function(t){"iceCandidates"===t?(_=_.c("iceCandidates"),w[t].forEach(function(t){_=_.c("iceCandidate"),Object.keys(t).forEach(function(h){_.c(h).t(t[h]).up()}),_.up()}),_.up()):"opponentsIDs"===t?(_=_.c("opponentsIDs"),w[t].forEach(function(t){_=_.c("opponentID").t(t).up()}),_.up()):"object"==typeof w[t]?v._JStoXML(t,w[t],_):_.c(t).t(w[t]).up()}),this.connection.send(_)},t.exports=_},function(t,h,f){"use strict";var r=f(53),c=f(0),m=f(1),y=f(54).EventEmitter;function v(t){if(!adapter)throw"Error: in order to use this library please connect adapter.js. More info https://github.com/webrtc/adapter";if(this.configs=t,!this.configs.server)throw"'server' parameter is mandatory.";this.configs.server.includes("http")&&(this.configs.server=this.configs.server+"/janus"),this.configs.debug||(this.configs.debug="all"),this.engine=null,this.videoRoomPlugin=null,this.isOnlyAudio=!1,this.currentDialogId=null,this.remoteFeeds=[],this.remoteJseps=[],this.remoteFeedsAttachingInProgress=[],this.currentMidiaDeviceId=null,this.bitrateTimers=[],this.emitter=new y}v.attachMediaStream=function(t,h){r.attachMediaStream(t,h)},v.listDevices=function(t){navigator.mediaDevices.enumerateDevices().then(function(h){console.debug(h),t(h)}).catch(function(h){console.error(h),t([])})},v.listVideoinputDevices=function(t){v.listDevices(function(h){for(var f=[],r=0;r!==h.length;++r){var c=h[r];if("videoinput"===c.kind){var m=c.label||"camera "+(f.length+1),y=c.deviceId;f.push({label:m,deviceId:y})}}t(f)})},v.prototype={createSession:function(t){var h=this;r.init({debug:this.configs.debug,callback:function(){r.isWebrtcSupported()?h.engine=new r({server:h.configs.server,iceServers:m.videochat.iceServers,success:function(){"function"==typeof t.success&&c.safeCallbackCall(t.success)},error:function(h){"function"==typeof t.error&&c.safeCallbackCall(t.error,h)},destroyed:function(){"function"==typeof t.destroyed&&c.safeCallbackCall(t.destroyed)},timeoutSessionCallback:function(){"function"==typeof t.timeoutSessionCallback&&c.safeCallbackCall(t.timeoutSessionCallback)}}):"function"==typeof t.error&&t.error("Your browser does not support WebRTC, so you can't use this functionality.")}})},getSessionId:function(){return this.engine?this.engine.getSessionId():null},destroySession:function(t){this.engine.destroy({}),"function"==typeof t.success&&c.safeCallbackCall(t.success)},attachVideoConferencingPlugin:function(t,h,f){var r=this,m=null;this.engine.attach({plugin:"janus.plugin.videoroom",success:function(y){if(t){(m=y).userId=h,r.remoteFeedsAttachingInProgress[h]=m;var v={request:"join",room:r.currentDialogId,ptype:"listener",feed:h};"safari"===adapter.browserDetails.browser&&(v.offer_video=!1),m.send({message:v})}else r.videoRoomPlugin=y;"function"==typeof f.success&&c.safeCallbackCall(f.success)},error:function(t){"function"==typeof f.error&&c.safeCallbackCall(f.error,c.wrapError(t))},consentDialog:function(t){"function"==typeof f.consentDialog&&c.safeCallbackCall(f.consentDialog,t)},mediaState:function(t,h){"function"==typeof f.mediaState&&c.safeCallbackCall(f.mediaState,t,h)},webrtcState:function(t){"function"==typeof f.webrtcState&&c.safeCallbackCall(f.webrtcState,t)},slowLink:function(t,h){"function"==typeof f.slowLink&&c.safeCallbackCall(f.slowLink,t,h)},iceState:function(t){"function"==typeof f.iceState&&c.safeCallbackCall(f.iceState,t)},onmessage:function(h,m){var y=h.videoroom;if(t){if(y)if("attached"===y){var v=h.id;r.remoteFeeds[v]=r.remoteFeedsAttachingInProgress[v],r.remoteFeedsAttachingInProgress[v]=null}else h.error&&"function"==typeof f.error&&c.safeCallbackCall(f.error,c.wrapError(h.error));if(m){v=h.id;r.remoteJseps[v]=m,r.createAnswer(r.remoteFeeds[v],m,{success:function(){},error:function(t){"function"==typeof f.error&&c.safeCallbackCall(f.error,c.wrapError(t))}})}}else{if(y)if("joined"===y)r.createOffer({useAudio:!0,useVideo:!r.isOnlyAudio},{success:function(){if(h.publishers){var t=h.publishers;for(var f in t){var c=t[f].id,m=t[f].display;r.emitter.emit("participantjoined",c,m)}}},error:function(t){"function"==typeof f.error&&c.safeCallbackCall(f.error,c.wrapError(t))}});else if("event"===y)if(h.publishers){var _=h.publishers;for(var C in _){var w=_[C].id,T=_[C].display;r.emitter.emit("participantjoined",w,T)}}else if(h.leaving){v=h.leaving;r.detachRemoteFeed(v)&&r.emitter.emit("participantleft",v,null)}else if(h.unpublished){if("ok"!=(v=h.unpublished))r.detachRemoteFeed(v)&&r.emitter.emit("participantleft",v,null)}else h.error&&"function"==typeof f.error&&c.safeCallbackCall(f.error,c.wrapError(h.error));m&&r.videoRoomPlugin.handleRemoteJsep({jsep:m})}},onlocalstream:function(t){r.emitter.emit("localstream",t)},onremotestream:function(t){m.stream=t,r.emitter.emit("remotestream",t,m.userId)},oncleanup:function(){console.info("ON CLEANUP"),"function"==typeof f.oncleanup&&c.safeCallbackCall(f.oncleanup)},detached:function(){}})},getPluginId:function(){return this.videoRoomPlugin?this.videoRoomPlugin.getId():null},detachVideoConferencingPlugin:function(t){var h=this,f=function(){h.videoRoomPlugin=null,Object.keys(h.remoteFeeds).forEach(function(t){h.detachRemoteFeed(t)}),h.remoteFeeds=[],h.remoteJseps=[],h.currentMidiaDeviceId=null};this.videoRoomPlugin.detach({success:function(){f(),"function"==typeof t.success&&c.safeCallbackCall(t.success)},error:function(h){f(),"function"==typeof t.error&&c.safeCallbackCall(t.error,h)}})},join:function(t,h,f,r){var m=this;if("boolean"!=typeof f)throw"'isOnlyAudio' parameter can be of type 'boolean' only.";m.isOnlyAudio=f,"safari"===adapter.browserDetails.browser&&(m.isOnlyAudio=!0),console.info("isOnlyAudio: "+m.isOnlyAudio);var y={request:"join",room:t,ptype:"publisher",id:h};this.videoRoomPlugin.send({message:y,success:function(f){m.currentDialogId=t,m.currentUserId=h,"function"==typeof r.success&&c.safeCallbackCall(r.success)},error:function(t){"function"==typeof r.error&&c.safeCallbackCall(r.error,t)}})},leave:function(t){if(console.warn("leave"),this.engine.isConnected()){var h={request:"leave",room:this.currentDialogId,id:this.currentUserId};this.videoRoomPlugin&&this.videoRoomPlugin.send({message:h}),this.currentDialogId=null,this.currentUserId=null,console.warn("resp"),"function"==typeof t.success&&c.safeCallbackCall(t.success)}else"function"==typeof t.success&&c.safeCallbackCall(t.success)},listOnlineParticipants:function(t,h){var f={request:"listparticipants",room:t};this.videoRoomPlugin.send({message:f,success:function(t){var f=[];t&&(f=t.participants),"function"==typeof h.success&&c.safeCallbackCall(h.success,f)},error:function(t){"function"==typeof h.error&&c.safeCallbackCall(h.error,t)}})},toggleAudioMute:function(){return this.videoRoomPlugin.isAudioMuted()?this.videoRoomPlugin.unmuteAudio():this.videoRoomPlugin.muteAudio(),this.videoRoomPlugin.isAudioMuted()},isAudioMuted:function(){return this.videoRoomPlugin.isAudioMuted()},toggleRemoteAudioMute:function(t){var h=this.remoteFeeds[t];if(!h)return!1;var f=h.stream.getAudioTracks();if(f&&f.length>0){for(var r=0;r<f.length;++r)f[r].enabled=!f[r].enabled;return!f[0].enabled}return!1},isRemoteAudioMuted:function(t){var h=this.remoteFeeds[t];if(!h)return!1;var f=h.stream.getAudioTracks();return!!(f&&f.length>0)&&!f[0].enabled},toggleVideoMute:function(){return this.videoRoomPlugin.isVideoMuted()?this.videoRoomPlugin.unmuteVideo():this.videoRoomPlugin.muteVideo(),this.videoRoomPlugin.isVideoMuted()},isVideoMuted:function(){return this.videoRoomPlugin.isVideoMuted()},toggleRemoteVideoMute:function(t){var h=this.remoteFeeds[t];if(!h)return!1;var f=h.stream.getVideoTracks();if(f&&f.length>0){for(var r=0;r<f.length;++r)f[r].enabled=!f[r].enabled;return!f[0].enabled}return!1},isRemoteVideoMuted:function(t){var h=this.remoteFeeds[t];if(!h)return!1;var f=h.stream.getVideoTracks();return!!(f&&f.length>0)&&!f[0].enabled},switchVideoinput:function(t,h){if(this.videoRoomPlugin){if(this.isOnlyAudio)throw"Can't switch video input in audio only call.";this.currentMidiaDeviceId=null;var f=this;this.createOffer({video:{deviceId:t},replaceVideo:!0},{success:function(){console.info("switchVideoinput: success"),f.currentMidiaDeviceId=t,"function"==typeof h.success&&c.safeCallbackCall(h.success)},error:function(t){console.info("switchVideoinput: error",t),"function"==typeof h.error&&c.safeCallbackCall(h.error,t)}})}else"function"==typeof h.error&&c.safeCallbackCall(h.error,"No active stream")},iceRestart:function(t,h){if(h){console.info("Performing remote ICE restart for user: ",t);var f=this.remoteFeeds[t];if(!f)return void("function"==typeof h.error&&c.safeCallbackCall(h.error,"No such user feed"));f.send({message:{request:"configure",restart:!0}}),"function"==typeof h.success&&c.safeCallbackCall(h.success)}else console.info("Performing local ICE restart"),this.createOffer({iceRestart:!0},{success:function(){"function"==typeof t.success&&c.safeCallbackCall(t.success)},error:function(h){"function"==typeof t.error&&c.safeCallbackCall(t.error,h)}})},createOffer:function(t,h){console.log("createOffer, inputParams: ",t);var f,r=this,c=t.useAudio,m=t.useVideo,y=t.stream,v=t.replaceVideo,_=t.iceRestart,C=r.configs.video?r.configs.video.quality:null,w=r.configs.video?r.configs.video.frameRate:null;y?f={stream:y}:v?(f={media:t},C&&(f.media.video=C),w&&(f.media.videoFrameRate={min:w,max:w})):_?f=t:(f={media:{audioRecv:!1,videoRecv:!1,audioSend:c,videoSend:m}},C&&(f.media.video=C),w&&(f.media.videoFrameRate={min:w,ideal:w})),console.info("createOffer params: ",f),f.success=function(t){var f={request:"configure"};v||_||(f.audio=c,f.video=m),console.info("createOffer publish: ",f),r.videoRoomPlugin.send({message:f,jsep:t}),"function"==typeof h.success&&h.success()},f.error=function(t){console.error("Error in createOffer: ",t),c?r.createOffer({useAudio:!1,useVideo:!1},h):"function"==typeof h.error&&h.error(t)},this.videoRoomPlugin.createOffer(f)},createAnswer:function(t,h,f){var r=this;t.createAnswer({jsep:h,media:{audioSend:!1,videoSend:!1},success:function(h){var m={request:"start",room:r.currentDialogId};t.send({message:m,jsep:h}),"function"==typeof f.success&&c.safeCallbackCall(f.success)},error:function(t){console.error("createAnswer error: ",t),"function"==typeof f.error&&c.safeCallbackCall(f.error,t)}})},detachRemoteFeed:function(t){var h=this.remoteFeeds[t];return!!h&&(h.detach(),this.remoteFeeds[t]=null,this.remoteJseps[t]=null,!0)},showBitrate:function(t,h){var f=this.remoteFeeds[t];"chrome"!==adapter.browserDetails.browser&&"firefox"!==adapter.browserDetails.browser||(this.bitrateTimers[t]=setInterval(function(){var t=f.getBitrate();h.text(t)},1e3))},hideBitrate:function(t,h){this.bitrateTimers[t]&&clearInterval(this.bitrateTimers[t]),this.bitrateTimers[t]=null,h.text=null},on:function(t,h){this.emitter.addListener(t,h)},removeAllListeners:function(t){t?this.emitter.removeAllListeners(t):this.emitter.removeAllListeners()}},t.exports={Client:v}},function(t,h,f){t.exports=function(){function t(h){if(void 0===t.initDone)return h.error("Library not initialized"),{};if(!t.isWebrtcSupported())return h.error("WebRTC not supported by this browser"),{};if(t.log("Library initialized: "+t.initDone),(h=h||{}).success="function"==typeof h.success?h.success:t.noop,h.error="function"==typeof h.error?h.error:t.noop,h.destroyed="function"==typeof h.destroyed?h.destroyed:t.noop,null===h.server||void 0===h.server)return h.error("Invalid gateway url"),{};var f=!1,r=null,c={},m=null,y=null,v=0,_=h.server;t.isArray(_)?(t.log("Multiple servers provided ("+_.length+"), will use the first that works"),_=null,y=h.server,t.debug(y)):0===_.indexOf("ws")?(f=!0,t.log("Using WebSockets to contact Janus: "+_)):(f=!1,t.log("Using REST API to contact Janus: "+_));var C=h.iceServers;null==C&&(C=[{urls:"stun:stun.l.google.com:19302"}]);var w=h.iceTransportPolicy,T=h.bundlePolicy,S=h.ipv6;null==S&&(S=!1);var E=!1;void 0!==h.withCredentials&&null!==h.withCredentials&&(E=!0===h.withCredentials);var A=null;void 0!==h.max_poll_events&&null!==h.max_poll_events&&(A=h.max_poll_events),A<1&&(A=1);var R=null;void 0!==h.token&&null!==h.token&&(R=h.token);var O=null;void 0!==h.apisecret&&null!==h.apisecret&&(O=h.apisecret),this.destroyOnUnload=!0,void 0!==h.destroyOnUnload&&null!==h.destroyOnUnload&&(this.destroyOnUnload=!0===h.destroyOnUnload);var D=!1,x=null,L={},b=this,N=0,M={};function F(){if(null!=x)if(t.debug("Long poll..."),D){var f=_+"/"+x+"?rid="+(new Date).getTime();null!=A&&(f=f+"&maxev="+A),null!=R&&(f=f+"&token="+R),null!=O&&(f=f+"&apisecret="+O),t.httpAPICall(f,{verb:"GET",withCredentials:E,success:U,timeout:6e4,error:function(f,r){if(t.error(f+": "+r),++N>3)return D=!1,void h.error("Lost connection to the gateway (is it down?)");F()}})}else t.warn("Is the gateway down? (connected=false)")}function U(h,r){if(N=0,f||null==S||!0===r||setTimeout(F,200),f||!t.isArray(h))if("keepalive"!==h.janus)if("ack"!==h.janus)if("success"!==h.janus){if("webrtcup"===h.janus){t.debug("Got a webrtcup event on session "+S),t.debug(h);var c=h.sender;if(null==c)return void t.warn("Missing sender...");var m=L[c];return null==m?void t.debug("This handle is not attached to this session"):void m.webrtcState(!0)}if("hangup"===h.janus){t.debug("Got a hangup event on session "+S),t.debug(h);var c=h.sender;if(null==c)return void t.warn("Missing sender...");var m=L[c];if(null==m)return void t.debug("This handle is not attached to this session");m.webrtcState(!1,h.reason),m.hangup()}else if("detached"===h.janus){t.debug("Got a detached event on session "+S),t.debug(h);var c=h.sender;if(null==c)return void t.warn("Missing sender...");var m=L[c];if(null==m)return;m.detached=!0,m.ondetached(),m.detach()}else if("media"===h.janus){t.debug("Got a media event on session "+S),t.debug(h);var c=h.sender;if(null==c)return void t.warn("Missing sender...");var m=L[c];if(null==m)return void t.debug("This handle is not attached to this session");m.mediaState(h.type,h.receiving)}else if("slowlink"===h.janus){t.debug("Got a slowlink event on session "+S),t.debug(h);var c=h.sender;if(null==c)return void t.warn("Missing sender...");var m=L[c];if(null==m)return void t.debug("This handle is not attached to this session");m.slowLink(h.uplink,h.nacks)}else{if("error"===h.janus){t.error("Ooops: "+h.error.code+" "+h.error.reason),t.debug(h);var y=h.transaction;if(null!=y){var v=M[y];null!=v&&v(h),delete M[y]}return}if("event"===h.janus){t.debug("Got a plugin event on session "+S),t.debug(h);var c=h.sender;if(null==c)return void t.warn("Missing sender...");var _=h.plugindata;if(null==_)return void t.warn("Missing plugindata...");t.debug("  -- Event is coming from "+c+" ("+_.plugin+")");var C=_.data;t.debug(C);var m=L[c];if(null==m)return void t.warn("This handle is not attached to this session");var w=h.jsep;null!=w&&(t.debug("Handling SDP as well..."),t.debug(w));var T=m.onmessage;null!=T?(t.debug("Notifying application..."),T(C,w)):t.debug("No provided notification callback")}else if("timeout"===h.janus){var S=h.session_id,E=t.sessions[S];E&&E.timeoutSessionCallback()}else t.warn("Unkown message/event  '"+h.janus+"' on session "+S),t.debug(h)}}else{t.debug("Got a success on session "+S),t.debug(h);var y=h.transaction;if(null!=y){var v=M[y];null!=v&&v(h),delete M[y]}}else{t.debug("Got an ack on session "+S),t.debug(h);var y=h.transaction;if(null!=y){var v=M[y];null!=v&&v(h),delete M[y]}}else t.vdebug("Got a keepalive on session "+S);else for(var A=0;A<h.length;A++)U(h[A],!0)}function P(){if(null!==_&&f&&D){m=setTimeout(P,3e4);var h={janus:"keepalive",session_id:x,transaction:t.randomString(12)};null!=R&&(h.token=R),null!=O&&(h.apisecret=O),r.send(JSON.stringify(h))}}function B(h,c){if((c=c||{}).success="function"==typeof c.success?c.success:t.noop,c.error="function"==typeof c.error?c.error:t.noop,!D)return t.warn("Is the gateway down? (connected=false)"),void c.error("Is the gateway down? (connected=false)");var m=c.message,y=c.jsep,v=t.randomString(12),C={janus:"message",body:m,transaction:v};if(null!=R&&(C.token=R),null!=O&&(C.apisecret=O),null!=y&&(C.jsep=y),t.debug("Sending message to plugin (handle="+h+"):"),t.debug(C),f)return C.session_id=x,C.handle_id=h,M[v]=function(h){if(t.debug("Message sent!"),t.debug(h),"success"===h.janus){var f=h.plugindata;if(null==f)return t.warn("Request succeeded, but missing plugindata..."),void c.success();t.log("Synchronous transaction successful ("+f.plugin+")");var r=f.data;return t.debug(r),void c.success(r)}"ack"===h.janus?c.success():void 0!==h.error&&null!==h.error?(t.error("Ooops: "+h.error.code+" "+h.error.reason),c.error(h.error.code+" "+h.error.reason)):(t.error("Unknown error"),c.error("Unknown error"))},void r.send(JSON.stringify(C));t.httpAPICall(_+"/"+x+"/"+h,{verb:"POST",withCredentials:E,body:C,success:function(h){if(t.debug("Message sent!"),t.debug(h),"success"===h.janus){var f=h.plugindata;if(null==f)return t.warn("Request succeeded, but missing plugindata..."),void c.success();t.log("Synchronous transaction successful ("+f.plugin+")");var r=f.data;return t.debug(r),void c.success(r)}"ack"===h.janus?c.success():void 0!==h.error&&null!==h.error?(t.error("Ooops: "+h.error.code+" "+h.error.reason),c.error(h.error.code+" "+h.error.reason)):(t.error("Unknown error"),c.error("Unknown error"))},error:function(h,f){t.error(h+": "+f),c.error(h+": "+f)}})}function q(h,c){if(D){var m={janus:"trickle",candidate:c,transaction:t.randomString(12)};if(null!=R&&(m.token=R),null!=O&&(m.apisecret=O),t.vdebug("Sending trickle candidate (handle="+h+"):"),t.vdebug(m),f)return m.session_id=x,m.handle_id=h,void r.send(JSON.stringify(m));t.httpAPICall(_+"/"+x+"/"+h,{verb:"POST",withCredentials:E,body:m,success:function(h){t.vdebug("Candidate sent!"),t.vdebug(h),"ack"===h.janus||t.error("Ooops: "+h.error.code+" "+h.error.reason)},error:function(h,f){t.error(h+": "+f)}})}else t.warn("Is the gateway down? (connected=false)")}function z(h,f){(f=f||{}).success="function"==typeof f.success?f.success:t.noop,f.error="function"==typeof f.error?f.error:t.noop;var r=L[h];if(null==r||null===r.webrtcStuff||void 0===r.webrtcStuff)return t.warn("Invalid handle"),void f.error("Invalid handle");var c=r.webrtcStuff,m=f.text;if(null==m)return t.warn("Invalid text"),void f.error("Invalid text");t.log("Sending string on data channel: "+m),c.dataChannel.send(m),f.success()}function X(h,f){(f=f||{}).success="function"==typeof f.success?f.success:t.noop,f.error="function"==typeof f.error?f.error:t.noop;var r=L[h];if(null==r||null===r.webrtcStuff||void 0===r.webrtcStuff)return t.warn("Invalid handle"),void f.error("Invalid handle");var c=r.webrtcStuff;if(null===c.dtmfSender||void 0===c.dtmfSender){if(void 0!==c.myStream&&null!==c.myStream){var m=c.myStream.getAudioTracks();if(null!=m&&m.length>0){var y=m[0];c.dtmfSender=c.pc.createDTMFSender(y),t.log("Created DTMF Sender"),c.dtmfSender.ontonechange=function(h){t.debug("Sent DTMF tone: "+h.tone)}}}if(null===c.dtmfSender||void 0===c.dtmfSender)return t.warn("Invalid DTMF configuration"),void f.error("Invalid DTMF configuration")}var v=f.dtmf;if(null==v)return t.warn("Invalid DTMF parameters"),void f.error("Invalid DTMF parameters");var _=v.tones;if(null==_)return t.warn("Invalid DTMF string"),void f.error("Invalid DTMF string");var C=v.duration;null==C&&(C=500);var w=v.gap;null==w&&(w=50),t.debug("Sending DTMF string "+_+" (duration "+C+"ms, gap "+w+"ms)"),c.dtmfSender.insertDTMF(_,C,w)}function W(h,c){(c=c||{}).success="function"==typeof c.success?c.success:t.noop,c.error="function"==typeof c.error?c.error:t.noop;var m=!0;if(void 0!==c.asyncRequest&&null!==c.asyncRequest&&(m=!0===c.asyncRequest),t.log("Destroying handle "+h+" (async="+m+")"),I(h),L[h].detached)return delete L[h],void c.success();if(!D)return t.warn("Is the gateway down? (connected=false)"),void c.error("Is the gateway down? (connected=false)");var y={janus:"detach",transaction:t.randomString(12)};if(null!=R&&(y.token=R),null!=O&&(y.apisecret=O),f)return y.session_id=x,y.handle_id=h,r.send(JSON.stringify(y)),delete L[h],void c.success();t.httpAPICall(_+"/"+x+"/"+h,{verb:"POST",async:m,withCredentials:E,body:y,success:function(f){t.log("Destroyed handle:"),t.debug(f),"success"!==f.janus&&t.error("Ooops: "+f.error.code+" "+f.error.reason),delete L[h],c.success()},error:function(f,r){t.error(f+": "+r),delete L[h],c.success()}})}function G(h,f,r,c,m){console.warn("streamsDone",r);var y=L[h];if(null==y||null===y.webrtcStuff||void 0===y.webrtcStuff)return t.warn("Invalid handle"),void c.error("Invalid handle");var v=y.webrtcStuff;if(t.debug("streamsDone:",m),m&&(t.debug("  -- Audio tracks:",m.getAudioTracks()),t.debug("  -- Video tracks:",m.getVideoTracks())),r.update&&!v.streamExternal){if((r.removeAudio||r.replaceAudio)&&(v.myStream&&v.myStream.getAudioTracks()&&v.myStream.getAudioTracks().length&&(t.log("Removing audio track:",v.myStream.getAudioTracks()[0]),v.myStream.removeTrack(v.myStream.getAudioTracks()[0])),v.pc.getSenders()&&v.pc.getSenders().length))for(var _ in v.pc.getSenders()){var E=v.pc.getSenders()[_];E&&E.track&&"audio"===E.track.kind&&(t.log("Removing audio sender:",E),v.pc.removeTrack(E))}if((r.removeVideo||r.replaceVideo)&&(v.myStream&&v.myStream.getVideoTracks()&&v.myStream.getVideoTracks().length&&(t.log("Removing video track:",v.myStream.getVideoTracks()[0]),v.myStream.removeTrack(v.myStream.getVideoTracks()[0])),v.pc.getSenders()&&v.pc.getSenders().length))for(var _ in v.pc.getSenders()){var E=v.pc.getSenders()[_];E&&E.track&&"video"===E.track.kind&&(t.log("Removing video sender:",E),v.pc.removeTrack(E))}}var A=!1;if(v.myStream&&r.update&&!v.streamExternal?((!r.update&&o(r)||r.update&&(r.addAudio||r.replaceAudio))&&m.getAudioTracks()&&m.getAudioTracks().length&&(t.log("Adding audio track:",m.getAudioTracks()[0]),v.myStream.addTrack(m.getAudioTracks()[0]),v.pc.addTrack(m.getAudioTracks()[0],m)),(!r.update&&g(r)||r.update&&(r.addVideo||r.replaceVideo))&&m.getVideoTracks()&&m.getVideoTracks().length&&(t.log("Adding video track:",m.getVideoTracks()[0]),v.myStream.addTrack(m.getVideoTracks()[0]),v.pc.addTrack(m.getVideoTracks()[0],m))):(v.myStream=m,A=!0),!v.pc){var R={iceServers:C,iceTransportPolicy:w,bundlePolicy:T},O={optional:[{DtlsSrtpKeyAgreement:!0}]};if(!0===S&&O.optional.push({googIPv6:!0}),c.rtcConstraints&&"object"==typeof c.rtcConstraints)for(var D in t.debug("Adding custom PeerConnection constraints:",c.rtcConstraints),c.rtcConstraints)O.optional.push(c.rtcConstraints[D]);"edge"===t.webRTCAdapter.browserDetails.browser&&(R.bundlePolicy="max-bundle"),t.log("Creating PeerConnection"),t.debug(O),v.pc=new RTCPeerConnection(R,O),t.debug(v.pc),v.pc.getStats&&(v.volume.value=0,v.bitrate.value="0 kbits/sec"),t.log("Preparing local SDP and gathering candidates (trickle="+v.trickle+")"),v.pc.oniceconnectionstatechange=function(t){v.pc&&y.iceState(v.pc.iceConnectionState)},v.pc.onicecandidate=function(f){if(null==f.candidate||"edge"===t.webRTCAdapter.browserDetails.browser&&f.candidate.candidate.indexOf("endOfCandidates")>0)t.log("End of candidates."),v.iceDone=!0,!0===v.trickle?q(h,{completed:!0}):function(h,f){(f=f||{}).success="function"==typeof f.success?f.success:t.noop,f.error="function"==typeof f.error?f.error:t.noop;var r=L[h];if(null!=r&&null!==r.webrtcStuff&&void 0!==r.webrtcStuff){var c=r.webrtcStuff;t.log("Sending offer/answer SDP..."),null!==c.mySdp&&void 0!==c.mySdp?(c.mySdp={type:c.pc.localDescription.type,sdp:c.pc.localDescription.sdp},!1===c.trickle&&(c.mySdp.trickle=!1),t.debug(f),c.sdpSent=!0,f.success(c.mySdp)):t.warn("Local SDP instance is invalid, not sending anything...")}else t.warn("Invalid handle, not sending anything")}(h,c);else{var r={candidate:f.candidate.candidate,sdpMid:f.candidate.sdpMid,sdpMLineIndex:f.candidate.sdpMLineIndex};!0===v.trickle&&q(h,r)}},v.pc.ontrack=function(h){t.log("Handling Remote Track"),t.debug(h),h.streams&&(v.remoteStream=h.streams[0],y.onremotestream(v.remoteStream),h.track&&!h.track.onended&&(t.log("Adding onended callback to track:",h.track),h.track.onended=function(h){t.log("Remote track removed:",h),v.remoteStream&&(v.remoteStream.removeTrack(h.target),y.onremotestream(v.remoteStream))}))}}if(A&&null!=m&&(t.log("Adding local stream"),m.getTracks().forEach(function(t){v.pc.addTrack(t,m)})),function(h){return t.debug("isDataEnabled:",h),"edge"==t.webRTCAdapter.browserDetails.browser?(t.warn("Edge doesn't support data channels yet"),!1):null!=h&&!0===h.data}(r)&&!v.dataChannel){t.log("Creating data channel");var x=function(){var h=null!==v.dataChannel?v.dataChannel.readyState:"null";t.log("State change on data channel: "+h),"open"===h&&y.ondataopen()};v.dataChannel=v.pc.createDataChannel("JanusDataChannel",{ordered:!1}),v.dataChannel.onmessage=function(h){t.log("Received message on data channel: "+h.data),y.ondata(h.data)},v.dataChannel.onopen=x,v.dataChannel.onclose=x,v.dataChannel.onerror=function(h){t.error("Got error on data channel:",h)}}v.myStream&&y.onlocalstream(v.myStream),null==f?function(h,f,r){console.warn("createOffer:",f),(r=r||{}).success="function"==typeof r.success?r.success:t.noop,r.error="function"==typeof r.error?r.error:t.noop;var c=L[h];if(null==c||null===c.webrtcStuff||void 0===c.webrtcStuff)return t.warn("Invalid handle"),void r.error("Invalid handle");var m=c.webrtcStuff,y=!0===r.simulcast;y?t.log("Creating offer (iceDone="+m.iceDone+", simulcast="+y+")"):t.log("Creating offer (iceDone="+m.iceDone+")");var v={offerToReceiveAudio:i(f),offerToReceiveVideo:p(f)};!0===r.iceRestart&&(v.iceRestart=!0),t.debug(v);var _=g(f);if(_&&y&&"firefox"===t.webRTCAdapter.browserDetails.browser){t.log("Enabling Simulcasting for Firefox (RID)");var C=m.pc.getSenders()[1];t.log(C);var w=C.getParameters();t.log(w),C.setParameters({encodings:[{rid:"high",active:!0,priority:"high",maxBitrate:1e6},{rid:"medium",active:!0,priority:"medium",maxBitrate:3e5},{rid:"low",active:!0,priority:"low",maxBitrate:1e5}]})}m.pc.createOffer(function(h){if(t.debug(h),t.log("Setting local description"),_&&y&&("chrome"===t.webRTCAdapter.browserDetails.browser?(t.log("Enabling Simulcasting for Chrome (SDP munging)"),h.sdp=function(h){for(var f=h.split("\r\n"),r=!1,c=[-1],m=-1,y=null,v=null,_=null,C=null,w=-1,T=0;T<f.length;T++){var S=f[T].match(/m=(\w+) */);if(S){var E=S[1];if("video"===E){if(!(c[0]<0)){w=T;break}r=!0}else if(c[0]>-1){w=T;break}}else if(r){var A=f[T].match(/a=ssrc-group:FID (\d+) (\d+)/);if(A)c[0]=A[1],m=A[2],f.splice(T,1),T--;else{if(c[0]){var R=f[T].match("a=ssrc:"+c[0]+" cname:(.+)");if(R&&(y=R[1]),(R=f[T].match("a=ssrc:"+c[0]+" msid:(.+)"))&&(v=R[1]),(R=f[T].match("a=ssrc:"+c[0]+" mslabel:(.+)"))&&(_=R[1]),(R=f[T].match("a=ssrc:"+c+" label:(.+)"))&&(C=R[1]),0===f[T].indexOf("a=ssrc:"+m)){f.splice(T,1),T--;continue}if(0===f[T].indexOf("a=ssrc:"+c[0])){f.splice(T,1),T--;continue}}0!=f[T].length||(f.splice(T,1),T--)}}}if(c[0]<0){w=-1,r=!1;for(var T=0;T<f.length;T++){var S=f[T].match(/m=(\w+) */);if(S){var E=S[1];if("video"===E){if(!(c[0]<0)){w=T;break}r=!0}else if(c[0]>-1){w=T;break}}else if(r){if(c[0]<0){var O=f[T].match(/a=ssrc:(\d+)/);if(O){c[0]=O[1],f.splice(T,1),T--;continue}}else{var R=f[T].match("a=ssrc:"+c[0]+" cname:(.+)");if(R&&(y=R[1]),(R=f[T].match("a=ssrc:"+c[0]+" msid:(.+)"))&&(v=R[1]),(R=f[T].match("a=ssrc:"+c[0]+" mslabel:(.+)"))&&(_=R[1]),(R=f[T].match("a=ssrc:"+c+" label:(.+)"))&&(C=R[1]),0===f[T].indexOf("a=ssrc:"+m)){f.splice(T,1),T--;continue}if(0===f[T].indexOf("a=ssrc:"+c[0])){f.splice(T,1),T--;continue}}0!=f[T].length||(f.splice(T,1),T--)}}}if(c[0]<0)return t.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),h;w<0&&(w=f.length),c[1]=Math.floor(4294967295*Math.random()),c[2]=Math.floor(4294967295*Math.random());for(var T=0;T<c.length;T++)y&&(f.splice(w,0,"a=ssrc:"+c[T]+" cname:"+y),w++),v&&(f.splice(w,0,"a=ssrc:"+c[T]+" msid:"+v),w++),_&&(f.splice(w,0,"a=ssrc:"+c[T]+" mslabel:"+v),w++),C&&(f.splice(w,0,"a=ssrc:"+c[T]+" label:"+v),w++);return f.splice(w,0,"a=ssrc-group:SIM "+c[0]+" "+c[1]+" "+c[2]),(h=f.join("\r\n")).endsWith("\r\n")||(h+="\r\n"),h}(h.sdp)):"firefox"!==t.webRTCAdapter.browserDetails.browser&&t.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),m.mySdp=h.sdp,m.pc.setLocalDescription(h),m.mediaConstraints=v,m.iceDone||m.trickle){t.log("Offer ready"),t.debug(r);var f={type:h.type,sdp:h.sdp};r.success(f)}else t.log("Waiting for all candidates...")},r.error,v)}(h,r,c):v.pc.setRemoteDescription(new RTCSessionDescription(f),function(){t.log("Remote description accepted!"),function(h,f,r){(r=r||{}).success="function"==typeof r.success?r.success:t.noop,r.error="function"==typeof r.error?r.error:t.noop;var c=L[h];if(null==c||null===c.webrtcStuff||void 0===c.webrtcStuff)return t.warn("Invalid handle"),void r.error("Invalid handle");var m=c.webrtcStuff,y=!0===r.simulcast;y?t.log("Creating answer (iceDone="+m.iceDone+", simulcast="+y+")"):t.log("Creating answer (iceDone="+m.iceDone+")");var v=null;v="firefox"==t.webRTCAdapter.browserDetails.browser||"edge"==t.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:i(f),offerToReceiveVideo:p(f)}:{mandatory:{OfferToReceiveAudio:i(f),OfferToReceiveVideo:p(f)}},t.debug(v);var _=g(f);if(_&&y&&"firefox"===t.webRTCAdapter.browserDetails.browser){t.log("Enabling Simulcasting for Firefox (RID)");var C=m.pc.getSenders()[1];t.log(C);var w=C.getParameters();t.log(w),C.setParameters({encodings:[{rid:"high",active:!0,priority:"high",maxBitrate:1e6},{rid:"medium",active:!0,priority:"medium",maxBitrate:3e5},{rid:"low",active:!0,priority:"low",maxBitrate:1e5}]})}m.pc.createAnswer(function(h){if(t.debug(h),t.log("Setting local description"),_&&y&&("chrome"===t.webRTCAdapter.browserDetails.browser?t.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==t.webRTCAdapter.browserDetails.browser&&t.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),m.mySdp=h.sdp,m.pc.setLocalDescription(h),m.mediaConstraints=v,m.iceDone||m.trickle){var f={type:h.type,sdp:h.sdp};r.success(f)}else t.log("Waiting for all candidates...")},r.error,v)}(h,r,c)},c.error)}function V(h,f){(f=f||{}).success="function"==typeof f.success?f.success:t.noop,f.error="function"==typeof f.error?f.error:k;var r=f.jsep;f.media=f.media||{audio:!0,video:!0};var c=f.media,m=L[h];if(null==m||null===m.webrtcStuff||void 0===m.webrtcStuff)return t.warn("Invalid handle"),void f.error("Invalid handle");var y,v=m.webrtcStuff;if(void 0===v.pc||null===v.pc)c.update=!1;else if(void 0!==v.pc&&null!==v.pc)if(t.log("Updating existing media session"),c.update=!0,null!==f.stream&&void 0!==f.stream)f.stream!==v.myStream&&t.log("Renegotiation involves a new external stream");else{if(c.addAudio){if(c.replaceAudio=!1,c.removeAudio=!1,c.audioSend=!0,v.myStream&&v.myStream.getAudioTracks()&&v.myStream.getAudioTracks().length)return t.error("Can't add audio stream, there already is one"),void f.error("Can't add audio stream, there already is one")}else c.removeAudio?(c.replaceAudio=!1,c.addAudio=!1,c.audioSend=!1):c.replaceAudio&&(c.addAudio=!1,c.removeAudio=!1,c.audioSend=!0);if(null===v.myStream||void 0===v.myStream?(c.replaceAudio&&(c.replaceAudio=!1,c.addAudio=!0,c.audioSend=!0),o(c)&&(c.addAudio=!0)):null!==v.myStream.getAudioTracks()&&void 0!==v.myStream.getAudioTracks()&&0!==v.myStream.getAudioTracks().length||(c.replaceAudio&&(c.replaceAudio=!1,c.addAudio=!0,c.audioSend=!0),o(c)&&(c.addAudio=!0)),c.addVideo){if(c.replaceVideo=!1,c.removeVideo=!1,c.videoSend=!0,v.myStream&&v.myStream.getVideoTracks()&&v.myStream.getVideoTracks().length)return t.error("Can't add video stream, there already is one"),void f.error("Can't add video stream, there already is one")}else c.removeVideo?(c.replaceVideo=!1,c.addVideo=!1,c.videoSend=!1):c.replaceVideo&&(c.addVideo=!1,c.removeVideo=!1,c.videoSend=!0);null===v.myStream||void 0===v.myStream?(c.replaceVideo&&(c.replaceVideo=!1,c.addVideo=!0,c.videoSend=!0),g(c)&&(c.addVideo=!0)):null!==v.myStream.getVideoTracks()&&void 0!==v.myStream.getVideoTracks()&&0!==v.myStream.getVideoTracks().length||(c.replaceVideo&&(c.replaceVideo=!1,c.addVideo=!0,c.videoSend=!0),g(c)&&(c.addVideo=!0)),c.addData&&(c.data=!0)}if(v.trickle=(y=f.trickle,t.debug("isTrickleEnabled:",y),null==y||!0===y),null!==f.stream&&void 0!==f.stream){var _=f.stream;if(t.log("MediaStream provided by the application"),t.debug(_),c.update&&v.myStream&&v.myStream!==f.stream&&!v.streamExternal){try{var C=v.myStream.getTracks();for(var w in C){var T=C[w];t.log(T),null!=T&&T.stop()}}catch(t){}v.myStream=null}return v.streamExternal=!0,void G(h,r,c,f,_)}if(o(c)||g(c)){var S={mandatory:{},optional:[]};m.consentDialog(!0);var E=o(c);!0===E&&null!=c&&null!=c&&"object"==typeof c.audio&&(E=c.audio);var A=g(c);if(!0===A&&null!=c&&null!=c){var R=!0===f.simulcast;if(!R||r||void 0!==c.video&&!1!==c.video||(c.video="hires"),c.video&&"screen"!=c.video&&"window"!=c.video)if("object"==typeof c.video)A=c.video;else{var O=0,D=0;"lowres"===c.video?(D=240,O=320):"lowres-16:9"===c.video?(D=180,O=320):"hires"===c.video||"hires-16:9"===c.video||"hdres"===c.video?(D=720,O=1280):"fhdres"===c.video?(D=1080,O=1920):"4kres"===c.video?(D=2160,O=3840):"stdres"===c.video?(D=480,O=640):"stdres-16:9"===c.video?(D=360,O=640):(t.log("Default video setting is stdres 4:3"),D=480,O=640),t.log("Adding media constraint:",c.video),A={height:{ideal:D},width:{ideal:O}},c.videoFrameRate&&(A.frameRate=c.videoFrameRate),t.debug("Adding video constraint:",A)}else if("screen"===c.video||"window"===c.video){if(c.screenshareFrameRate||(c.screenshareFrameRate=3),"https:"!==window.location.protocol)return t.warn("Screen sharing only works on HTTPS, try the https:// version of this page"),m.consentDialog(!1),void f.error("Screen sharing only works on HTTPS, try the https:// version of this page");var x={};function b(t,y){m.consentDialog(!1),t?f.error({code:t.code,name:t.name,message:t.message}):G(h,r,c,f,y)}function N(h,f,r){t.log("Adding media constraint (screen capture)"),t.debug(h),navigator.mediaDevices.getUserMedia(h).then(function(t){r?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(h){t.addTrack(h.getAudioTracks()[0]),f(null,t)}):f(null,t)}).catch(function(t){m.consentDialog(!1),f(t)})}if("chrome"===t.webRTCAdapter.browserDetails.browser){var M=t.webRTCAdapter.browserDetails.version,F=33;if(window.navigator.userAgent.match("Linux")&&(F=35),M>=26&&M<=F)N(S={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:c.screenshareFrameRate,maxFrameRate:c.screenshareFrameRate,chromeMediaSource:"screen"}},audio:o(c)},b);else{var U=window.setTimeout(function(){return(B=new Error("NavigatorUserMediaError")).name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',m.consentDialog(!1),f.error(B)},1e3);x[U]=[b,null],window.postMessage({type:"janusGetScreen",id:U},"*")}}else if(window.navigator.userAgent.match("Firefox")){var P=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);if(!(P>=33)){var B=new Error("NavigatorUserMediaError");return B.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",m.consentDialog(!1),void f.error(B)}N(S={video:{mozMediaSource:c.video,mediaSource:c.video},audio:o(c)},function(t,h){if(b(t,h),!t)var f=h.currentTime,r=window.setInterval(function(){h||window.clearInterval(r),h.currentTime==f&&(window.clearInterval(r),h.onended&&h.onended()),f=h.currentTime},500)})}return void window.addEventListener("message",function(t){if(t.origin==window.location.origin)if("janusGotScreen"==t.data.type&&x[t.data.id]){var h=x[t.data.id],r=h[0];if(delete x[t.data.id],""===t.data.sourceId){var y=new Error("NavigatorUserMediaError");y.name="You cancelled the request for permission, giving up...",m.consentDialog(!1),f.error(y)}else(S={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:c.screenshareFrameRate,maxFrameRate:c.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}}).video.mandatory.chromeMediaSourceId=t.data.sourceId,N(S,r,o(c))}else"janusGetScreenPending"==t.data.type&&window.clearTimeout(t.data.id)})}}null!=c&&"screen"===c.video||navigator.mediaDevices.enumerateDevices().then(function(y){var v=y.some(function(t){return"audioinput"===t.kind}),_=y.some(function(t){return"videoinput"===t.kind}),C=o(c),w=g(c),T=function(h){return t.debug("isAudioSendRequired:",h),null!=h&&!1!==h.audio&&!1!==h.audioSend&&void 0!==h.failIfNoAudio&&null!==h.failIfNoAudio&&!0===h.failIfNoAudio}(c),S=function(h){return t.debug("isVideoSendRequired:",h),null!=h&&!1!==h.video&&!1!==h.videoSend&&void 0!==h.failIfNoVideo&&null!==h.failIfNoVideo&&!0===h.failIfNoVideo}(c);if(C||w||T||S){var R=!!C&&v,O=!!w&&_;if(!R&&!O)return m.consentDialog(!1),f.error("No capture device found"),!1;if(!R&&T)return m.consentDialog(!1),f.error("Audio capture is required, but no capture device found"),!1;if(!O&&S)return m.consentDialog(!1),f.error("Video capture is required, but no capture device found"),!1}navigator.mediaDevices.getUserMedia({audio:!!v&&E,video:!!_&&A}).then(function(y){var v=y.getVideoTracks()[0];v&&(t.debug("Video height: "+v.getSettings().height),t.debug("Video width: "+v.getSettings().width),t.debug("Video framerate: "+v.getSettings().frameRate)),m.consentDialog(!1),G(h,r,c,f,y)}).catch(function(t){m.consentDialog(!1),f.error({code:t.code,name:t.name,message:t.message})})}).catch(function(t){m.consentDialog(!1),f.error("enumerateDevices error",t)})}else G(h,r,c,f)}function Y(h,f){(f=f||{}).success="function"==typeof f.success?f.success:t.noop,f.error="function"==typeof f.error?f.error:k;var r=f.jsep,c=L[h];if(null==c||null===c.webrtcStuff||void 0===c.webrtcStuff)return t.warn("Invalid handle"),void f.error("Invalid handle");var m=c.webrtcStuff;if(null!=r){if(null===m.pc)return t.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void f.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");m.pc.setRemoteDescription(new RTCSessionDescription(r),function(){t.log("Remote description accepted!"),f.success()},f.error)}else f.error("Invalid JSEP")}function K(h){var f=L[h];if(null==f||null===f.webrtcStuff||void 0===f.webrtcStuff)return t.warn("Invalid handle"),0;var r=f.webrtcStuff;return r.pc.getStats&&"chrome"==t.webRTCAdapter.browserDetails.browser?null===r.remoteStream||void 0===r.remoteStream?(t.warn("Remote stream unavailable"),0):null===r.volume.timer||void 0===r.volume.timer?(t.log("Starting volume monitor"),r.volume.timer=setInterval(function(){r.pc.getStats(function(t){for(var h=t.result(),f=0;f<h.length;f++){var c=h[f];"ssrc"==c.type&&c.stat("audioOutputLevel")&&(r.volume.value=c.stat("audioOutputLevel"))}})},200),0):r.volume.value:(t.log("Getting the remote volume unsupported by browser"),0)}function $(h,f){var r=L[h];if(null==r||null===r.webrtcStuff||void 0===r.webrtcStuff)return t.warn("Invalid handle"),!0;var c=r.webrtcStuff;return null===c.pc||void 0===c.pc?(t.warn("Invalid PeerConnection"),!0):void 0===c.myStream||null===c.myStream?(t.warn("Invalid local MediaStream"),!0):f?null===c.myStream.getVideoTracks()||void 0===c.myStream.getVideoTracks()||0===c.myStream.getVideoTracks().length?(t.warn("No video track"),!0):!c.myStream.getVideoTracks()[0].enabled:null===c.myStream.getAudioTracks()||void 0===c.myStream.getAudioTracks()||0===c.myStream.getAudioTracks().length?(t.warn("No audio track"),!0):!c.myStream.getAudioTracks()[0].enabled}function Q(h,f,r){var c=L[h];if(null==c||null===c.webrtcStuff||void 0===c.webrtcStuff)return t.warn("Invalid handle"),!1;var m=c.webrtcStuff;return null===m.pc||void 0===m.pc?(t.warn("Invalid PeerConnection"),!1):void 0===m.myStream||null===m.myStream?(t.warn("Invalid local MediaStream"),!1):f?null===m.myStream.getVideoTracks()||void 0===m.myStream.getVideoTracks()||0===m.myStream.getVideoTracks().length?(t.warn("No video track"),!1):(m.myStream.getVideoTracks()[0].enabled=!r,!0):null===m.myStream.getAudioTracks()||void 0===m.myStream.getAudioTracks()||0===m.myStream.getAudioTracks().length?(t.warn("No audio track"),!1):(m.myStream.getAudioTracks()[0].enabled=!r,!0)}function Z(h){var f=L[h];if(null==f||null===f.webrtcStuff||void 0===f.webrtcStuff)return t.warn("Invalid handle"),"Invalid handle";var r=f.webrtcStuff;return null===r.pc||void 0===r.pc?"Invalid PeerConnection":r.pc.getStats?null===r.bitrate.timer||void 0===r.bitrate.timer?(t.log("Starting bitrate timer (via getStats)"),r.bitrate.timer=setInterval(function(){r.pc.getStats().then(function(h){h.forEach(function(h){if(h){var f=!1;if(("video"===h.mediaType||h.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===h.type&&h.id.indexOf("rtcp")<0?f=!0:"ssrc"!=h.type||!h.bytesReceived||"VP8"!==h.googCodecName&&""!==h.googCodecName||(f=!0),f)if(r.bitrate.bsnow=h.bytesReceived,r.bitrate.tsnow=h.timestamp,null===r.bitrate.bsbefore||null===r.bitrate.tsbefore)r.bitrate.bsbefore=r.bitrate.bsnow,r.bitrate.tsbefore=r.bitrate.tsnow;else{var c=r.bitrate.tsnow-r.bitrate.tsbefore;"safari"==t.webRTCAdapter.browserDetails.browser&&(c/=1e3);var m=Math.round(8*(r.bitrate.bsnow-r.bitrate.bsbefore)/c);r.bitrate.value=m+" kbits/sec",r.bitrate.bsbefore=r.bitrate.bsnow,r.bitrate.tsbefore=r.bitrate.tsnow}}})})},1e3),"0 kbits/sec"):r.bitrate.value:(t.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser")}function k(h){t.error("WebRTC error:",h)}function I(h,c){t.log("Cleaning WebRTC stuff");var m=L[h];if(null!=m){var y=m.webrtcStuff;if(null!=y){if(!0===c){var v={janus:"hangup",transaction:t.randomString(12)};null!=R&&(v.token=R),null!=O&&(v.apisecret=O),t.debug("Sending hangup request (handle="+h+"):"),t.debug(v),f?(v.session_id=x,v.handle_id=h,r.send(JSON.stringify(v))):t.httpAPICall(_+"/"+x+"/"+h,{verb:"POST",withCredentials:E,data:v})}y.remoteStream=null,y.volume.timer&&clearInterval(y.volume.timer),y.volume.value=null,y.bitrate.timer&&clearInterval(y.bitrate.timer),y.bitrate.timer=null,y.bitrate.bsnow=null,y.bitrate.bsbefore=null,y.bitrate.tsnow=null,y.bitrate.tsbefore=null,y.bitrate.value=null;try{if(!y.streamExternal&&null!==y.myStream&&void 0!==y.myStream){t.log("Stopping local stream tracks");var C=y.myStream.getTracks();for(var w in C){var T=C[w];t.log(T),null!=T&&T.stop()}}}catch(t){}y.streamExternal=!1,y.myStream=null;try{y.pc.close()}catch(t){}y.pc=null,y.mySdp=null,y.iceDone=!1,y.dataChannel=null,y.dtmfSender=null}m.oncleanup()}}function o(h){return t.debug("isAudioSendEnabled:",h),null==h||!1!==h.audio&&(void 0===h.audioSend||null===h.audioSend||!0===h.audioSend)}function i(h){return t.debug("isAudioRecvEnabled:",h),null==h||!1!==h.audio&&(void 0===h.audioRecv||null===h.audioRecv||!0===h.audioRecv)}function g(h){return t.debug("isVideoSendEnabled:",h),null==h||!1!==h.video&&(void 0===h.videoSend||null===h.videoSend||!0===h.videoSend)}function p(h){return t.debug("isVideoRecvEnabled:",h),null==h||!1!==h.video&&(void 0===h.videoRecv||null===h.videoRecv||!0===h.videoRecv)}!function C(w){var T=t.randomString(12),S={janus:"create",transaction:T};if(null!=R&&(S.token=R),null!=O&&(S.apisecret=O),null===_&&t.isArray(y)&&(0===(_=y[v]).indexOf("ws")?(f=!0,t.log("Server #"+(v+1)+": trying WebSockets to contact Janus ("+_+")")):(f=!1,t.log("Server #"+(v+1)+": trying REST API to contact Janus ("+_+")"))),f)for(var A in r=t.newWebSocket(_,"janus-protocol"),c={error:function(){if(console.warn("WS error"),t.error("Error connecting to the Janus WebSockets server... "+_),t.isArray(y))return++v==y.length?void w.error("Error connecting to any of the provided Janus servers: Is the gateway down?"):(_=null,void setTimeout(function(){C(w)},200));w.error("Error connecting to the Janus WebSockets server: Is the gateway down?")},open:function(){console.warn("WS connected"),M[T]=function(h){if(t.debug(h),"success"!==h.janus)return t.error("Ooops: "+h.error.code+" "+h.error.reason),void w.error(h.error.reason);m=setTimeout(P,3e4),D=!0,x=h.data.id,t.log("Created session: "+x),t.sessions[x]=b,w.success()},r.send(JSON.stringify(S))},message:function(t){U(JSON.parse(t.data))},close:function(){null!==_&&D&&(D=!1,console.warn("WS close"),h.error("Lost connection to the gateway (is it down?)"))}})r.addEventListener(A,c[A]);else t.httpAPICall(_,{verb:"POST",withCredentials:E,body:S,success:function(h){if(t.debug(h),"success"!==h.janus)return t.error("Ooops: "+h.error.code+" "+h.error.reason),void w.error(h.error.reason);D=!0,x=h.data.id,t.log("Created session: "+x),t.sessions[x]=b,F(),w.success()},error:function(h,f){if(t.error(h+": "+f),t.isArray(y))return++v==y.length?void w.error("Error connecting to any of the provided Janus servers: Is the gateway down?"):(_=null,void setTimeout(function(){C(w)},200));""===f?w.error(h+": Is the gateway down?"):w.error(h+": "+f)}})}(h),this.getServer=function(){return _},this.isConnected=function(){return D},this.getSessionId=function(){return x},this.destroy=function(y){!function(y){(y=y||{}).success="function"==typeof y.success?y.success:t.noop;var v=!0;if(void 0!==y.asyncRequest&&null!==y.asyncRequest&&(v=!0===y.asyncRequest),t.log("Destroying session "+x+" (async="+v+")"),!D)return t.warn("Is the gateway down? (connected=false)"),void y.success();if(null==x)return t.warn("No session to destroy"),y.success(),void h.destroyed();delete t.sessions[x];var C={janus:"destroy",transaction:t.randomString(12)};if(null!=R&&(C.token=R),null!=O&&(C.apisecret=O),f){C.session_id=x;var w=function(){for(var t in c)r.removeEventListener(t,c[t]);r.removeEventListener("message",T),r.removeEventListener("error",S),m&&clearTimeout(m),r.close()},T=function(t){var f=JSON.parse(t.data);f.session_id==C.session_id&&f.transaction==C.transaction&&(w(),y.success(),h.destroyed())},S=function(t){w(),y.error("Failed to destroy the gateway: Is the gateway down?"),h.destroyed()};return r.addEventListener("message",T),r.addEventListener("error",S),void r.send(JSON.stringify(C))}t.httpAPICall(_+"/"+x,{verb:"POST",async:v,withCredentials:E,body:C,success:function(f){t.log("Destroyed session:"),t.debug(f),x=null,D=!1,"success"!==f.janus&&t.error("Ooops: "+f.error.code+" "+f.error.reason),y.success(),h.destroyed()},error:function(f,r){t.error(f+": "+r),x=null,D=!1,y.success(),h.destroyed()}})}(y)},this.attach=function(h){!function(h){if((h=h||{}).success="function"==typeof h.success?h.success:t.noop,h.error="function"==typeof h.error?h.error:t.noop,h.consentDialog="function"==typeof h.consentDialog?h.consentDialog:t.noop,h.iceState="function"==typeof h.iceState?h.iceState:t.noop,h.mediaState="function"==typeof h.mediaState?h.mediaState:t.noop,h.webrtcState="function"==typeof h.webrtcState?h.webrtcState:t.noop,h.slowLink="function"==typeof h.slowLink?h.slowLink:t.noop,h.onmessage="function"==typeof h.onmessage?h.onmessage:t.noop,h.onlocalstream="function"==typeof h.onlocalstream?h.onlocalstream:t.noop,h.onremotestream="function"==typeof h.onremotestream?h.onremotestream:t.noop,h.ondata="function"==typeof h.ondata?h.ondata:t.noop,h.ondataopen="function"==typeof h.ondataopen?h.ondataopen:t.noop,h.oncleanup="function"==typeof h.oncleanup?h.oncleanup:t.noop,h.ondetached="function"==typeof h.ondetached?h.ondetached:t.noop,!D)return t.warn("Is the gateway down? (connected=false)"),void h.error("Is the gateway down? (connected=false)");var c=h.plugin;if(null==c)return t.error("Invalid plugin"),void h.error("Invalid plugin");var m=h.opaqueId,y=t.randomString(12),v={janus:"attach",plugin:c,opaque_id:m,transaction:y};if(null!=R&&(v.token=R),null!=O&&(v.apisecret=O),"chrome"!=t.webRTCAdapter.browserDetails.browser&&"firefox"!=t.webRTCAdapter.browserDetails.browser&&"safari"!=t.webRTCAdapter.browserDetails.browser||(v["force-bundle"]=!0,v["force-rtcp-mux"]=!0),f)return M[y]=function(f){if(t.debug(f),"success"!==f.janus)return t.error("Ooops: "+f.error.code+" "+f.error.reason),void h.error("Ooops: "+f.error.code+" "+f.error.reason);var r=f.data.id;t.log("Created handle: "+r);var m={session:b,plugin:c,id:r,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:null,dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return r},getPlugin:function(){return c},getVolume:function(){return K(r)},isAudioMuted:function(){return $(r,!1)},muteAudio:function(){return Q(r,!1,!0)},unmuteAudio:function(){return Q(r,!1,!1)},isVideoMuted:function(){return $(r,!0)},muteVideo:function(){return Q(r,!0,!0)},unmuteVideo:function(){return Q(r,!0,!1)},getBitrate:function(){return Z(r)},send:function(t){B(r,t)},data:function(t){z(r,t)},dtmf:function(t){X(r,t)},consentDialog:h.consentDialog,iceState:h.iceState,mediaState:h.mediaState,webrtcState:h.webrtcState,slowLink:h.slowLink,onmessage:h.onmessage,createOffer:function(t){V(r,t)},createAnswer:function(t){V(r,t)},handleRemoteJsep:function(t){Y(r,t)},onlocalstream:h.onlocalstream,onremotestream:h.onremotestream,ondata:h.ondata,ondataopen:h.ondataopen,oncleanup:h.oncleanup,ondetached:h.ondetached,hangup:function(t){I(r,!0===t)},detach:function(t){W(r,t)}};L[r]=m,h.success(m)},v.session_id=x,void r.send(JSON.stringify(v));t.httpAPICall(_+"/"+x,{verb:"POST",withCredentials:E,body:v,success:function(f){if(t.debug(f),"success"!==f.janus)return t.error("Ooops: "+f.error.code+" "+f.error.reason),void h.error("Ooops: "+f.error.code+" "+f.error.reason);var r=f.data.id;t.log("Created handle: "+r);var m={session:b,plugin:c,id:r,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:null,dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return r},getPlugin:function(){return c},getVolume:function(){return K(r)},isAudioMuted:function(){return $(r,!1)},muteAudio:function(){return Q(r,!1,!0)},unmuteAudio:function(){return Q(r,!1,!1)},isVideoMuted:function(){return $(r,!0)},muteVideo:function(){return Q(r,!0,!0)},unmuteVideo:function(){return Q(r,!0,!1)},getBitrate:function(){return Z(r)},send:function(t){B(r,t)},data:function(t){z(r,t)},dtmf:function(t){X(r,t)},consentDialog:h.consentDialog,iceState:h.iceState,mediaState:h.mediaState,webrtcState:h.webrtcState,slowLink:h.slowLink,onmessage:h.onmessage,createOffer:function(t){V(r,t)},createAnswer:function(t){V(r,t)},handleRemoteJsep:function(t){Y(r,t)},onlocalstream:h.onlocalstream,onremotestream:h.onremotestream,ondata:h.ondata,ondataopen:h.ondataopen,oncleanup:h.oncleanup,ondetached:h.ondetached,hangup:function(t){I(r,!0===t)},detach:function(t){W(r,t)}};L[r]=m,h.success(m)},error:function(h,f){t.error(h+": "+f)}})}(h)},this.timeoutSessionCallback="function"==typeof h.timeoutSessionCallback?h.timeoutSessionCallback:t.noop}return t.sessions={},t.extensionId="hapfgfdkleiggjjpfpenajgdnfckjpaj",t.isExtensionEnabled=function(){if(window.navigator.userAgent.match("Chrome")){var h=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),f=33;return window.navigator.userAgent.match("Linux")&&(f=35),h>=26&&h<=f||t.checkJanusExtension()}return!0},t.useDefaultDependencies=function(h){var f=h&&h.fetch||fetch,r=h&&h.Promise||Promise,c=h&&h.WebSocket||WebSocket;return{newWebSocket:function(t,h){return new c(t,h)},isArray:function(t){return Array.isArray(t)},checkJanusExtension:function(){return null!==document.querySelector("#janus-extension-installed")},webRTCAdapter:h&&h.adapter||adapter,httpAPICall:function(h,c){var m={method:c.verb,cache:"no-cache"};void 0!==c.withCredentials&&(m.credentials=!0===c.withCredentials?"include":c.withCredentials?c.withCredentials:"omit"),void 0!==c.body&&(m.body=JSON.stringify(c.body));var y=f(h,m).catch(function(t){return r.reject({message:"Probably a network error, is the gateway down?",error:t})});if(void 0!==c.timeout){var v=new r(function(t,h){var f=setTimeout(function(){return clearTimeout(f),h({message:"Request timed out",timeout:c.timeout})},c.timeout)});y=r.race([y,v])}return y.then(function(h){return h.ok?typeof c.success==typeof t.noop?h.json().then(function(t){c.success(t)}).catch(function(t){return r.reject({message:"Failed to parse response body",error:t,response:h})}):void 0:r.reject({message:"API call failed",response:h})}).catch(function(h){typeof c.error==typeof t.noop&&c.error(h.message||"<< internal error >>",h)}),y}}},t.useOldDependencies=function(h){var f=h&&h.jQuery||jQuery,r=h&&h.WebSocket||WebSocket;return{newWebSocket:function(t,h){return new r(t,h)},isArray:function(t){return f.isArray(t)},checkJanusExtension:function(){return f("#janus-extension-installed").length>0},webRTCAdapter:h&&h.adapter||adapter,httpAPICall:function(h,r){var c=void 0!==r.body?{contentType:"application/json",data:JSON.stringify(r.body)}:{},m=void 0!==r.withCredentials?{xhrFields:{withCredentials:r.withCredentials}}:{};return f.ajax(f.extend(c,m,{url:h,type:r.verb,cache:!1,dataType:"json",async:r.async,timeout:r.timeout,success:function(h){typeof r.success==typeof t.noop&&r.success(h)},error:function(h,f,c){typeof r.error==typeof t.noop&&r.error(f,c)}}))}}},t.noop=function(){},t.init=function(h){if((h=h||{}).callback="function"==typeof h.callback?h.callback:t.noop,!0===t.initDone)h.callback();else{if("undefined"!=typeof console&&void 0!==console.log||(console={log:function(){}}),t.trace=t.noop,t.debug=t.noop,t.vdebug=t.noop,t.log=t.noop,t.warn=t.noop,t.error=t.noop,!0===h.debug||"all"===h.debug)t.trace=console.trace.bind(console),t.debug=console.debug.bind(console),t.vdebug=console.debug.bind(console),t.log=console.log.bind(console),t.warn=console.warn.bind(console),t.error=console.error.bind(console);else if(Array.isArray(h.debug))for(var f in h.debug){var r=h.debug[f];switch(r){case"trace":t.trace=console.trace.bind(console);break;case"debug":t.debug=console.debug.bind(console);break;case"vdebug":t.vdebug=console.debug.bind(console);break;case"log":t.log=console.log.bind(console);break;case"warn":t.warn=console.warn.bind(console);break;case"error":t.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+r+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}}t.log("Initializing library");var c=h.dependencies||t.useDefaultDependencies();t.isArray=c.isArray,t.webRTCAdapter=c.webRTCAdapter,t.httpAPICall=c.httpAPICall,t.checkJanusExtension=c.checkJanusExtension,t.newWebSocket=c.newWebSocket,t.listDevices=function(h,f){h="function"==typeof h?h:t.noop,null==f&&(f={audio:!0,video:!0}),navigator.mediaDevices?navigator.mediaDevices.getUserMedia(f).then(function(f){navigator.mediaDevices.enumerateDevices().then(function(r){t.debug(r),h(r);try{var c=f.getTracks();for(var m in c){var y=c[m];null!=y&&y.stop()}}catch(t){}})}).catch(function(f){t.error(f),h([])}):(t.warn("navigator.mediaDevices unavailable"),h([]))},t.attachMediaStream=function(h,f){"chrome"===t.webRTCAdapter.browserDetails.browser?t.webRTCAdapter.browserDetails.version>=43?h.srcObject=f:void 0!==h.src?h.src=URL.createObjectURL(f):t.error("Error attaching stream to element"):h.srcObject=f},t.reattachMediaStream=function(h,f){"chrome"===t.webRTCAdapter.browserDetails.browser?t.webRTCAdapter.browserDetails.version>=43?h.srcObject=f.srcObject:void 0!==h.src?h.src=f.src:t.error("Error reattaching stream to element"):h.srcObject=f.srcObject};var m=window.onbeforeunload;window.onbeforeunload=function(){for(var h in t.log("Closing window"),t.sessions)null!==t.sessions[h]&&void 0!==t.sessions[h]&&t.sessions[h].destroyOnUnload&&(t.log("Destroying session "+h),t.sessions[h].destroy({asyncRequest:!1}));m&&"function"==typeof m&&m()},t.initDone=!0,h.callback()}},t.isWebrtcSupported=function(){return void 0!==window.RTCPeerConnection&&null!==window.RTCPeerConnection&&void 0!==navigator.getUserMedia&&null!==navigator.getUserMedia},t.randomString=function(t){for(var h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",f="",r=0;r<t;r++){var c=Math.floor(Math.random()*h.length);f+=h.substring(c,c+1)}return f},t}()},function(t,h,f){var r={EventEmitter:f(55),EmitterSubscription:f(13)};t.exports=r},function(t,h,f){"use strict";var r=f(13),c=f(57),m=f(58),y=f(14),v=function(){function t(){!function(t,h){if(!(t instanceof h))throw new TypeError("Cannot call a class as a function")}(this,t),this._subscriber=new c,this._currentSubscription=null}return t.prototype.addListener=function(t,h,f){return this._subscriber.addSubscription(t,new r(this._subscriber,h,f))},t.prototype.once=function(t,h,f){var r=this;return this.addListener(t,function(){r.removeCurrentListener(),h.apply(f,arguments)})},t.prototype.removeAllListeners=function(t){this._subscriber.removeAllSubscriptions(t)},t.prototype.removeCurrentListener=function(){this._currentSubscription||y(!1),this._subscriber.removeSubscription(this._currentSubscription)},t.prototype.listeners=function(t){var h=this._subscriber.getSubscriptionsForType(t);return h?h.filter(m.thatReturnsTrue).map(function(t){return t.listener}):[]},t.prototype.emit=function(t){var h=this._subscriber.getSubscriptionsForType(t);if(h){for(var f=Object.keys(h),r=0;r<f.length;r++){var c=h[f[r]];c&&(this._currentSubscription=c,this.__emitToSubscription.apply(this,[c].concat(Array.prototype.slice.call(arguments))))}this._currentSubscription=null}},t.prototype.__emitToSubscription=function(t,h){var f=Array.prototype.slice.call(arguments,2);t.listener.apply(t.context,f)},t}();t.exports=v},function(t,h,f){"use strict";var r=function(){function t(h){!function(t,h){if(!(t instanceof h))throw new TypeError("Cannot call a class as a function")}(this,t),this.subscriber=h}return t.prototype.remove=function(){this.subscriber&&(this.subscriber.removeSubscription(this),this.subscriber=null)},t}();t.exports=r},function(t,h,f){"use strict";var r=f(14),c=function(){function t(){!function(t,h){if(!(t instanceof h))throw new TypeError("Cannot call a class as a function")}(this,t),this._subscriptionsForType={},this._currentSubscription=null}return t.prototype.addSubscription=function(t,h){h.subscriber!==this&&r(!1),this._subscriptionsForType[t]||(this._subscriptionsForType[t]=[]);var f=this._subscriptionsForType[t].length;return this._subscriptionsForType[t].push(h),h.eventType=t,h.key=f,h},t.prototype.removeAllSubscriptions=function(t){void 0===t?this._subscriptionsForType={}:delete this._subscriptionsForType[t]},t.prototype.removeSubscription=function(t){var h=t.eventType,f=t.key,r=this._subscriptionsForType[h];r&&delete r[f]},t.prototype.getSubscriptionsForType=function(t){return this._subscriptionsForType[t]},t}();t.exports=c},function(t,h,f){"use strict";function r(t){return function(){return t}}var c=function(){};c.thatReturns=r,c.thatReturnsFalse=r(!1),c.thatReturnsTrue=r(!0),c.thatReturnsNull=r(null),c.thatReturnsThis=function(){return this},c.thatReturnsArgument=function(t){return t},t.exports=c}]);